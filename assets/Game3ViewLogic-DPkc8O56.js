import{G as e,a as A}from"./Game3LogicSchema-LB8iQ2Jc.js";import{B as F}from"./BaseViewLogic-fTOOk9Vw.js";const i={HERO_X:0,HERO_Y:1,HERO_HP:2,HERO_ANIM_FRAME:5,HERO_FLIP:6,HERO_WIDTH:7,HERO_HEIGHT:8,HERO_ANIM_STATE:9,WORLD_SCALE:10,PLAYER_SCALE:11,PLAYER_OFFSET_Y:12,UI_BOUNCE:20,GLITCH_INTENSITY:21,VIGNETTE_PULSE:22,OBJ_COUNT:30},O={STRIDE:5};class N extends F{uiBounce=0;glitchIntensity=0;lastHp=-1;animFrame=0;animTimer=0;lastAnimState=0;lastFlipX=!1;update(a,r){const s=this.logicViews.get("main"),m=this.logicViews.get("platforms"),t=this.outputViews.get("main"),n=this.outputViews.get("platforms");if(!s||!m||!t||!n)return;const R=s[e.OBJ_COUNT],o=Math.floor(n.length/O.STRIDE);R>o?this._outResizePending!==o&&(self.postMessage({type:"REQUEST_RESIZE_OUTPUT",payload:{bufferName:"platforms",newSize:(R+1e3)*O.STRIDE}}),this._outResizePending=o):this._outResizePending=0;const c=s[e.HERO_HP],T=s[e.HERO_VX],I=s[e.IS_ON_GROUND]===1,p=s[e.IS_WALL_SLIDING]===1;let _=this.lastFlipX;T>.01?_=!0:T<-.01&&(_=!1),this.lastFlipX=_;let l=0;p?l=3:I?Math.abs(T)>.01?l=1:l=0:l=2,l!==this.lastAnimState?(this.animFrame=0,this.animTimer=0,this.lastAnimState=l):(this.animTimer++,this.animTimer>=6&&(this.animFrame=(this.animFrame+1)%12,this.animTimer=0)),this.lastHp!==-1&&c<this.lastHp&&(this.glitchIntensity=1),this.lastHp=c,this.glitchIntensity*=.92;const f=a/16.67;this.uiBounce+=.05*f;const u=.5+Math.sin(r*.05)*.2;t[i.HERO_X]=s[e.HERO_X],t[i.HERO_Y]=s[e.HERO_Y],t[i.HERO_HP]=c,t[i.HERO_ANIM_FRAME]=this.animFrame,t[i.HERO_FLIP]=_?1:0,t[i.HERO_ANIM_STATE]=l,t[i.HERO_WIDTH]=s[e.HERO_WIDTH],t[i.HERO_HEIGHT]=s[e.HERO_HEIGHT],t[i.WORLD_SCALE]=s[e.WORLD_SCALE],t[i.PLAYER_SCALE]=s[e.PLAYER_SCALE],t[i.PLAYER_OFFSET_Y]=s[e.PLAYER_OFFSET_Y],t[i.UI_BOUNCE]=Math.sin(this.uiBounce)*5,t[i.GLITCH_INTENSITY]=this.glitchIntensity,t[i.VIGNETTE_PULSE]=u;const S=Math.min(R,o);t[i.OBJ_COUNT]=S;for(let H=0;H<S;H++){const E=H*A.STRIDE,h=H*O.STRIDE;n[h]=m[E],n[h+1]=m[E+1],n[h+2]=m[E+2],n[h+3]=m[E+3],n[h+4]=m[E+4]}}getSnapshot(){return{uiBounce:this.uiBounce,glitchIntensity:this.glitchIntensity,lastHp:this.lastHp,animFrame:this.animFrame,animTimer:this.animTimer,lastAnimState:this.lastAnimState,lastFlipX:this.lastFlipX}}loadSnapshot(a){a&&(this.uiBounce=a.uiBounce??0,this.glitchIntensity=a.glitchIntensity??0,this.lastHp=a.lastHp??-1,this.animFrame=a.animFrame??0,this.animTimer=a.animTimer??0,this.lastAnimState=a.lastAnimState??0,this.lastFlipX=a.lastFlipX??!1)}}export{N as Game3ViewLogic};
//# sourceMappingURL=Game3ViewLogic-DPkc8O56.js.map
