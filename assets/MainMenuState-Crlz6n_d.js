import{C as x,A as c,I as f,F as o,S as h,a as p,r,j as a,i as w,s as u,h as b,b as m,R as I}from"./index-SB0jwsSG.js";import{B as M}from"./BaseMenuController-CRgEou9J.js";import{m as l,G as S}from"./GameSprite-GkIwotE9.js";class v extends M{campaign=x.getInstance();audio=c.getInstance();selectedIndex=0;MENU_COUNT=4;onViewUpdate;resOverride;setResOverride;bindView(e,t,s){this.onViewUpdate=e,this.resOverride=t,this.setResOverride=s,this.onViewUpdate(this.selectedIndex)}unbindView(){this.onViewUpdate=void 0}playBGM(){this.audio.play("bgm_menu")}stopBGM(){this.audio.stop("bgm_menu")}playNavSFX(){this.audio.play("sfx_nav")}setHoverIndex(e){this.selectedIndex!==e&&(this.selectedIndex=e,this.playNavSFX(),this.onViewUpdate?.(this.selectedIndex))}onKeyDown(e){const t=f.getInstance();let s=!1;t.isKeyAction(e.key,"UI_DOWN")?(this.selectedIndex=(this.selectedIndex+1)%this.MENU_COUNT,s=!0):t.isKeyAction(e.key,"UI_UP")?(this.selectedIndex=(this.selectedIndex-1+this.MENU_COUNT)%this.MENU_COUNT,s=!0):t.isKeyAction(e.key,"UI_ACCEPT")&&this.executeSelected(),s&&(this.playNavSFX(),this.onViewUpdate?.(this.selectedIndex))}executeSelected(){switch(this.selectedIndex){case 0:this.campaign.startCampaign("cross_game");break;case 1:this.openPopup(o.SAVE_MENU);break;case 2:this.openPopup(o.SETTINGS_MENU,{res:this.resOverride,setRes:this.setResOverride});break;case 3:this.handleNav(o.DEV_MENU);break}}async handleNav(e,t={}){const s=await h.create(e,{reset:!1,...t});p.getInstance().replace(s)}async openPopup(e,t={}){const s=await h.create(e,t);p.getInstance().push(s)}onBack(){}}const E=({w:n,h:e})=>{const t=l.useApp();return r.useEffect(()=>{t?.renderer&&(t.renderer.resize(n,e),u.SCALE_MODE=w.NEAREST,u.ROUND_PIXELS=!0,t.view instanceof HTMLCanvasElement&&(t.view.width=n,t.view.height=e,t.view.style.imageRendering="pixelated"))},[t,n,e]),null},N=()=>{const[n,e]=r.useState(0);return r.useEffect(()=>{e(0)},["main"]),l.useTick(t=>{e(s=>s+4/60*t)}),a.jsx(S,{sheetName:"main_splash",animationName:"main",currentFrame:Math.floor(n),x:0,y:0,anchor:0,scale:1})},C=({controller:n,res:e,setRes:t})=>{const[s,g]=r.useState(0);r.useEffect(()=>(n.bindView(g,e,t),()=>n.unbindView()),[n,e,t]);const y=["Start Game","Load Game","Options","Legacy Menu"];return a.jsxs("div",{style:{position:"absolute",inset:0,background:"#000",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:[a.jsx("style",{children:U}),a.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",maxWidth:"calc(100vh * (16 / 9))",maxHeight:"calc(100vw * (9 / 16))",aspectRatio:"16 / 9",backgroundColor:"#000000",boxSizing:"border-box",fontFamily:"monospace",display:"flex"},children:[a.jsx("div",{style:{flex:1,borderTop:"2.8cqw solid #000000",borderBottom:"2.8cqw solid #000000",padding:"5cqw",display:"flex",flexDirection:"column",justifyContent:"center",gap:"1.5cqw",backgroundColor:"#3f3f3f"},children:y.map((d,i)=>a.jsx("button",{className:`menu-button ${s===i?"menu-button-active":""}`,onMouseEnter:()=>n.setHoverIndex(i),onClick:()=>n.executeSelected(),style:{padding:"1.2cqw",backgroundColor:s===i?"#7f0000":"#400000",color:s===i?"#ffffff":"#bfbfbf",borderColor:s===i?"#ffffff":"#000000",cursor:"pointer",fontSize:"2cqw",fontWeight:"bold",textAlign:"left",textTransform:"uppercase",transition:"all 0.1s ease-in-out"},children:s===i?`> ${d}`:d},i))}),a.jsx("div",{style:{flex:3,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:a.jsxs(l.Stage,{width:240,height:180,options:{backgroundColor:657930,backgroundAlpha:0,antialias:!1,resolution:1,autoDensity:!1},style:{width:"100%",height:"100%",objectFit:"contain",imageRendering:"pixelated",display:"block"},children:[a.jsx(E,{w:240,h:180}),a.jsx(N,{animationName:"main"})]})})]})]})},U=`
  @keyframes pulse {
    0% { transform: translateX(0); }
    50% { transform: translateX(0.5cqw); }
    100% { transform: translateX(0); }
  }
  .menu-button {
    border-top: none;
    border-left: none;
    border-bottom-width: 0.5cqw;
    border-bottom-style: solid;
    border-right-width: 0.5cqw;
    border-right-style: solid;
    clip-path: polygon(0 0, calc(100% - 3cqw) 0, calc(100% - 3cqw) 1cqw, 100% 1cqw, 100% 100%, 0 100%);
  }
  .menu-button-active {
    animation: pulse 2s infinite ease-in-out;
  }
`;class T extends b{name=o.MAIN_MENU;controller;params;MANIFEST_PATH="res/mainManifest.json";constructor(e){super(),this.params=e||{},this.controller=new v}async init(){await c.getInstance().loadManifest(this.MANIFEST_PATH,this.name),await m.getInstance().loadManifest(this.MANIFEST_PATH,this.name),f.getInstance().refreshBindings("Shared"),this.controller.init(this.name),this.controller.playBGM(),this.isRendering=!0}update(e,t){}getView(){return I.createElement(C,{key:this.name,controller:this.controller,res:this.params.res,setRes:this.params.setRes})}destroy(){this.controller.stopBGM(),c.getInstance().uncacheByState(this.name),m.getInstance().uncacheByState(this.name),this.controller.destroy()}}export{T as MainMenuState};
//# sourceMappingURL=MainMenuState-Crlz6n_d.js.map
