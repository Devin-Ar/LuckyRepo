{"version":3,"file":"BHViewLogic-CzRQTVeb.js","sources":["../src/features/BulletTest/model/BHViewSchema.ts","../src/features/BulletTest/view/BHViewLogic.ts"],"sourcesContent":["// src/features/BulletTest/model/BHViewSchema.ts\r\nimport { IBuffer } from \"../../../core/interfaces/IBuffer\";\r\n\r\nexport const BHViewSchema: IBuffer = {\r\n    HERO_X: 0,\r\n    HERO_Y: 1,\r\n    HERO_ROTATION: 2,\r\n    HERO_SCALE: 3,\r\n    HERO_HP_DISPLAY: 4,\r\n    HERO_FRAME: 5,\r\n\r\n    ACTIVE_ROCK_COUNT: 8,\r\n\r\n    // Wave display\r\n    CURRENT_WAVE: 9,\r\n    TOTAL_WAVES: 12,\r\n    WAVE_STATE: 13,\r\n    WAVE_DELAY_TIMER: 14,\r\n\r\n    // Exit door\r\n    EXIT_DOOR_ACTIVE: 15,\r\n    EXIT_DOOR_X: 16,\r\n    EXIT_DOOR_Y: 17,\r\n    CURRENT_LEVEL: 18,\r\n    BOSS_HP: 19,\r\n    BOSS_VULNERABLE: 20,\r\n\r\n    ROCKS_START_INDEX: 21,\r\n    BOSS_X: 21,\r\n    BOSS_Y: 22,\r\n    BOSS_ACTIVE: 23,\r\n\r\n    ROCKS_START_INDEX_ACTUAL: 24,\r\n    ROCK_STRIDE: 6,\r\n    PPROJ_START_INDEX: 200,\r\n    PPROJ_STRIDE: 2,\r\n    EPROJ_START_INDEX: 300,\r\n    EPROJ_STRIDE: 2,\r\n\r\n    BUFFER_SIZE: 4096\r\n};","// src/features/BulletTest/view/BHViewLogic.ts\r\nimport { BHLogicSchema } from '../model/BHLogicSchema';\r\nimport { BHViewSchema } from '../model/BHViewSchema';\r\nimport { BaseViewLogic } from '../../../core/templates/BaseViewLogic';\r\n\r\nexport class BHViewLogic extends BaseViewLogic {\r\n    private heroRotation: number = 0;\r\n    private globalRockRotation: number = 0;\r\n    private heroFrame: number = 0;\r\n\r\n    public update(dt: number, frameCount: number) {\r\n        if (!this.hasBuffers()) return;\r\n\r\n        const rawX = this.logicView[BHLogicSchema.HERO_X];\r\n        const rawY = this.logicView[BHLogicSchema.HERO_Y];\r\n        const rawHP = this.logicView[BHLogicSchema.HERO_HP];\r\n\r\n        this.heroRotation += 0.03 * (dt / 16.67);\r\n        this.heroFrame += 0.15 * (dt / 16.67);\r\n\r\n        this.outputView[BHViewSchema.HERO_X] = rawX;\r\n        this.outputView[BHViewSchema.HERO_Y] = rawY;\r\n        this.outputView[BHViewSchema.HERO_ROTATION] = this.heroRotation;\r\n        this.outputView[BHViewSchema.HERO_SCALE] = 0.5 + (rawHP / 100);\r\n        this.outputView[BHViewSchema.HERO_HP_DISPLAY] = rawHP;\r\n        this.outputView[BHViewSchema.HERO_FRAME] = this.heroFrame;\r\n\r\n        const rockCount = this.logicView[BHLogicSchema.ENTITY_COUNT];\r\n        this.outputView[BHViewSchema.ACTIVE_ROCK_COUNT] = rockCount;\r\n        this.globalRockRotation += 0.02 * (dt / 16.67);\r\n\r\n        for (let i = 0; i < rockCount; i++) {\r\n            const lBase = BHLogicSchema.ROCKS_START_INDEX_ACTUAL + (i * BHLogicSchema.ROCK_STRIDE);\r\n            const vBase = BHViewSchema.ROCKS_START_INDEX_ACTUAL + (i * BHViewSchema.ROCK_STRIDE);\r\n\r\n            this.outputView[vBase] = this.logicView[lBase];\r\n            this.outputView[vBase + 1] = this.logicView[lBase + 1];\r\n\r\n            const rockSeed = this.logicView[lBase + 2];\r\n            const individualSpeed = ((Math.floor(rockSeed) % 5) + 1) * 0.5;\r\n            this.outputView[vBase + 2] = (this.globalRockRotation * individualSpeed) + rockSeed;\r\n\r\n            this.outputView[vBase + 3] = this.logicView[lBase + 3];\r\n            this.outputView[vBase + 4] = this.logicView[lBase + 4];\r\n            this.outputView[vBase + 5] = this.logicView[lBase + 5];\r\n        }\r\n\r\n        // Projectiles\r\n        const projCount = this.logicView[BHLogicSchema.PPROJ_START_INDEX - 1];\r\n        this.outputView[BHViewSchema.PPROJ_START_INDEX - 1] = projCount;\r\n        for (let i = 0; i < projCount; i++) {\r\n            const lBase = BHLogicSchema.PPROJ_START_INDEX + (i * BHLogicSchema.PPROJ_STRIDE);\r\n            const vBase = BHViewSchema.PPROJ_START_INDEX + (i * BHViewSchema.PPROJ_STRIDE);\r\n            this.outputView[vBase] = this.logicView[lBase];\r\n            this.outputView[vBase + 1] = this.logicView[lBase + 1];\r\n        }\r\n\r\n        // Projectiles\r\n        const evilProjCount = this.logicView[BHLogicSchema.EPROJ_START_INDEX - 1];\r\n        this.outputView[BHViewSchema.EPROJ_START_INDEX - 1] = evilProjCount;\r\n        for (let i = 0; i < evilProjCount; i++) {\r\n            const lBase = BHLogicSchema.EPROJ_START_INDEX + (i * BHLogicSchema.EPROJ_STRIDE);\r\n            const vBase = BHViewSchema.EPROJ_START_INDEX + (i * BHViewSchema.EPROJ_STRIDE);\r\n            this.outputView[vBase] = this.logicView[lBase];\r\n            this.outputView[vBase + 1] = this.logicView[lBase + 1];\r\n        }\r\n\r\n        // Wave state passthrough\r\n        this.outputView[BHViewSchema.CURRENT_WAVE] = this.logicView[BHLogicSchema.CURRENT_WAVE];\r\n        this.outputView[BHViewSchema.TOTAL_WAVES] = this.logicView[BHLogicSchema.TOTAL_WAVES];\r\n        this.outputView[BHViewSchema.WAVE_STATE] = this.logicView[BHLogicSchema.WAVE_STATE];\r\n        this.outputView[BHViewSchema.WAVE_DELAY_TIMER] = this.logicView[BHLogicSchema.WAVE_DELAY_TIMER];\r\n\r\n        // Exit door passthrough\r\n        this.outputView[BHViewSchema.EXIT_DOOR_ACTIVE] = this.logicView[BHLogicSchema.EXIT_DOOR_ACTIVE];\r\n        this.outputView[BHViewSchema.EXIT_DOOR_X] = this.logicView[BHLogicSchema.EXIT_DOOR_X];\r\n        this.outputView[BHViewSchema.EXIT_DOOR_Y] = this.logicView[BHLogicSchema.EXIT_DOOR_Y];\r\n        this.outputView[BHViewSchema.CURRENT_LEVEL] = this.logicView[BHLogicSchema.CURRENT_LEVEL];\r\n\r\n        // Boss state passthrough\r\n        this.outputView[BHViewSchema.BOSS_HP] = this.logicView[BHLogicSchema.BOSS_HP];\r\n        this.outputView[BHViewSchema.BOSS_VULNERABLE] = this.logicView[BHLogicSchema.BOSS_VULNERABLE];\r\n        this.outputView[BHViewSchema.BOSS_X] = this.logicView[BHLogicSchema.BOSS_X];\r\n        this.outputView[BHViewSchema.BOSS_Y] = this.logicView[BHLogicSchema.BOSS_Y];\r\n        this.outputView[BHViewSchema.BOSS_ACTIVE] = this.logicView[BHLogicSchema.BOSS_ACTIVE];\r\n    }\r\n\r\n    public override getSnapshot() {\r\n        return {\r\n            heroRotation: this.heroRotation,\r\n            globalRockRotation: this.globalRockRotation,\r\n            heroFrame: this.heroFrame\r\n        };\r\n    }\r\n\r\n    public override loadSnapshot(data: any) {\r\n        if (data) {\r\n            this.heroRotation = data.heroRotation ?? 0;\r\n            this.globalRockRotation = data.globalRockRotation ?? 0;\r\n            this.heroFrame = data.heroFrame ?? 0;\r\n        }\r\n    }\r\n}"],"names":["BHViewSchema","BHViewLogic","BaseViewLogic","dt","frameCount","rawX","BHLogicSchema","rawY","rawHP","rockCount","i","lBase","vBase","rockSeed","individualSpeed","projCount","evilProjCount","data"],"mappings":"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"}