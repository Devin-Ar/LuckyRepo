{"version":3,"file":"BHTestLogic-DdZ4yjA3.js","sources":["../src/features/BulletTest/logic/BHCommands.ts","../src/features/BulletTest/interfaces/baseInterfaces/baseProjectile.ts","../src/features/BulletTest/interfaces/baseInterfaces/basePlayer.ts","../src/features/BulletTest/interfaces/baseInterfaces/baseEntity.ts","../src/features/BulletTest/interfaces/baseInterfaces/BossEntity.ts","../src/features/BulletTest/logic/WaveManager.ts","../src/features/BulletTest/logic/BHTestLogic.ts"],"sourcesContent":["// src/features/Game1/logic/Game1Commands.ts\r\nimport {ICommand} from '../../../core/interfaces/ICommand';\r\nimport {BHConfig} from '../model/BHConfig';\r\n\r\nexport const BHCommands: Record<string, ICommand> = {\r\n    INITIALIZE: {\r\n        execute(logic, payload: BHConfig) {\r\n            logic.applyConfig(payload);\r\n            logic.setInitialized(true);\r\n        }\r\n    },\r\n    MOVEMENT: {\r\n        execute(logic, payload) {\r\n            logic.setMovement(payload.vx, payload.vy);\r\n        }\r\n    },\r\n    TAKE_DAMAGE: {\r\n        execute(logic, payload) {\r\n            const damage = payload.amount ?? 15;\r\n            logic.modifyHp(-damage);\r\n        }\r\n    }\r\n};","import {IHitbox} from \"../IEntity\";\r\nimport {basePlayer} from \"./basePlayer\";\r\nimport {BHConfig} from \"../../model/BHConfig\";\r\nimport {IProjectile} from \"../IProjectile\";\r\nimport {baseEntity} from \"./baseEntity\";\r\n\r\nexport abstract class baseProjectile implements IProjectile {\r\n    seed: number;\r\n    height: number;\r\n    width: number;\r\n    x: number;\r\n    y: number;\r\n    vx: number;\r\n    vy: number;\r\n    damage: number;\r\n    active: boolean;\r\n    hitbox: IHitbox;\r\n    playerRelative: number;\r\n    type: string;\r\n    health: number;\r\n\r\n    protected constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.vx = 0;\r\n        this.vy = 0;\r\n        this.damage = 0;\r\n        this.height = 0;\r\n        this.width = 0;\r\n        this.seed = Math.random() * 1000;\r\n        this.active = false;\r\n        this.hitbox = {offsetX: 0, offsetY: 0};\r\n        this.playerRelative = 0;\r\n        this.health = 0;\r\n        this.type = \"projectile\";\r\n    }\r\n\r\n    orientation(target: any): void {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n    modifyHP(points: number): void {\r\n        this.active = false;\r\n    }\r\n\r\n    abstract syncToSAB(sharedView: Float32Array, base: number): void;\r\n    abstract update(player: basePlayer, config: BHConfig): void;\r\n\r\n}\r\n\r\nexport class playerProjectile extends baseProjectile {\r\n\r\n    private speed: number = 8;\r\n\r\n    constructor(x: number, y: number, inputState: any, config: BHConfig) {\r\n        super(x, y);\r\n        this.active = true;\r\n        const dx = config.width*inputState.mouseX - this.x;\r\n        const dy = config.height*inputState.mouseY - this.y;\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n        this.vx = Math.cos(this.playerRelative) * this.speed;\r\n        this.vy = Math.sin(this.playerRelative) * this.speed;\r\n        this.damage = -20;\r\n        this.height = 20;\r\n        this.width = 20;\r\n        this.type = \"bullet\";\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        this.x += this.vx;\r\n        this.y += this.vy;\r\n        if (this.x < 0 || this.x > config.width\r\n            || this.y < 0 || this.y > config.height) {\r\n            this.active = false;\r\n        }\r\n    }\r\n\r\n    collided(entity: baseEntity[]) {\r\n        //this does NOT handle when projectiles are bigger than the entity\r\n        for (const holder of entity) {\r\n            if (!this.active) break;\r\n            if (!holder.active) continue;\r\n            if (this.x < holder.x + holder.width && this.x + this.width > holder.x &&\r\n                this.y < holder.y + holder.height && this.y + this.height > holder.y) {\r\n                holder.modifyHP(this.damage);\r\n                this.active = false;\r\n            }\r\n            if (holder.health <= 0) holder.active = false;\r\n        }\r\n    }\r\n\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.width;\r\n        sharedView[base + 3] = this.height;\r\n        sharedView[base + 4] = this.seed;\r\n    }\r\n}\r\n\r\nexport class enemyProjectile extends baseProjectile {\r\n\r\n    private speed: number = 8;\r\n\r\n    constructor(x: number, y: number, playerX: number, playerY: number) {\r\n        super(x, y);\r\n        this.active = true;\r\n        const dx = playerX - this.x;\r\n        const dy = playerY - this.y;\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n        this.vx = Math.cos(this.playerRelative) * this.speed;\r\n        this.vy = Math.sin(this.playerRelative) * this.speed;\r\n        this.damage = -20;\r\n        this.height = 20;\r\n        this.width = 20;\r\n        this.type = \"onebullet\";\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        this.x += this.vx;\r\n        this.y += this.vy;\r\n        if (this.x < 0 || this.x > config.width\r\n            || this.y < 0 || this.y > config.height) {\r\n            this.active = false;\r\n        }\r\n    }\r\n\r\n    collided(entity: basePlayer) {\r\n        //this does NOT handle when projectiles are bigger than the entity\r\n        if (!this.active) return;\r\n        if (this.x < entity.x + entity.width && this.x + this.width > entity.x &&\r\n            this.y < entity.y + entity.height && this.y + this.height > entity.y) {\r\n            entity.modifyHp(this.damage);\r\n            this.active = false;\r\n        }\r\n    }\r\n\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.width;\r\n        sharedView[base + 3] = this.height;\r\n        sharedView[base + 4] = this.seed;\r\n    }\r\n}","// src/features/BulletTest/interfaces/baseInterfaces/basePlayer.ts\r\nimport { IPlayer } from '../IPlayer';\r\nimport { BHConfig } from \"../../model/BHConfig\";\r\nimport { IHitbox } from \"../IEntity\";\r\nimport { playerProjectile } from \"./baseProjectile\";\r\n\r\nexport class basePlayer implements IPlayer {\r\n    private static instance: basePlayer;\r\n    active: boolean;\r\n    height: number;\r\n    hitbox: IHitbox;\r\n    hp: number;\r\n    health: number;\r\n    moveSpeed: number;\r\n    vx: number;\r\n    vy: number;\r\n    width: number;\r\n    seed: number;\r\n    playerRelative: number;\r\n    x: number;\r\n    y: number;\r\n    type: string;\r\n\r\n    private currentFrame: number = 0;\r\n    private lastHitFrame: number = 0;\r\n    private bulletTime: number = Date.now();\r\n    private fireFlag: boolean = false;\r\n    private config: any;\r\n\r\n    private constructor() {\r\n        this.active = true;\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.vx = 0;\r\n        this.vy = 0;\r\n        this.playerRelative = 0;\r\n        this.hitbox = { offsetX: 0, offsetY: 0 };\r\n        this.height = 30;\r\n        this.width = 30;\r\n        this.hp = 100;\r\n        this.health = 100;\r\n        this.moveSpeed = 0;\r\n        this.seed = Math.random() * 1000;\r\n        this.type = \"player\";\r\n    }\r\n\r\n    public static getInstance(): basePlayer {\r\n        if (!basePlayer.instance) {\r\n            basePlayer.instance = new basePlayer();\r\n        }\r\n        return basePlayer.instance;\r\n    }\r\n\r\n    public applyConfig(config: BHConfig): void {\r\n        this.config = config;\r\n        this.hp = config.initialHP;\r\n        this.health = config.initialHP;\r\n        this.x = config.heroStartX;\r\n        this.y = config.heroStartY;\r\n        this.moveSpeed = config.moveSpeed;\r\n    }\r\n\r\n    public setMovement(vx?: number, vy?: number): void {\r\n        if (vx !== undefined) this.vx = vx;\r\n        if (vy !== undefined) this.vy = vy;\r\n    }\r\n\r\n    public modifyHp(amount: number): void {\r\n        this.hp = Math.max(0, Math.min(100, this.hp + amount));\r\n        this.health = this.hp;\r\n        if (amount < 0) this.triggerHitCooldown();\r\n    }\r\n\r\n    public modifyHP(points: number): void {\r\n        this.modifyHp(points);\r\n    }\r\n\r\n    public triggerHitCooldown(): void {\r\n        this.lastHitFrame = this.currentFrame;\r\n    }\r\n\r\n    public playerAction(): boolean {\r\n        const chalEnd = this.fireFlag;\r\n        this.fireFlag = false;\r\n        return chalEnd;\r\n    }\r\n\r\n    public fireProjectile(inputState: any, config: BHConfig): playerProjectile {\r\n        return new playerProjectile(this.x, this.y, inputState, config);\r\n    }\r\n\r\n    public updatePlayer(inputState: any, config: BHConfig, frameCount: number): void {\r\n        this.currentFrame = frameCount;\r\n        this.update(inputState, config);\r\n    }\r\n\r\n    public update(inputState: any, config: BHConfig): void {\r\n        const actions = inputState.actions;\r\n        if (actions === undefined) return;\r\n        let targetVx = 0;\r\n        let targetVy = 0;\r\n\r\n        if (actions.includes('MOVE_UP')) targetVy = -this.moveSpeed;\r\n        if (actions.includes('MOVE_DOWN')) targetVy = this.moveSpeed;\r\n        if (actions.includes('MOVE_LEFT')) targetVx = -this.moveSpeed;\r\n        if (actions.includes('MOVE_RIGHT')) targetVx = this.moveSpeed;\r\n\r\n        if (inputState.isMouseDown && this.bulletTime + 250 < Date.now()) {\r\n            this.bulletTime = Date.now();\r\n            this.fireFlag = true;\r\n        }\r\n\r\n        this.setMovement(targetVx, targetVy);\r\n\r\n        if (this.currentFrame - this.lastHitFrame > 120 && this.hp < 100) {\r\n            this.hp = Math.min(100, this.hp + (this.hp < 25 ? 0.3 : 0.1));\r\n            this.health = this.hp;\r\n        }\r\n\r\n        this.x = Math.max(0, Math.min(this.config.width, this.x + this.vx));\r\n        this.y = Math.max(0, Math.min(this.config.height, this.y + this.vy));\r\n    }\r\n\r\n    public orientation(target: any): void {\r\n        // Player doesn't need orientation toward itself\r\n    }\r\n\r\n    public syncToSAB(sharedView: Float32Array, base: number): void {\r\n        // Player sync is handled directly in BHTestLogic.syncToSAB\r\n    }\r\n}","// src/features/BulletTest/interfaces/baseInterfaces/baseEntity.ts\r\nimport { IEntity, IHitbox } from \"../IEntity\";\r\nimport { IContactEnemy } from \"../IEnemy\";\r\nimport { IRangedEnemy } from \"../IEnemy\";\r\nimport { basePlayer } from \"./basePlayer\";\r\nimport { BHConfig } from \"../../model/BHConfig\";\r\nimport { enemyProjectile } from \"./baseProjectile\";\r\n\r\nexport abstract class baseEntity implements IEntity {\r\n    active: boolean;\r\n    height: number;\r\n    playerRelative: number;\r\n    hitbox: IHitbox;\r\n    seed: number;\r\n    width: number;\r\n    health: number;\r\n    x: number;\r\n    y: number;\r\n    vx: number;\r\n    vy: number;\r\n    type: string;\r\n    currentFrame: number;\r\n\r\n    protected constructor() {\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.vx = 0;\r\n        this.vy = 0;\r\n        this.health = 0;\r\n        this.hitbox = { offsetX: 0, offsetY: 0 };\r\n        this.height = 0;\r\n        this.width = 0;\r\n        this.seed = Math.random() * 1000;\r\n        this.active = false;\r\n        this.playerRelative = 0;\r\n        this.type = \"unknown\";\r\n        this.currentFrame = 0;\r\n    }\r\n\r\n    abstract update(player: basePlayer, config: BHConfig): void;\r\n    abstract orientation(player: basePlayer): void;\r\n    abstract syncToSAB(sharedView: Float32Array, base: number): void;\r\n\r\n    modifyHP(points: number) {\r\n        if (this.active) {\r\n            this.health += points;\r\n        }\r\n        if (this.health < 0) {\r\n            this.active = false;\r\n        }\r\n    }\r\n}\r\n\r\nexport class RockEntity extends baseEntity implements IContactEnemy {\r\n    damageType: 'contact' = 'contact';\r\n    hp: number = 0;\r\n    maxHp: number = 0;\r\n    moveSpeed: number = 0;\r\n    contactDamage: number = 0.2;\r\n    wave: number = 0;\r\n\r\n    private timeElapsed: number;\r\n    private atkBox: { eX: number, eY: number };\r\n    private followRun: boolean;\r\n    private primedMode: boolean;\r\n\r\n    constructor(x: number, y: number) {\r\n        super();\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = 50;\r\n        this.height = 52;\r\n        this.health = 100;\r\n        this.hp = 100;\r\n        this.maxHp = 100;\r\n        this.timeElapsed = Date.now() + Math.random() * 1000;\r\n        this.atkBox = { eX: 0, eY: 0 };\r\n        this.followRun = false;\r\n        this.primedMode = false;\r\n        this.active = true;\r\n        this.type = \"rock\";\r\n    }\r\n\r\n    applySpawnConfig(hp: number, moveSpeed: number, contactDamage: number, wave: number): void {\r\n        this.hp = hp;\r\n        this.maxHp = hp;\r\n        this.health = hp;\r\n        this.moveSpeed = moveSpeed;\r\n        this.contactDamage = contactDamage;\r\n        this.wave = wave;\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        this.orientation(player);\r\n        this.processRock(player, config);\r\n        this.processRockAttacks(player, config);\r\n        this.currentFrame += 0.05;\r\n    }\r\n\r\n    orientation(player: basePlayer): void {\r\n        const dx = this.x - player.x;\r\n        const dy = this.y - player.y;\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n    }\r\n\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.seed;\r\n        sharedView[base + 3] = this.primedMode ? 1 : 0;\r\n        sharedView[base + 4] = this.atkBox.eX;\r\n        sharedView[base + 5] = this.atkBox.eY;\r\n        sharedView[base + 6] = this.width;\r\n        sharedView[base + 7] = this.height;\r\n        sharedView[base + 8] = this.currentFrame;\r\n        sharedView[base + 9] = 0; //contact\r\n    }\r\n\r\n    private processRock(player: basePlayer, config: BHConfig): void {\r\n        if (this.primedMode) return;\r\n        const dx = this.x - player.x;\r\n        const dy = this.y - player.y;\r\n        const distance = dx * dx + dy * dy;\r\n        const sqDistance = Math.floor(Math.sqrt(dx * dx + dy * dy));\r\n        const speed = this.moveSpeed > 0 ? this.moveSpeed : config.moveSpeed - 1;\r\n\r\n        this.followRun = sqDistance >= 200 && sqDistance <= 250;\r\n\r\n        if (this.followRun) {\r\n            this.vx *= 0;\r\n            this.vy *= 0;\r\n        } else {\r\n            this.vx = Math.floor(Math.abs(Math.cos(this.playerRelative)*speed));\r\n            this.vy = Math.floor(Math.abs(Math.sin(this.playerRelative)*speed));\r\n            if (sqDistance >= 200) {\r\n                this.vx *= dx > 0 ? -1 : 1;\r\n                this.vy *= dy > 0 ? -1 : 1;\r\n            }\r\n            if (sqDistance <= 250) {\r\n                this.vx *= dx > 0 ? 1 : -1;\r\n                this.vy *= dy > 0 ? 1 : -1;\r\n            }\r\n        }\r\n\r\n        this.vx = this.x <= 0 ? 1 : this.vx;\r\n        this.vx = this.x >= config.width ? -1 : this.vx;\r\n        this.vy = this.y <= 0 ? 1 : this.vy;\r\n        this.vy = this.y >= config.height ? -1 : this.vy;\r\n\r\n        this.x += this.vx;\r\n        this.y += this.vy;\r\n\r\n        if (distance < 1600) {\r\n            this.vx *= -1;\r\n            this.vy *= -1;\r\n            player.modifyHp(-this.contactDamage);\r\n            self.postMessage({ type: 'EVENT', name: 'EXPLOSION_REQ' });\r\n        }\r\n    }\r\n\r\n    private processRockAttacks(player: basePlayer, config: BHConfig): void {\r\n        const timeMili = (Date.now() - this.timeElapsed);\r\n        if (timeMili > 5000 && !this.primedMode) {\r\n            this.primedMode = true;\r\n            this.atkBox = { eX: player.x, eY: player.y };\r\n        }\r\n\r\n        if (this.primedMode && timeMili > 7000) {\r\n            const slope = (this.atkBox.eY - this.y) / (this.atkBox.eX - this.x);\r\n            const regnum = this.y - (slope * this.x);\r\n            const top = Math.abs(slope * player.x + -1 * player.y + regnum);\r\n            const bot = Math.sqrt(slope * slope + 1);\r\n            const distanceLines = top / bot;\r\n\r\n            if (distanceLines < 30\r\n                && Math.min(this.atkBox.eX, this.x) <= player.x && player.x <= Math.max(this.atkBox.eX, this.x)\r\n                && Math.min(this.atkBox.eY, this.y) <= player.y && player.y <= Math.max(this.atkBox.eY, this.y)) {\r\n                player.modifyHp(-10);\r\n            }\r\n            this.timeElapsed = Date.now();\r\n            this.primedMode = false;\r\n            this.atkBox = { eX: 0, eY: 0 };\r\n        }\r\n    }\r\n}\r\n\r\nexport class ShotEntity extends baseEntity implements IRangedEnemy {\r\n    damageType: 'ranged' = 'ranged';\r\n    hp: number = 0;\r\n    maxHp: number = 0;\r\n    moveSpeed: number = 0;\r\n    fireRate: number = 5000;\r\n    lastShotFrame: number = 0;\r\n    projectileDamage: number = 20;\r\n    wave: number = 0;\r\n\r\n    private timeElapsed: number;\r\n    private followRun: boolean;\r\n    private primedMode: boolean;\r\n\r\n    constructor(x: number, y: number) {\r\n        super();\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = 50;\r\n        this.height = 52;\r\n        this.health = 100;\r\n        this.hp = 100;\r\n        this.maxHp = 100;\r\n        this.timeElapsed = Date.now() + Math.random() * 1000;\r\n        this.followRun = false;\r\n        this.primedMode = false;\r\n        this.active = true;\r\n        this.type = \"singleShot\";\r\n    }\r\n\r\n    applySpawnConfig(hp: number, moveSpeed: number, fireRate: number, projectileDamage: number, wave: number): void {\r\n        this.hp = hp;\r\n        this.maxHp = hp;\r\n        this.health = hp;\r\n        this.moveSpeed = moveSpeed;\r\n        this.fireRate = fireRate;\r\n        this.projectileDamage = projectileDamage;\r\n        this.wave = wave;\r\n    }\r\n\r\n    updateProjectile(player: basePlayer, config: BHConfig, currentShots: enemyProjectile[]): void {\r\n        this.update(player, config);\r\n        this.fireProjectiles(player, currentShots);\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        this.orientation(player);\r\n        this.processShot(player, config);\r\n        this.currentFrame += 0.05;\r\n    }\r\n\r\n    fireProjectiles(player: basePlayer, currentShots: enemyProjectile[]): void {\r\n        this.processShotAttacks(player, currentShots);\r\n    }\r\n\r\n    orientation(player: basePlayer): void {\r\n        const dx = this.x - player.x;\r\n        const dy = this.y - player.y;\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n    }\r\n\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.seed;\r\n        sharedView[base + 3] = this.primedMode ? 1 : 0;\r\n        // 4 and 5 are for atkBox in RockEntity, leaving empty here\r\n        sharedView[base + 6] = this.width;\r\n        sharedView[base + 7] = this.height;\r\n        sharedView[base + 8] = this.currentFrame;\r\n        sharedView[base + 9] = 1; //ranged\r\n    }\r\n\r\n    private processShot(player: basePlayer, config: BHConfig): void {\r\n        if (this.primedMode) return;\r\n        const dx = this.x - player.x;\r\n        const dy = this.y - player.y;\r\n        const distance = dx * dx + dy * dy;\r\n        const sqDistance = Math.floor(Math.sqrt(dx * dx + dy * dy));\r\n        const speed = this.moveSpeed > 0 ? this.moveSpeed : config.moveSpeed - 1;\r\n\r\n        this.followRun = sqDistance > 200 && sqDistance < 250;\r\n\r\n        if (this.followRun) {\r\n            this.vx *= 0;\r\n            this.vy *= 0;\r\n        } else {\r\n            this.vx = Math.floor(Math.abs(Math.cos(this.playerRelative)*speed));\r\n            this.vy = Math.floor(Math.abs(Math.sin(this.playerRelative)*speed));\r\n            if (sqDistance > 200) {\r\n                this.vx *= dx > 0 ? -1 : 1;\r\n                this.vy *= dy > 0 ? -1 : 1;\r\n            }\r\n            if (sqDistance < 250) {\r\n                this.vx *= dx > 0 ? 1 : -1;\r\n                this.vy *= dy > 0 ? 1 : -1;\r\n            }\r\n        }\r\n\r\n        this.vx = this.x <= 0 ? 1 : this.vx;\r\n        this.vx = this.x >= config.width ? -1 : this.vx;\r\n        this.vy = this.y <= 0 ? 1 : this.vy;\r\n        this.vy = this.y >= config.height ? -1 : this.vy;\r\n\r\n        this.x = Math.floor(this.x + this.vx);\r\n        this.y = Math.floor(this.y + this.vy);\r\n\r\n        if (distance < 1600) {\r\n            this.vx *= -1;\r\n            this.vy *= -1;\r\n            player.modifyHp(-0.2);\r\n            self.postMessage({ type: 'EVENT', name: 'EXPLOSION_REQ' });\r\n        }\r\n    }\r\n\r\n    private processShotAttacks(player: basePlayer, currentShots: enemyProjectile[]): void {\r\n        const timeMili = (Date.now() - this.timeElapsed);\r\n        if (timeMili > this.fireRate + Math.floor(Math.random() * 3000) && !this.primedMode) {\r\n            this.primedMode = true;\r\n        }\r\n\r\n        if (this.primedMode) {\r\n            currentShots.push(new enemyProjectile(this.x, this.y, player.x, player.y));\r\n            this.timeElapsed = Date.now();\r\n            this.primedMode = false;\r\n        }\r\n    }\r\n}","// src/features/BulletTest/interfaces/baseInterfaces/BossEntity.ts\r\nimport { baseEntity } from \"./baseEntity\";\r\nimport { IBossEnemy } from \"../IEnemy\";\r\nimport { basePlayer } from \"./basePlayer\";\r\nimport { enemyProjectile } from \"./baseProjectile\";\r\nimport { BHConfig } from \"../../model/BHConfig\";\r\n\r\nexport class BossEntity extends baseEntity implements IBossEnemy {\r\n    public vulnerable: boolean = false;\r\n    public phase: number = 1;\r\n\r\n    // Shooting\r\n    private lastShotFrame: number = 0;\r\n    private readonly phase1FireRate: number = 25;\r\n    private readonly phase2FireRate: number = 60;\r\n    private readonly phase2RingCount: number = 8;\r\n    private readonly phase3FireRate: number = 50;\r\n    private readonly phase3InnerCount: number = 8;\r\n    private readonly phase3OuterCount: number = 12;\r\n\r\n    // Bouncing (phase 3)\r\n    private bounceVx: number = 0;\r\n    private bounceVy: number = 0;\r\n    private readonly bounceSpeed: number = 1.5;\r\n    private bouncing: boolean = false;\r\n\r\n    constructor(x: number, y: number) {\r\n        super();\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = 200;\r\n        this.height = 200;\r\n        this.health = 300;\r\n        this.active = true;\r\n        this.type = \"boss\";\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        // Contact damage — always active while boss is alive\r\n        if (this.active) {\r\n            const cx = this.x + this.width / 2;\r\n            const cy = this.y + this.height / 2;\r\n            const dx = cx - player.x;\r\n            const dy = cy - player.y;\r\n            const dist = Math.sqrt(dx * dx + dy * dy);\r\n            const radius = this.width / 2;\r\n\r\n            if (dist < radius + player.width / 2) {\r\n                player.modifyHp(-0.5);\r\n                self.postMessage({ type: 'EVENT', name: 'EXPLOSION_REQ' });\r\n            }\r\n        }\r\n\r\n        // Bouncing — only phase 3\r\n        if (this.phase < 3) return;\r\n\r\n        if (!this.bouncing) {\r\n            this.bouncing = true;\r\n            const angle = Math.random() * Math.PI * 2;\r\n            this.bounceVx = Math.cos(angle) * this.bounceSpeed;\r\n            this.bounceVy = Math.sin(angle) * this.bounceSpeed;\r\n        }\r\n\r\n        this.x += this.bounceVx;\r\n        this.y += this.bounceVy;\r\n\r\n        if (this.x <= 0) { this.x = 0; this.bounceVx *= -1; }\r\n        if (this.x + this.width >= config.width) { this.x = config.width - this.width; this.bounceVx *= -1; }\r\n        if (this.y <= 0) { this.y = 0; this.bounceVy *= -1; }\r\n        if (this.y + this.height >= config.height) { this.y = config.height - this.height; this.bounceVy *= -1; }\r\n    }\r\n\r\n    updateAttacks(player: basePlayer, frameCount: number, enemyProjectiles: enemyProjectile[]): void {\r\n        if (!this.active || !this.vulnerable) return;\r\n\r\n        const fireRate = this.phase === 1 ? this.phase1FireRate\r\n            : this.phase === 2 ? this.phase2FireRate\r\n                : this.phase3FireRate;\r\n\r\n        if (frameCount - this.lastShotFrame < fireRate) return;\r\n        this.lastShotFrame = frameCount;\r\n\r\n        const cx = this.x + this.width / 2;\r\n        const cy = this.y + this.height / 2;\r\n\r\n        if (this.phase === 1) {\r\n            enemyProjectiles.push(new enemyProjectile(cx, cy, player.x, player.y));\r\n        } else if (this.phase === 2) {\r\n            this.fireRing(cx, cy, this.phase2RingCount, 0, 8, player.x, player.y, enemyProjectiles);\r\n        } else {\r\n            this.fireRing(cx, cy, this.phase3InnerCount, 0, 8, player.x, player.y, enemyProjectiles);\r\n            const offsetAngle = Math.PI / this.phase3OuterCount;\r\n            this.fireRing(cx, cy, this.phase3OuterCount, offsetAngle, 5, player.x, player.y, enemyProjectiles);\r\n        }\r\n    }\r\n\r\n    private fireRing(\r\n        cx: number, cy: number,\r\n        count: number, angleOffset: number, speed: number,\r\n        playerX: number, playerY: number,\r\n        enemyProjectiles: enemyProjectile[]\r\n    ): void {\r\n        const baseAngle = Math.atan2(playerY - cy, playerX - cx);\r\n        const angleStep = (Math.PI * 2) / count;\r\n        for (let i = 0; i < count; i++) {\r\n            const angle = baseAngle + angleStep * i + angleOffset;\r\n            const targetX = cx + Math.cos(angle) * 1000;\r\n            const targetY = cy + Math.sin(angle) * 1000;\r\n            const proj = new enemyProjectile(cx, cy, targetX, targetY);\r\n            proj.vx = Math.cos(angle) * speed;\r\n            proj.vy = Math.sin(angle) * speed;\r\n            enemyProjectiles.push(proj);\r\n        }\r\n    }\r\n\r\n    orientation(player: basePlayer): void {\r\n        const dx = this.x + this.width / 2 - player.x;\r\n        const dy = this.y + this.height / 2 - player.y;\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n    }\r\n\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.seed;\r\n        sharedView[base + 3] = this.vulnerable ? 1 : 0;\r\n        sharedView[base + 4] = this.health;\r\n    }\r\n\r\n    modifyHP(points: number) {\r\n        if (this.active && this.vulnerable) {\r\n            this.health += points;\r\n        }\r\n        if (this.health <= 0) {\r\n            this.active = false;\r\n        }\r\n    }\r\n}","// src/features/BulletTest/logic/WaveManager.ts\r\nimport { IEnemySpawn, IContactEnemySpawn, IRangedEnemySpawn } from '../interfaces/IEnemy';\r\nimport { IWaveDefinition } from '../interfaces/IRoom';\r\nimport { BHConfig } from '../model/BHConfig';\r\nimport { baseEntity, RockEntity, ShotEntity } from '../interfaces/baseInterfaces/baseEntity';\r\n\r\nexport type WaveState = 'IDLE' | 'DELAY' | 'ACTIVE' | 'CLEARED' | 'ALL_CLEARED';\r\n\r\nexport class WaveManager {\r\n    private waveDefinitions: IWaveDefinition[] = [];\r\n    private currentWave: number = -1;\r\n    private waveState: WaveState = 'IDLE';\r\n    private delayTimer: number = 0;\r\n    private totalWaves: number = 0;\r\n\r\n    public loadWaves(waves: IWaveDefinition[]): void {\r\n        this.waveDefinitions = waves;\r\n        this.totalWaves = waves.length;\r\n        this.currentWave = -1;\r\n        this.waveState = 'IDLE';\r\n        this.delayTimer = 0;\r\n    }\r\n\r\n    public start(): void {\r\n        this.currentWave = 0;\r\n        this.waveState = 'DELAY';\r\n        this.delayTimer = this.waveDefinitions[0]?.delayBeforeStart ?? 60;\r\n    }\r\n\r\n    public update(activeEnemyCount: number): IEnemySpawn[] | null {\r\n        if (this.waveState === 'IDLE' || this.waveState === 'ALL_CLEARED') {\r\n            return null;\r\n        }\r\n\r\n        if (this.waveState === 'DELAY') {\r\n            this.delayTimer--;\r\n            if (this.delayTimer <= 0) {\r\n                this.waveState = 'ACTIVE';\r\n                const waveDef = this.waveDefinitions[this.currentWave];\r\n                if (waveDef) {\r\n                    return waveDef.enemies;\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (this.waveState === 'ACTIVE') {\r\n            if (activeEnemyCount <= 0) {\r\n                this.waveState = 'CLEARED';\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (this.waveState === 'CLEARED') {\r\n            return null;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public nextWave(): void {\r\n        if (this.waveState !== 'CLEARED') return;\r\n\r\n        if (this.currentWave + 1 >= this.totalWaves) {\r\n            this.waveState = 'ALL_CLEARED';\r\n        } else {\r\n            this.currentWave++;\r\n            this.waveState = 'DELAY';\r\n            this.delayTimer = this.waveDefinitions[this.currentWave]?.delayBeforeStart ?? 60;\r\n        }\r\n    }\r\n\r\n    public static spawnFromDefinitions(\r\n        spawns: IEnemySpawn[],\r\n        config: BHConfig,\r\n        waveIndex: number\r\n    ): baseEntity[] {\r\n        const entities: baseEntity[] = [];\r\n        for (const spawn of spawns) {\r\n            const x = spawn.spawnX * config.width;\r\n            const y = spawn.spawnY * config.height;\r\n\r\n            if (spawn.damageType === 'contact') {\r\n                const contactSpawn = spawn as IContactEnemySpawn;\r\n                const entity = new RockEntity(x, y);\r\n                entity.applySpawnConfig(\r\n                    contactSpawn.hp,\r\n                    contactSpawn.moveSpeed,\r\n                    contactSpawn.contactDamage,\r\n                    waveIndex\r\n                );\r\n                entities.push(entity);\r\n            } else if (spawn.damageType === 'ranged') {\r\n                const rangedSpawn = spawn as IRangedEnemySpawn;\r\n                const entity = new ShotEntity(x, y);\r\n                entity.applySpawnConfig(\r\n                    rangedSpawn.hp,\r\n                    rangedSpawn.moveSpeed,\r\n                    rangedSpawn.fireRate,\r\n                    rangedSpawn.projectileDamage,\r\n                    waveIndex\r\n                );\r\n                entities.push(entity);\r\n            }\r\n        }\r\n        return entities;\r\n    }\r\n\r\n    public getCurrentWave(): number {\r\n        return Math.max(0, this.currentWave);\r\n    }\r\n\r\n    public getTotalWaves(): number {\r\n        return this.totalWaves;\r\n    }\r\n\r\n    public getState(): WaveState {\r\n        return this.waveState;\r\n    }\r\n\r\n    public getDelayTimer(): number {\r\n        return this.delayTimer;\r\n    }\r\n\r\n    public isAllCleared(): boolean {\r\n        return this.waveState === 'ALL_CLEARED';\r\n    }\r\n\r\n    public getSnapshot(): any {\r\n        return {\r\n            currentWave: this.currentWave,\r\n            waveState: this.waveState,\r\n            delayTimer: this.delayTimer,\r\n            totalWaves: this.totalWaves\r\n        };\r\n    }\r\n\r\n    public loadSnapshot(data: any): void {\r\n        if (!data) return;\r\n        this.currentWave = data.currentWave ?? -1;\r\n        this.waveState = data.waveState ?? 'IDLE';\r\n        this.delayTimer = data.delayTimer ?? 0;\r\n        this.totalWaves = data.totalWaves ?? 0;\r\n    }\r\n}","// src/features/BulletTest/logic/BHTestLogic.ts\r\nimport { BHMainLogicSchema, BHRocksLogicSchema, BHPProjLogicSchema, BHEProjLogicSchema } from '../model/BHLogicSchema';\r\nimport { BaseLogic } from '../../../core/templates/BaseLogic';\r\nimport { BaseDispatcher } from '../../../core/templates/BaseDispatcher';\r\nimport { BHCommands } from './BHCommands';\r\nimport { BHConfig } from '../model/BHConfig';\r\nimport { basePlayer } from '../interfaces/baseInterfaces/basePlayer';\r\nimport {baseEntity, ShotEntity} from '../interfaces/baseInterfaces/baseEntity';\r\nimport {BossEntity} from '../interfaces/baseInterfaces/BossEntity';\r\nimport {enemyProjectile, playerProjectile} from '../interfaces/baseInterfaces/baseProjectile';\r\nimport { WaveManager } from './WaveManager';\r\nimport { IWaveDefinition } from '../interfaces/IRoom';\r\nimport waveData from '../data/bh_waves.json';\r\n\r\ninterface WaveLevelData {\r\n    waves: IWaveDefinition[];\r\n}\r\n\r\nexport class BHTestLogic extends BaseLogic<BHConfig> {\r\n    protected dispatcher: BaseDispatcher<BHTestLogic>;\r\n    private player: basePlayer;\r\n    private entities: baseEntity[] = [];\r\n    private playerProjectiles: playerProjectile[] = [];\r\n    private enemyProjectiles: enemyProjectile[] = [];\r\n    private currentFrame: number = 0;\r\n\r\n    // Boss system\r\n    private boss: BossEntity | null = null;\r\n    private bossLevel: boolean = false;\r\n    private bossTargetHp: number = 3;\r\n\r\n    // Wave system\r\n    private waveManager: WaveManager = new WaveManager();\r\n    private wavesStarted: boolean = false;\r\n\r\n    // Exit door\r\n    private exitDoorActive: boolean = false;\r\n    private exitDoorX: number = 0;\r\n    private exitDoorY: number = 0;\r\n    private static readonly DOOR_SIZE = 60;\r\n    private exitDoorEntered: boolean = false;\r\n\r\n    constructor() {\r\n        super(BHMainLogicSchema.REVISION);\r\n        this.dispatcher = new BaseDispatcher(this, BHCommands, \"BHTest\");\r\n        this.player = basePlayer.getInstance();\r\n    }\r\n\r\n    public applyConfig(config: BHConfig): void {\r\n        this.config = config;\r\n        this.player.applyConfig(config);\r\n\r\n        // Load wave definitions from the JSON based on level\r\n        const levelKey = config.levelLabel || \"Level 1\";\r\n        const levelWaves = (waveData as Record<string, WaveLevelData>)[levelKey];\r\n\r\n        if (levelWaves && levelWaves.waves) {\r\n            this.waveManager.loadWaves(levelWaves.waves);\r\n        } else {\r\n            console.warn(`[BHTestLogic] No wave data for \"${levelKey}\", using empty waves`);\r\n            this.waveManager.loadWaves([]);\r\n        }\r\n\r\n        // Reset entities for fresh start\r\n        this.entities = [];\r\n        this.playerProjectiles = [];\r\n        this.enemyProjectiles = [];\r\n        this.wavesStarted = false;\r\n        this.exitDoorActive = false;\r\n        this.exitDoorEntered = false;\r\n        this.exitDoorX = config.width / 2;\r\n        this.exitDoorY = config.height / 2;\r\n\r\n        const levelLabel = this.config!.levelLabel || \"Level 1\";\r\n        this.bossLevel = levelLabel === \"Level 4\";\r\n        if (this.bossLevel) {\r\n            this.boss = new BossEntity(config.width / 2 - 100, 50);\r\n            this.bossTargetHp = 200; // Vulnerable after wave 1 until hits 200, then wave 2...\r\n        } else {\r\n            this.boss = null;\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n        this.entities = [];\r\n        this.playerProjectiles = [];\r\n        this.enemyProjectiles = [];\r\n        this.wavesStarted = false;\r\n        this.boss = null;\r\n        this.bossLevel = false;\r\n    }\r\n\r\n    public override getSnapshot(): any {\r\n        return {\r\n            player: { ...this.player },\r\n            entities: [...this.entities],\r\n            playerProjectiles: [...this.playerProjectiles],\r\n            enemyProjectiles: [...this.enemyProjectiles],\r\n            currentFrame: this.currentFrame,\r\n            config: this.config,\r\n            waveSnapshot: this.waveManager.getSnapshot(),\r\n            wavesStarted: this.wavesStarted\r\n        };\r\n    }\r\n\r\n    public override loadSnapshot(data: any): void {\r\n        if (!data) return;\r\n        this.config = data.config;\r\n        this.player = data.player;\r\n        this.entities = data.entities;\r\n        this.playerProjectiles = data.playerProjectiles;\r\n        this.enemyProjectiles = data.enemyProjectiles;\r\n        this.currentFrame = data.currentFrame ?? 0;\r\n        this.wavesStarted = data.wavesStarted ?? false;\r\n        if (data.waveSnapshot) {\r\n            this.waveManager.loadSnapshot(data.waveSnapshot);\r\n        }\r\n        this.isInitialized = true;\r\n    }\r\n\r\n    protected onUpdate(sharedView: Float32Array, intView: Int32Array, frameCount: number, fps: number): void {\r\n        if (!this.config) return;\r\n        this.currentFrame = frameCount;\r\n\r\n        // Start waves on first update if not already started\r\n        if (!this.wavesStarted) {\r\n            this.waveManager.start();\r\n            this.wavesStarted = true;\r\n        }\r\n\r\n        // Update wave manager - it checks if current wave is cleared and returns spawns for next wave\r\n        const activeEnemyCount = this.entities.filter(e => e.active).length;\r\n        const newSpawns = this.waveManager.update(activeEnemyCount);\r\n\r\n        // Transition waves automatically for non-boss levels\r\n        if (!this.bossLevel && this.waveManager.getState() === 'CLEARED') {\r\n            this.waveManager.nextWave();\r\n        }\r\n\r\n        // Boss logic\r\n        if (this.bossLevel && this.boss) {\r\n            const waveState = this.waveManager.getState();\r\n\r\n            // Always update phase based on current wave\r\n            this.boss.phase = Math.min(3, this.waveManager.getCurrentWave() + 1);\r\n\r\n            if (activeEnemyCount > 0 || waveState === 'ACTIVE' || waveState === 'DELAY') {\r\n                this.boss.vulnerable = false;\r\n            } else if (waveState === 'CLEARED' || waveState === 'ALL_CLEARED') {\r\n                if (this.boss.health > this.bossTargetHp) {\r\n                    this.boss.vulnerable = true;\r\n                } else if (this.boss.vulnerable) {\r\n                    this.boss.vulnerable = false;\r\n                    this.bossTargetHp -= 100;\r\n                    if (waveState === 'CLEARED') {\r\n                        this.waveManager.nextWave();\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Always update movement and attacks\r\n            this.boss.update(this.player, this.config);\r\n            this.boss.updateAttacks(this.player, frameCount, this.enemyProjectiles);\r\n        }\r\n\r\n        if (newSpawns) {\r\n            const newEntities = WaveManager.spawnFromDefinitions(newSpawns, this.config, this.waveManager.getCurrentWave());\r\n            this.entities.push(...newEntities);\r\n        }\r\n\r\n        // Update player\r\n        (this.player as basePlayer).updatePlayer(this.inputState, this.config, frameCount);\r\n\r\n        // Update existing entities\r\n        for (const entity of this.entities) {\r\n            if (entity.type === \"singleShot\") {\r\n                const typeCast : ShotEntity = entity as unknown as ShotEntity;\r\n                typeCast.updateProjectile(this.player, this.config, this.enemyProjectiles);\r\n            }\r\n            entity.update(this.player, this.config);\r\n        }\r\n\r\n        // Handle player shooting\r\n        if ((this.player as basePlayer).playerAction()) {\r\n            this.playerProjectiles.push(\r\n                (this.player as basePlayer).fireProjectile(this.inputState, this.config)\r\n            );\r\n        }\r\n\r\n        // Update projectiles and check collisions\r\n        for (const proj of this.playerProjectiles) {\r\n            proj.update(this.player, this.config);\r\n            proj.collided(this.entities);\r\n            if (this.boss) {\r\n                proj.collided([this.boss]);\r\n            }\r\n        }\r\n\r\n        // Update projectiles and check collisions\r\n        for (const proj of this.enemyProjectiles) {\r\n            proj.update(this.player, this.config);\r\n            proj.collided(this.player);\r\n            console.log(\"Running Projectiles... \" + proj.active)\r\n        }\r\n\r\n        // Clean up dead entities and expired projectiles\r\n        this.playerProjectiles = this.playerProjectiles.filter(proj => proj.active);\r\n        this.enemyProjectiles = this.enemyProjectiles.filter(proj => proj.active);\r\n        this.entities = this.entities.filter(entity => entity.active);\r\n\r\n        // Check player death\r\n        if (this.player.hp <= 0) {\r\n            self.postMessage({ type: 'EVENT', name: 'PLAYER_DEAD' });\r\n        }\r\n\r\n        // Emit room cleared event when all waves done\r\n        const bossCleared = this.bossLevel ? (this.boss && !this.boss.active) : true;\r\n        if (this.waveManager.isAllCleared() && this.entities.length === 0 && bossCleared) {\r\n            self.postMessage({ type: 'EVENT', name: 'ROOM_CLEARED' });\r\n\r\n            // Activate the exit door\r\n            if (!this.exitDoorActive) {\r\n                this.exitDoorActive = true;\r\n            }\r\n        }\r\n\r\n        // Check if player steps on the exit door\r\n        if (this.exitDoorActive && !this.exitDoorEntered) {\r\n            const halfDoor = BHTestLogic.DOOR_SIZE / 2;\r\n            const px = this.player.x;\r\n            const py = this.player.y;\r\n            if (\r\n                px >= this.exitDoorX - halfDoor && px <= this.exitDoorX + halfDoor &&\r\n                py >= this.exitDoorY - halfDoor && py <= this.exitDoorY + halfDoor\r\n            ) {\r\n                this.exitDoorEntered = true;\r\n                self.postMessage({ type: 'EVENT', name: 'EXIT_DOOR_ENTERED' });\r\n            }\r\n        }\r\n\r\n        this.syncToSAB(sharedView, frameCount, fps);\r\n    }\r\n\r\n    private syncToSAB(sMain: Float32Array, frameCount: number, fps: number): void {\r\n        const sRocks = this.sharedViews.get('rocks');\r\n        const sPProjs = this.sharedViews.get('pProjs');\r\n        const sEProjs = this.sharedViews.get('eProjs');\r\n\r\n        if (!sMain || !sRocks || !sPProjs || !sEProjs) return;\r\n\r\n        const M = BHMainLogicSchema;\r\n\r\n        sMain[M.HERO_HP] = this.player.hp;\r\n        sMain[M.HERO_X] = this.player.x;\r\n        sMain[M.HERO_Y] = this.player.y;\r\n        sMain[M.HERO_VX] = this.player.vx;\r\n        sMain[M.HERO_VY] = this.player.vy;\r\n        sMain[M.HERO_WIDTH] = this.player.width;\r\n        sMain[M.HERO_HEIGHT] = this.player.height;\r\n        sMain[M.FRAME_COUNT] = frameCount;\r\n        if (this.config) {\r\n            const dx = -this.config.width*this.inputState.mouseX + this.player.x;\r\n            const dy = -this.config.height*this.inputState.mouseY + this.player.y;\r\n            sMain[M.MOUSE_RELATIVE] = Math.atan2(dy, dx);\r\n            sMain[M.MAP_WIDTH] = this.config.width;\r\n            sMain[M.MAP_HEIGHT] = this.config.height;\r\n        }\r\n        sMain[M.FPS] = fps;\r\n\r\n        // Wave state info\r\n        sMain[M.CURRENT_WAVE] = this.waveManager.getCurrentWave();\r\n        sMain[M.TOTAL_WAVES] = this.waveManager.getTotalWaves();\r\n        sMain[M.WAVE_DELAY_TIMER] = this.waveManager.getDelayTimer();\r\n\r\n        // Encode wave state as a number: IDLE=0, DELAY=1, ACTIVE=2, CLEARED=3, ALL_CLEARED=4\r\n        const stateMap: Record<string, number> = {\r\n            'IDLE': 0, 'DELAY': 1, 'ACTIVE': 2, 'CLEARED': 3, 'ALL_CLEARED': 4\r\n        };\r\n        sMain[M.WAVE_STATE] = stateMap[this.waveManager.getState()] ?? 0;\r\n\r\n        // Exit door\r\n        sMain[M.EXIT_DOOR_ACTIVE] = this.exitDoorActive ? 1 : 0;\r\n        sMain[M.EXIT_DOOR_X] = this.exitDoorX;\r\n        sMain[M.EXIT_DOOR_Y] = this.exitDoorY;\r\n\r\n        // Encode current level: \"Level 1\"=0, \"Level 2\"=1, \"Level 3\"=2, \"Level 4\"=3\r\n        const levelLabel = this.config!.levelLabel || \"Level 1\";\r\n        const levelIndex = levelLabel === \"Level 4\" ? 3 : levelLabel === \"Level 3\" ? 2 : levelLabel === \"Level 2\" ? 1 : 0;\r\n        sMain[M.CURRENT_LEVEL] = levelIndex;\r\n\r\n        if (this.boss) {\r\n            sMain[M.BOSS_HP] = this.boss.health;\r\n            sMain[M.BOSS_VULNERABLE] = this.boss.vulnerable ? 1 : 0;\r\n            sMain[M.BOSS_X] = this.boss.x;\r\n            sMain[M.BOSS_Y] = this.boss.y;\r\n            sMain[M.BOSS_ACTIVE] = this.boss.active ? 1 : 0;\r\n        } else {\r\n            sMain[M.BOSS_HP] = 0;\r\n            sMain[M.BOSS_VULNERABLE] = 0;\r\n            sMain[M.BOSS_ACTIVE] = 0;\r\n        }\r\n\r\n        // Entities (Rocks)\r\n        const rockCapacity = Math.floor(sRocks.length / BHRocksLogicSchema.STRIDE);\r\n        const rockCount = Math.min(this.entities.length, rockCapacity);\r\n        sMain[M.ROCK_COUNT] = rockCount;\r\n        for (let i = 0; i < rockCount; i++) {\r\n            const base = i * BHRocksLogicSchema.STRIDE;\r\n            this.entities[i].syncToSAB(sRocks, base);\r\n        }\r\n\r\n        // Player projectiles\r\n        const pProjCapacity = Math.floor(sPProjs.length / BHPProjLogicSchema.STRIDE);\r\n        const pProjCount = Math.min(this.playerProjectiles.length, pProjCapacity);\r\n        sMain[M.PPROJ_COUNT] = pProjCount;\r\n        for (let i = 0; i < pProjCount; i++) {\r\n            const base = i * BHPProjLogicSchema.STRIDE;\r\n            this.playerProjectiles[i].syncToSAB(sPProjs, base);\r\n        }\r\n\r\n        // Enemy projectiles\r\n        const eProjCapacity = Math.floor(sEProjs.length / BHEProjLogicSchema.STRIDE);\r\n        const eProjCount = Math.min(this.enemyProjectiles.length, eProjCapacity);\r\n        sMain[M.EPROJ_COUNT] = eProjCount;\r\n        for (let i = 0; i < eProjCount; i++) {\r\n            const base = i * BHEProjLogicSchema.STRIDE;\r\n            this.enemyProjectiles[i].syncToSAB(sEProjs, base);\r\n        }\r\n    }\r\n}"],"names":["BHCommands","logic","payload","damage","baseProjectile","x","y","target","points","playerProjectile","inputState","config","dx","dy","player","entity","holder","sharedView","base","enemyProjectile","playerX","playerY","basePlayer","vx","vy","amount","chalEnd","frameCount","actions","targetVx","targetVy","baseEntity","RockEntity","hp","moveSpeed","contactDamage","wave","distance","sqDistance","speed","timeMili","slope","regnum","top","bot","ShotEntity","fireRate","projectileDamage","currentShots","BossEntity","cx","cy","dist","radius","angle","enemyProjectiles","offsetAngle","count","angleOffset","baseAngle","angleStep","i","targetX","targetY","proj","WaveManager","waves","activeEnemyCount","waveDef","spawns","waveIndex","entities","spawn","contactSpawn","rangedSpawn","data","BHTestLogic","BaseLogic","BHMainLogicSchema","BaseDispatcher","levelKey","levelWaves","waveData","levelLabel","intView","fps","e","newSpawns","waveState","newEntities","bossCleared","halfDoor","px","py","sMain","sRocks","sPProjs","sEProjs","M","stateMap","levelIndex","rockCapacity","BHRocksLogicSchema","rockCount","pProjCapacity","BHPProjLogicSchema","pProjCount","eProjCapacity","BHEProjLogicSchema","eProjCount"],"mappings":"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"}