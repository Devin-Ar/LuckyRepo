import{I as p,C,r,b as g,j as c,i as w,s as d,h as y,F as E,R as S}from"./index-SB0jwsSG.js";import{B as A}from"./BaseMenuController-CRgEou9J.js";import{m as f,G as I}from"./GameSprite-GkIwotE9.js";class M extends A{onUpdate;hasCompleted=!1;bind(e){this.onUpdate=e}onKeyDown(e){p.getInstance().isKeyAction(e.key,"UI_ACCEPT")&&this.exit()}async startSequence(e,t,a){try{await this.animateAlpha(0,1,e),await this.wait(t),await this.animateAlpha(1,0,a),this.exit()}catch{}}wait(e){return new Promise((t,a)=>{const i=setTimeout(t,e),n=()=>{this.hasCompleted?(clearTimeout(i),a()):requestAnimationFrame(n)};requestAnimationFrame(n)})}animateAlpha(e,t,a){return new Promise((i,n)=>{const m=performance.now(),l=h=>{if(this.hasCompleted){n();return}const o=h-m,u=Math.min(o/a,1),x=e+(t-e)*u;this.onUpdate?.(x),u<1?requestAnimationFrame(l):i()};requestAnimationFrame(l)})}exit(){this.hasCompleted||(this.hasCompleted=!0,this.onUpdate?.(0),C.getInstance().completeCurrentStep())}onBack(){this.exit()}}const v=({w:s,h:e})=>{const t=f.useApp();return r.useEffect(()=>{t?.renderer&&(t.renderer.resize(s,e),d.SCALE_MODE=w.NEAREST,d.ROUND_PIXELS=!0,t.view instanceof HTMLCanvasElement&&(t.view.width=s,t.view.height=e,t.view.style.imageRendering="pixelated"))},[t,s,e]),null},R=({controller:s,imageName:e,width:t=960,height:a=540})=>{const[i,n]=r.useState(0);r.useEffect(()=>{s.bind(n),s.startSequence(800,2500,800)},[s]);const m=r.useMemo(()=>({backgroundColor:0,antialias:!1,resolution:1,autoDensity:!1}),[]),l=r.useMemo(()=>({position:"absolute",inset:0,width:"100%",height:"100%",display:"block",imageRendering:"pixelated"}),[]),h=r.useMemo(()=>{const o=g.getInstance().getTexture(e);return o&&o.width>1?t/o.width:t/640},[e,t]);return c.jsx("div",{style:{position:"absolute",inset:0,background:"#000",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:c.jsx("div",{style:{position:"relative",width:"100%",height:"100%",maxWidth:"calc(100vh * (16 / 9))",maxHeight:"calc(100vw * (9 / 16))",aspectRatio:"16 / 9",background:"#000",overflow:"hidden"},children:c.jsxs(f.Stage,{width:t,height:a,options:m,style:l,children:[c.jsx(v,{w:t,h:a}),c.jsx(I,{imageName:e,x:t/2,y:a/2,anchor:.5,alpha:i,scale:h})]})})})};class T extends y{name=E.CINEMATIC;controller;params;constructor(e){super(),this.params=e||{},this.controller=new M}async init(){this.params.manifestPath&&await Promise.all([g.getInstance().loadManifest(this.params.manifestPath,this.name)]),p.getInstance().refreshBindings(this.name),this.isRendering=!0,this.controller.init(this.name)}update(e){}getView(){return S.createElement(R,{key:this.name,controller:this.controller,imageName:this.params.imageName})}destroy(){p.getInstance().refreshBindings(this.name),this.controller.destroy()}}export{T as CinematicState};
//# sourceMappingURL=CinematicState-BzUOX02Q.js.map
