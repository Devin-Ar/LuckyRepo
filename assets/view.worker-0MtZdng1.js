class p{loaders=new Map;register(i){this.loaders.set(i.id,i.loader)}async create(i){const t=this.loaders.get(i);if(!t)throw new Error(`WorkerRegistry: No loader registered for ID "${i}"`);const s=await t();return new s}}const L=new p,A=new p;var d=(e=>(e.GAME_1="Game1",e.GAME_2="Game2",e.GAME_3="Game3",e.BH_GAME="BHGame",e.DEV_MENU="DevMenu",e.PAUSE_MENU="PauseMenu",e.SAVE_MENU="SaveMenu",e.SETTINGS_MENU="SettingsMenu",e.CONTINUE="ContinueScreen",e.GAME_OVER="GameOverScreen",e))(d||{});const y={id:d.GAME_1,logicLoader:()=>import("./Game1Logic-BLTRHNl1.js").then(e=>e.Game1Logic),viewLoader:()=>import("./Game1ViewLogic-C-yug3dU.js").then(e=>e.Game1ViewLogic)},T={id:d.GAME_2,logicLoader:()=>import("./Game2Logic-B1dLFliD.js").then(e=>e.Game2Logic),viewLoader:()=>import("./Game2ViewLogic-CzviCqce.js").then(e=>e.Game2ViewLogic)},_={id:d.BH_GAME,logicLoader:()=>import("./BHTestLogic-BZ6YOjnD.js").then(e=>e.BHTestLogic),viewLoader:()=>import("./BHViewLogic-DyMB0qjI.js").then(e=>e.BHViewLogic)},S={id:d.GAME_3,logicLoader:()=>import("./Game3Logic-8uAUsKqs.js").then(e=>e.Game3Logic),viewLoader:()=>import("./Game3ViewLogic-DPkc8O56.js").then(e=>e.Game3ViewLogic)},m=[y,T,S,_],k=()=>{m.forEach(e=>{e.logicLoader&&L.register({id:e.id,loader:e.logicLoader}),e.viewLoader&&A.register({id:e.id,loader:e.viewLoader})})};k();const n=new Map,l=new Map,c=new Map,a=new Map,g=new Map;self.onmessage=async e=>{const{type:i,stateName:t,payload:s,dt:E,frameCount:h}=e.data;switch(i){case"INIT_SABS":console.log("[ViewWorker] Initializing Buffers"),n.clear(),l.clear(),c.clear(),s.inputBuffers&&Object.entries(s.inputBuffers).forEach(([r,o])=>{n.set(r,new Float32Array(o)),l.set(r,new Int32Array(o))}),s.outputBuffers&&Object.entries(s.outputBuffers).forEach(([r,o])=>{c.set(r,new Float32Array(o))}),a.forEach(r=>r.setBuffers?.(n,l,c));break;case"UPDATE_BUFFER":{const{name:r,buffer:o,isInput:M}=s;M?(n.set(r,new Float32Array(o)),l.set(r,new Int32Array(o))):c.set(r,new Float32Array(o)),a.forEach(G=>G.setBuffers?.(n,l,c));break}case"CREATE_STATE":if(!a.has(t))if(g.has(t))await g.get(t);else{const r=(async()=>{const o=await A.create(t);return o.setBuffers(n,l,c),o})();g.set(t,r);try{const o=await r;a.set(t,o),console.log(`[ViewWorker] Loaded View: ${t}`)}catch(o){console.error(`[ViewWorker] Failed to create view state: ${t}`,o)}finally{g.delete(t)}}break;case"TICK":const f=a.get(t);f&&n.size>0&&c.size>0&&f.update(E,h);break;case"TERMINATE_STATE":a.has(t)&&(a.get(t).destroy?.(),a.delete(t));break;case"TERMINATE_ALL":a.forEach(r=>r.destroy?.()),a.clear();break;case"INPUT":let w=a.get(t);if(!w&&g.has(t))try{w=await g.get(t)}catch{}if(!w)return;if(s.action==="GET_SNAPSHOT"){const r=e.ports[0];r&&r.postMessage(w.getSnapshot())}else s.action==="LOAD_SNAPSHOT"&&w.loadSnapshot(s.data);break}};
//# sourceMappingURL=view.worker-0MtZdng1.js.map
