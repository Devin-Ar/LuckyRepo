import{f as U,A as L,a as N,k as E,r as i,j as e,F as V,R as M}from"./index-SB0jwsSG.js";import{M as O}from"./MenuState-CvISWwXr.js";import{B as G}from"./BaseMenuController-CRgEou9J.js";class D extends G{session=U.getInstance();audio=L.getInstance();onRefreshBinds;registerBindRefresh(t){this.onRefreshBinds=t}onBack(){N.getInstance().pop()}getVolume(t){return this.session.get(`${t}_volume`)??.5}setVolume(t,o){this.session.set(`${t}_volume`,o),this.audio.setVolume(t,o)}getResolution(){return this.session.get("resolution")??"1080p"}setResolution(t){this.session.set("resolution",t)}async toggleFullscreen(){return document.fullscreenElement?(document.exitFullscreen&&await document.exitFullscreen(),!1):(await document.documentElement.requestFullscreen().catch(()=>{}),!0)}getRegistryProfiles(){return Object.keys(E)}getBindingsForGame(t){const o=E[t]||{},r=this.session.get(`bind_${t}`)||{},d={};for(const[f,m]of Object.entries(o))d[f]={label:m.label,keys:r[f]?[...r[f]]:[...m.keys]};return d}setBinding(t,o,r,d){this.input.setBinding(t,o,r,d),this.onRefreshBinds&&this.onRefreshBinds()}resetBindings(t){this.input.resetBindings(t),this.onRefreshBinds&&this.onRefreshBinds()}}const x={padding:"0.8cqw 2cqw",cursor:"pointer",border:"1px solid #00ff00",background:"#000",color:"#00ff00",fontWeight:"bold",fontFamily:"monospace"},u={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1cqw 1.5cqw",borderBottom:"1px solid #1a1a1a"},w={display:"flex",alignItems:"center",gap:"1.5cqw",minWidth:"20cqw",justifyContent:"flex-end"},S={cursor:"pointer",accentColor:"#00ff00",width:"12cqw"},b={backgroundColor:"#000",color:"#00ff00",border:"1px solid #00ff00",padding:"0.5cqw",fontFamily:"monospace",outline:"none"},P=({controller:n,res:t,setRes:o})=>{const[r,d]=i.useState("system"),[f,m]=i.useState(!!document.fullscreenElement),[C,B]=i.useState(t||n.getResolution()),[p,R]=i.useState({master:n.getVolume("master"),ost:n.getVolume("ost"),sfx:n.getVolume("sfx")}),[a,T]=i.useState("Shared"),[g,v]=i.useState(null),[F,k]=i.useState({}),h=i.useCallback(()=>{const s=n.getBindingsForGame(a);k(s)},[a,n]);i.useEffect(()=>{n.registerBindRefresh(h),h()},[h,n]),i.useEffect(()=>{if(!g)return;const s=l=>{l.preventDefault(),l.stopImmediatePropagation();const c=l.key.toUpperCase();n.setBinding(g.action,c,a,g.slot),v(null),h()};return window.addEventListener("keydown",s,!0),()=>window.removeEventListener("keydown",s,!0)},[g,n,h,a]);const y=(s,l)=>{R(c=>({...c,[s]:l})),n.setVolume(s,l)},I=s=>{B(s),n.setResolution(s),o&&o(s)},q=async()=>{const s=await n.toggleFullscreen();m(s)},_=()=>{n.resetBindings(a),h()};return e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1200},children:e.jsxs("div",{style:{width:"85%",height:"80%",background:"#050505",border:"2px solid #00ff00",padding:"2cqw",display:"flex",flexDirection:"column",color:"#00ff00",fontFamily:"monospace",containerType:"size"},children:[e.jsxs("div",{style:{display:"flex",gap:"2cqw",borderBottom:"2px solid #00ff00",marginBottom:"1cqw"},children:[e.jsx("h2",{onClick:()=>d("system"),style:{cursor:"pointer",opacity:r==="system"?1:.4,paddingBottom:"0.5cqw"},children:"[ SYSTEM_CONFIGURATION ]"}),e.jsx("h2",{onClick:()=>d("controls"),style:{cursor:"pointer",opacity:r==="controls"?1:.4,paddingBottom:"0.5cqw"},children:"[ INPUT_BINDINGS ]"})]}),e.jsx("div",{style:{flex:1,overflowY:"auto",paddingRight:"1cqw"},children:r==="system"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:u,children:[e.jsx("span",{children:"MASTER_OUTPUT_LEVEL"}),e.jsxs("div",{style:w,children:[e.jsxs("span",{children:[Math.round(p.master*100),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:p.master,onChange:s=>y("master",parseFloat(s.target.value)),style:S})]})]}),e.jsxs("div",{style:u,children:[e.jsx("span",{children:"OST_SEQUENCE_LEVEL"}),e.jsxs("div",{style:w,children:[e.jsxs("span",{children:[Math.round(p.ost*100),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:p.ost,onChange:s=>y("ost",parseFloat(s.target.value)),style:S})]})]}),e.jsxs("div",{style:u,children:[e.jsx("span",{children:"SFX_IMPULSE_LEVEL"}),e.jsxs("div",{style:w,children:[e.jsxs("span",{children:[Math.round(p.sfx*100),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:p.sfx,onChange:s=>y("sfx",parseFloat(s.target.value)),style:S})]})]}),e.jsxs("div",{style:u,children:[e.jsx("span",{children:"DISPLAY_RESOLUTION"}),e.jsx("select",{value:C,onChange:s=>I(s.target.value),style:b,children:["540p","720p","1080p","1440p","4k","fit"].map(s=>e.jsx("option",{value:s,children:s.toUpperCase()},s))})]}),e.jsxs("div",{style:u,children:[e.jsx("span",{children:"WINDOW_MODE"}),e.jsx("button",{onClick:q,style:x,children:f?"[ FULLSCREEN ]":"[ WINDOWED ]"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{...u,borderBottom:"2px solid #333",marginBottom:"1.5cqw"},children:[e.jsx("span",{style:{color:"#888"},children:"SELECT_REGISTRY_CONTEXT:"}),e.jsx("select",{value:a,onChange:s=>T(s.target.value),style:{...b,width:"25cqw"},children:n.getRegistryProfiles().map(s=>e.jsx("option",{value:s,children:s.toUpperCase()},s))})]}),e.jsxs("p",{style:{color:"#888",marginBottom:"1cqw",fontSize:"0.8em"},children:["CONFIGURING: ",a.toUpperCase()]}),Object.entries(F).map(([s,l])=>e.jsxs("div",{style:u,children:[e.jsx("span",{style:{flex:1},children:l.label}),e.jsx("div",{style:{display:"flex",gap:"1cqw"},children:[0,1].map(c=>{const j=g?.action===s&&g?.slot===c;return e.jsx("button",{onClick:()=>v({action:s,slot:c}),style:{...x,width:"12cqw",borderColor:j?"#fff":"#00ff00",color:j?"#fff":"#00ff00"},children:j?"???":`[ ${l.keys[c]||"---"} ]`},c)})})]},s))]})}),e.jsxs("div",{style:{marginTop:"auto",textAlign:"right",paddingTop:"1cqw",borderTop:"1px solid #00ff00",display:"flex",justifyContent:"flex-end",gap:"1cqw"},children:[r==="controls"&&e.jsxs("button",{onClick:_,style:{...x,borderColor:"#ff4444",color:"#ff4444",background:"rgba(255, 0, 0, 0.1)"},children:["RESET_DEFAULTS_[",a.toUpperCase(),"]"]}),e.jsx("button",{onClick:()=>n.onBack(),style:{...x,background:"#111",borderColor:"#444",color:"#888"},children:"EXIT_CONFIG"})]})]})})};class $ extends O{name=V.SETTINGS_MENU;params;constructor(t){super(()=>new D),this.params=t}getView(){return M.createElement(P,{controller:this.controller,res:this.params?.res,setRes:this.params?.setRes})}}export{$ as SettingsMenuState};
//# sourceMappingURL=SettingsMenuState-vNWkR2RY.js.map
