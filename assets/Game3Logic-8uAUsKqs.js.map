{"version":3,"file":"Game3Logic-8uAUsKqs.js","sources":["../src/features/Game3/logic/Game3Commands.ts","../src/features/Game3/logic/Game3Collision.ts","../src/features/Game3/logic/Game3Hazards.ts","../src/features/Game3/logic/Game3Logic.ts"],"sourcesContent":["import { ICommand } from '../../../core/interfaces/ICommand';\r\nimport { Game3Config } from '../model/Game3Config';\r\nimport { ParsedMapData } from './Game3MapData';\r\n\r\nexport const Game3Commands: Record<string, ICommand> = {\r\n    INITIALIZE: {\r\n        execute(logic, payload: Game3Config) {\r\n            logic.applyConfig(payload);\r\n            // Don't set initialized here if we expect map data\r\n            if (!payload.mapPath) {\r\n                logic.setInitialized(true);\r\n            }\r\n        }\r\n    },\r\n    SET_MAP_DATA: {\r\n        execute(logic, payload: ParsedMapData) {\r\n            // Logic now receives pure data, no parsing needed here\r\n            logic.setMapData(payload);\r\n            logic.setInitialized(true);\r\n        }\r\n    },\r\n    MOD_HP: {\r\n        execute(logic, payload: { amount: number }) {\r\n            logic.modifyHP(payload.amount);\r\n        }\r\n    }\r\n};","// src/features/Game3/logic/Game3Collision.ts\r\nimport { Game3Logic } from './Game3Logic';\r\nimport { PlatformData } from './Game3MapData';\r\n\r\nexport class Game3Collision {\r\n    constructor(private logic: Game3Logic) {}\r\n\r\n    public checkIsOnGround(): boolean {\r\n        const hero = this.logic.heroState;\r\n        const { width, height } = this.logic.dimensions;\r\n        const platforms = this.logic.platformList;\r\n\r\n        const checkY = hero.y + height + 0.1;\r\n\r\n        for (const p of platforms) {\r\n            if (p.isSpike || p.isPortal || p.isVoid || p.isExit) continue;\r\n\r\n            if (p.isFallthrough) {\r\n                if (this.logic.isAction('MOVE_DOWN')) continue;\r\n                if (hero.y + height > p.y + 0.1) continue;\r\n            }\r\n\r\n            if (\r\n                hero.x + width > p.x &&\r\n                hero.x < p.x + p.width &&\r\n                checkY > p.y &&\r\n                hero.y + height <= p.y\r\n            ) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public getWallCollision(): number {\r\n        const hero = this.logic.heroState;\r\n        const { width, height } = this.logic.dimensions;\r\n        const platforms = this.logic.platformList;\r\n        const checkDist = 0.1;\r\n\r\n        for (const p of platforms) {\r\n            if (p.isWall &&\r\n                hero.x <= p.x + p.width && hero.x + checkDist > p.x + p.width &&\r\n                hero.y + height > p.y && hero.y < p.y + p.height) {\r\n                return -1;\r\n            }\r\n        }\r\n        for (const p of platforms) {\r\n            if (p.isWall &&\r\n                hero.x + width >= p.x && hero.x + width - checkDist < p.x &&\r\n                hero.y + height > p.y && hero.y < p.y + p.height) {\r\n                return 1;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    public resolveMovement() {\r\n        const hero = this.logic.heroState;\r\n        const { width, height } = this.logic.dimensions;\r\n        const platforms = this.logic.platformList;\r\n\r\n        const nextX = hero.x + hero.vx;\r\n\r\n        // Horizontal Collision\r\n        for (const p of platforms) {\r\n            if (p.isSpike || p.isPortal || p.isVoid || p.isExit) continue;\r\n            if (p.isFallthrough) continue;\r\n\r\n            if (nextX + width > p.x && nextX < p.x + p.width && hero.y + height > p.y && hero.y < p.y + p.height) {\r\n                if (nextX > hero.x) hero.x = p.x - width;\r\n                else if (nextX < hero.x) hero.x = p.x + p.width;\r\n                hero.vx = 0;\r\n                break;\r\n            }\r\n        }\r\n        if (hero.vx !== 0) hero.x = nextX;\r\n\r\n        // Vertical Collision\r\n        const nextY = hero.y + hero.vy;\r\n        let verticalCollided = false;\r\n\r\n        for (const p of platforms) {\r\n            if (p.isSpike || p.isPortal || p.isVoid || p.isExit) continue;\r\n\r\n            if (p.isFallthrough) {\r\n                if (hero.vy < 0) continue;\r\n                if (this.logic.isAction('MOVE_DOWN')) continue;\r\n                if (hero.y + height > p.y + 0.1) continue;\r\n            }\r\n\r\n            if (hero.x + width > p.x && hero.x < p.x + p.width && nextY + height > p.y && nextY < p.y + p.height) {\r\n                if (nextY > hero.y) {\r\n                    hero.y = p.y - height;\r\n                    this.logic.isJumping = false; // Using the public setter\r\n                } else if (nextY < hero.y) {\r\n                    hero.y = p.y + p.height;\r\n                    this.logic.isJumping = false; // Using the public setter\r\n                }\r\n                hero.vy = 0;\r\n                verticalCollided = true;\r\n                break;\r\n            }\r\n        }\r\n        if (!verticalCollided) hero.y = nextY;\r\n    }\r\n\r\n    public checkHazardCollision(property: 'isSpike' | 'isVoid' | 'isPortal' | 'isExit'): boolean {\r\n        return !!this.getCollidingPlatform(property);\r\n    }\r\n\r\n    public getCollidingPlatform(property: 'isSpike' | 'isVoid' | 'isPortal' | 'isExit'): PlatformData | undefined {\r\n        const hero = this.logic.heroState;\r\n        const { width, height } = this.logic.dimensions;\r\n        const platforms = this.logic.platformList;\r\n        const padding = 0.05;\r\n\r\n        for (const p of platforms) {\r\n            if (p[property] &&\r\n                hero.x + width - padding > p.x &&\r\n                hero.x + padding < p.x + p.width &&\r\n                hero.y + height - padding > p.y &&\r\n                hero.y + padding < p.y + p.height) {\r\n                return p;\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n}","// src/features/Game3/logic/Game3Hazards.ts\r\nimport { Game3Logic } from './Game3Logic';\r\nimport { Game3Collision } from './Game3Collision';\r\n\r\nexport class Game3Hazards {\r\n    constructor(private logic: Game3Logic, private collision: Game3Collision) {}\r\n\r\n    public updateSpikeLogic() {\r\n        const currentlyInSpike = this.collision.checkHazardCollision('isSpike');\r\n        if (currentlyInSpike) {\r\n            if (!this.logic.inSpike || this.logic.spikeTimer <= 0) {\r\n                this.logic.modifyHP(-10);\r\n                this.logic.spikeTimer = 120;\r\n            }\r\n        }\r\n\r\n        if (this.logic.spikeTimer > 0) {\r\n            this.logic.spikeTimer--;\r\n        }\r\n        this.logic.inSpike = currentlyInSpike;\r\n    }\r\n\r\n    public updatePortalLogic() {\r\n        if (this.logic.portalTimer > 0) {\r\n            this.logic.portalTimer--;\r\n            return;\r\n        }\r\n\r\n        const portal = this.collision.getCollidingPlatform('isPortal');\r\n        if (portal) {\r\n            const portals = this.logic.platformList.filter(p => p.isPortal);\r\n            if (portals.length >= 2) {\r\n                const otherPortal = portals.find(p => p !== portal);\r\n                if (otherPortal) {\r\n                    const { width, height } = this.logic.dimensions;\r\n                    this.logic.heroState.x = otherPortal.x + (otherPortal.width / 2) - (width / 2);\r\n                    this.logic.heroState.y = otherPortal.y + (otherPortal.height / 2) - (height / 2);\r\n                    this.logic.portalTimer = 60;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public updateVoidLogic() {\r\n        if (this.collision.checkHazardCollision('isVoid')) {\r\n            const hero = this.logic.heroState;\r\n            const spawn = this.logic.spawn;\r\n            hero.x = spawn.x;\r\n            hero.y = spawn.y;\r\n            hero.vx = 0;\r\n            hero.vy = 0;\r\n            this.logic.modifyHP(-20);\r\n        }\r\n    }\r\n\r\n    public updateExitLogic() {\r\n        if (!this.logic.levelCompleted && this.collision.checkHazardCollision('isExit')) {\r\n            this.logic.levelCompleted = true;\r\n            self.postMessage({ type: 'EVENT', name: 'LEVEL_COMPLETE' });\r\n        }\r\n    }\r\n}","// src/features/Game3/logic/Game3Logic.ts\r\nimport { Game3MainSchema, Game3PlatformsSchema } from '../model/Game3LogicSchema';\r\nimport { BaseLogic } from '../../../core/templates/BaseLogic';\r\nimport { BaseDispatcher } from '../../../core/templates/BaseDispatcher';\r\nimport { Game3Commands } from './Game3Commands';\r\nimport { Game3Config } from '../model/Game3Config';\r\nimport { ParsedMapData, PlatformData } from './Game3MapData'; // Keep these imports\r\nimport { Game3Collision } from './Game3Collision';\r\nimport { Game3Hazards } from './Game3Hazards';\r\n\r\nexport class Game3Logic extends BaseLogic<Game3Config> {\r\n    protected dispatcher: BaseDispatcher<Game3Logic>;\r\n\r\n    private collision: Game3Collision;\r\n    private hazards: Game3Hazards;\r\n\r\n    // State\r\n    private hp = 100;\r\n    private hero = { x: 0, y: 0, vx: 0, vy: 0 };\r\n    private isOnGround = false;\r\n    private isWallSliding = false;\r\n    private wallJumpTimer = 0;\r\n    private wallJumpDirection = 0;\r\n    private spikeDamageTimer = 0;\r\n    private wasInSpike = false;\r\n    private portalCooldown = 0;\r\n    private isJumpingFromGround = false;\r\n    private hasCompletedLevel = false;\r\n    private spawnPoint = { x: 0, y: 0 };\r\n\r\n    // Config\r\n    private heroWidth = 1.0;\r\n    private heroHeight = 1.0;\r\n    private worldScale = 32;\r\n    private playerScale = 1.0;\r\n    private playerOffsetY = 0;\r\n    private platforms: PlatformData[] = [];\r\n\r\n    // Movement settings\r\n    private moveSpeed = 0.25;\r\n    private jumpPower = -0.4;\r\n    private gravity = 0.04;\r\n    private friction = 0.5;\r\n\r\n    constructor() {\r\n        super(Game3MainSchema.REVISION);\r\n        this.dispatcher = new BaseDispatcher(this, Game3Commands, \"Game3\");\r\n        this.collision = new Game3Collision(this);\r\n        this.hazards = new Game3Hazards(this, this.collision);\r\n    }\r\n\r\n    public applyConfig(config: Game3Config): void {\r\n        this.config = config;\r\n        this.hp = config.initialHP;\r\n        this.worldScale = config.worldScale || 32;\r\n        this.playerScale = config.playerScale || 1.0;\r\n        this.playerOffsetY = config.playerOffsetY || 0;\r\n        this.heroWidth = config.heroWidth || 1.0;\r\n        this.heroHeight = config.heroHeight || 2.0;\r\n    }\r\n\r\n    public setMapData(data: ParsedMapData) {\r\n        this.platforms = data.platforms;\r\n        this.hero.x = data.playerStart.x;\r\n        this.hero.y = data.playerStart.y;\r\n        this.spawnPoint = { x: data.playerStart.x, y: data.playerStart.y };\r\n        this.hero.vx = 0;\r\n        this.hero.vy = 0;\r\n        this.hasCompletedLevel = false;\r\n\r\n        if (data.playerStart.width && data.playerStart.height) {\r\n            this.heroWidth = data.playerStart.width;\r\n            this.heroHeight = data.playerStart.height;\r\n        }\r\n    }\r\n\r\n    protected onUpdate(sharedView: Float32Array, intView: Int32Array, frameCount: number, fps: number): void {\r\n        if (!this.config || !this.isInitialized) return;\r\n\r\n        this.isOnGround = this.collision.checkIsOnGround();\r\n\r\n        this.updateHeroMovement();\r\n        this.collision.resolveMovement();\r\n\r\n        this.hazards.updateExitLogic();\r\n        this.hazards.updateSpikeLogic();\r\n        this.hazards.updatePortalLogic();\r\n        this.hazards.updateVoidLogic();\r\n\r\n\r\n        this.syncToSAB(sharedView, frameCount, fps);\r\n    }\r\n\r\n    public isAction(action: string): boolean {\r\n        return this.inputState && this.inputState.actions && this.inputState.actions.includes(action);\r\n    }\r\n\r\n    private updateHeroMovement() {\r\n        const wallSide = this.collision.getWallCollision();\r\n        const moveLeft = this.isAction('MOVE_LEFT');\r\n        const moveRight = this.isAction('MOVE_RIGHT');\r\n        const jumpHeld = this.isAction('JUMP');\r\n\r\n        let moveDir = 0;\r\n        if (moveLeft) moveDir -= 1;\r\n        if (moveRight) moveDir += 1;\r\n\r\n        if (this.wallJumpTimer > 0) {\r\n            this.hero.vx = this.wallJumpDirection * this.moveSpeed * 1.5;\r\n            this.wallJumpTimer--;\r\n        } else {\r\n            if (moveDir !== 0) {\r\n                this.hero.vx = moveDir * this.moveSpeed;\r\n            } else {\r\n                this.hero.vx *= this.friction;\r\n                if (Math.abs(this.hero.vx) < 0.01) this.hero.vx = 0;\r\n            }\r\n        }\r\n\r\n        this.isWallSliding = false;\r\n        if (!this.isOnGround && wallSide !== 0) {\r\n            if ((wallSide === -1 && moveDir === -1) || (wallSide === 1 && moveDir === 1)) {\r\n                this.isWallSliding = true;\r\n                this.wallJumpTimer = 0;\r\n            }\r\n        }\r\n\r\n        let effectiveGravity = this.gravity;\r\n        if (this.isJumpingFromGround && jumpHeld && this.hero.vy < 0) {\r\n            effectiveGravity *= 0.5;\r\n        }\r\n\r\n        if (this.isWallSliding && this.hero.vy > 0) {\r\n            this.hero.vy += effectiveGravity * 0.2;\r\n            if (this.hero.vy > 0.1) this.hero.vy = 0.1;\r\n        } else {\r\n            this.hero.vy += effectiveGravity;\r\n        }\r\n\r\n        if (jumpHeld) {\r\n            if (this.isOnGround) {\r\n                this.hero.vy = this.jumpPower;\r\n                this.wallJumpTimer = 0;\r\n                this.isJumpingFromGround = true;\r\n            } else if (wallSide !== 0) {\r\n                this.hero.vy = this.jumpPower;\r\n                this.wallJumpDirection = -wallSide;\r\n                this.wallJumpTimer = 15;\r\n                this.isWallSliding = false;\r\n                this.isJumpingFromGround = false;\r\n            }\r\n        }\r\n\r\n        if (this.hero.vy >= 0) this.isJumpingFromGround = false;\r\n        if (this.hero.vy > 0.8) this.hero.vy = 0.8;\r\n    }\r\n\r\n    private getPlatformType(p: PlatformData): number {\r\n        if (p.isExit) return 5;\r\n        if (p.isPortal) return 4;\r\n        if (p.isSpike) return 3;\r\n        if (p.isVoid) return 2;\r\n        if (p.isWall) return 1;\r\n        if (p.isFallthrough) return 6;\r\n        if (p.isFloor) return 0;\r\n        return 0;\r\n    }\r\n\r\n    private syncToSAB(sMain: Float32Array, frameCount: number, fps: number) {\r\n        // Access the additional platform buffer from the protected map in BaseLogic\r\n        const sPlatforms = this.sharedViews.get('platforms');\r\n        if (!sMain || !sPlatforms) return;\r\n\r\n        const M = Game3MainSchema;\r\n        sMain[M.FRAME_COUNT] = frameCount;\r\n        sMain[M.FPS] = fps;\r\n\r\n        sMain[M.HERO_X] = this.hero.x;\r\n        sMain[M.HERO_Y] = this.hero.y;\r\n        sMain[M.HERO_VX] = this.hero.vx;\r\n        sMain[M.HERO_VY] = this.hero.vy;\r\n        sMain[M.HERO_HP] = this.hp;\r\n\r\n        sMain[M.HERO_WIDTH] = this.heroWidth;\r\n        sMain[M.HERO_HEIGHT] = this.heroHeight;\r\n        sMain[M.WORLD_SCALE] = this.worldScale;\r\n        sMain[M.PLAYER_SCALE] = this.playerScale;\r\n        sMain[M.PLAYER_OFFSET_Y] = this.playerOffsetY;\r\n\r\n        sMain[M.IS_ON_GROUND] = this.isOnGround ? 1 : 0;\r\n        sMain[M.IS_WALL_SLIDING] = this.isWallSliding ? 1 : 0;\r\n        sMain[M.WALL_JUMP_TIMER] = this.wallJumpTimer;\r\n        sMain[M.WALL_JUMP_DIRECTION] = this.wallJumpDirection;\r\n        sMain[M.SPIKE_DAMAGE_TIMER] = this.spikeDamageTimer;\r\n        sMain[M.WAS_IN_SPIKE] = this.wasInSpike ? 1 : 0;\r\n        sMain[M.PORTAL_COOLDOWN] = this.portalCooldown;\r\n        sMain[M.IS_JUMPING_FROM_GROUND] = this.isJumpingFromGround ? 1 : 0;\r\n        sMain[M.HAS_COMPLETED_LEVEL] = this.hasCompletedLevel ? 1 : 0;\r\n        sMain[M.SPAWN_X] = this.spawnPoint.x;\r\n        sMain[M.SPAWN_Y] = this.spawnPoint.y;\r\n\r\n        sMain[M.MOVE_SPEED] = this.moveSpeed;\r\n        sMain[M.JUMP_POWER] = this.jumpPower;\r\n        sMain[M.GRAVITY] = this.gravity;\r\n        sMain[M.FRICTION] = this.friction;\r\n\r\n        const capacity = Math.floor(sPlatforms.length / Game3PlatformsSchema.STRIDE);\r\n        const objCount = Math.min(this.platforms.length, capacity);\r\n        sMain[M.OBJ_COUNT] = objCount;\r\n\r\n        for (let i = 0; i < objCount; i++) {\r\n            const p = this.platforms[i];\r\n            const idx = i * Game3PlatformsSchema.STRIDE;\r\n            sPlatforms[idx] = p.x;\r\n            sPlatforms[idx + 1] = p.y;\r\n            sPlatforms[idx + 2] = p.width;\r\n            sPlatforms[idx + 3] = p.height;\r\n            sPlatforms[idx + 4] = this.getPlatformType(p);\r\n        }\r\n    }\r\n\r\n    public override getSnapshot() {\r\n        return {\r\n            hero: { ...this.hero },\r\n            hp: this.hp,\r\n            wallJumpTimer: this.wallJumpTimer,\r\n            wallJumpDirection: this.wallJumpDirection,\r\n            isWallSliding: this.isWallSliding,\r\n            spikeDamageTimer: this.spikeDamageTimer,\r\n            wasInSpike: this.wasInSpike,\r\n            portalCooldown: this.portalCooldown,\r\n            isJumpingFromGround: this.isJumpingFromGround,\r\n            spawnPoint: { ...this.spawnPoint },\r\n            hasCompletedLevel: this.hasCompletedLevel\r\n        };\r\n    }\r\n\r\n    public override loadSnapshot(data: any) {\r\n        if (data) {\r\n            this.hero = data.hero || this.hero;\r\n            this.hp = data.hp ?? this.hp;\r\n            this.wallJumpTimer = data.wallJumpTimer ?? 0;\r\n            this.wallJumpDirection = data.wallJumpDirection ?? 0;\r\n            this.isWallSliding = data.isWallSliding ?? false;\r\n            this.spikeDamageTimer = data.spikeDamageTimer ?? 0;\r\n            this.wasInSpike = data.wasInSpike ?? false;\r\n            this.portalCooldown = data.portalCooldown ?? 0;\r\n            this.isJumpingFromGround = data.isJumpingFromGround ?? false;\r\n            this.spawnPoint = data.spawnPoint || this.spawnPoint;\r\n            this.hasCompletedLevel = data.hasCompletedLevel ?? false;\r\n            this.isInitialized = true;\r\n        }\r\n    }\r\n\r\n    public modifyHP(amount: number) {\r\n        this.hp = Math.max(0, Math.min(100, this.hp + amount));\r\n    }\r\n\r\n    public get heroState() { return this.hero; }\r\n    public get platformList() { return this.platforms; }\r\n    public get dimensions() {\r\n        return { width: this.heroWidth, height: this.heroHeight };\r\n    }\r\n    public get spawn() { return this.spawnPoint; }\r\n\r\n    public get spikeTimer() { return this.spikeDamageTimer; }\r\n    public set spikeTimer(val: number) { this.spikeDamageTimer = val; }\r\n\r\n    public get inSpike() { return this.wasInSpike; }\r\n    public set inSpike(val: boolean) { this.wasInSpike = val; }\r\n\r\n    public get portalTimer() { return this.portalCooldown; }\r\n    public set portalTimer(val: number) { this.portalCooldown = val; }\r\n\r\n    public get levelCompleted() { return this.hasCompletedLevel; }\r\n    public set levelCompleted(val: boolean) { this.hasCompletedLevel = val; }\r\n\r\n    public get isJumping() { return this.isJumpingFromGround; }\r\n    public set isJumping(val: boolean) { this.isJumpingFromGround = val; }\r\n}"],"names":["Game3Commands","logic","payload","Game3Collision","hero","width","height","platforms","checkY","p","checkDist","nextX","nextY","verticalCollided","property","padding","Game3Hazards","collision","currentlyInSpike","portal","portals","otherPortal","spawn","Game3Logic","BaseLogic","Game3MainSchema","BaseDispatcher","config","data","sharedView","intView","frameCount","fps","action","wallSide","moveLeft","moveRight","jumpHeld","moveDir","effectiveGravity","sMain","sPlatforms","M","capacity","Game3PlatformsSchema","objCount","i","idx","amount","val"],"mappings":"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"}