{"version":3,"file":"MainMenuState-D-RWstby.js","sources":["../../src/features/MainMenu/MainMenuController.ts","../../src/features/MainMenu/MainMenuView.tsx","../../src/features/MainMenu/MainMenuState.ts"],"sourcesContent":["// src/features/MainMenu/MainMenuController.ts\r\nimport { BaseMenuController } from \"../../core/templates/BaseMenuController\";\r\nimport { StateManager } from \"../../core/managers/StateManager\";\r\nimport { StateRegistry } from \"../../core/registry/StateRegistry\";\r\nimport { FeatureEnum } from \"../FeatureEnum\";\r\nimport { CampaignManager } from \"../../core/managers/CampaignManager\";\r\nimport { InputManager } from \"../../core/managers/InputManager\";\r\nimport { AudioManager } from \"../../core/managers/AudioManager\";\r\n\r\nexport class MainMenuController extends BaseMenuController {\r\n    private campaign = CampaignManager.getInstance();\r\n    private audio = AudioManager.getInstance();\r\n\r\n    private selectedIndex: number = 0;\r\n    private readonly MENU_COUNT: number = 4;\r\n    private onViewUpdate?: (index: number) => void;\r\n\r\n    private resOverride: any;\r\n    private setResOverride: any;\r\n\r\n    public bindView(callback: (index: number) => void, res: any, setRes: any) {\r\n        this.onViewUpdate = callback;\r\n        this.resOverride = res;\r\n        this.setResOverride = setRes;\r\n        this.onViewUpdate(this.selectedIndex);\r\n    }\r\n\r\n    public unbindView() { this.onViewUpdate = undefined; }\r\n\r\n    public playBGM() {\r\n        this.audio.play('bgm_menu');\r\n    }\r\n\r\n    public stopBGM() {\r\n        this.audio.stop('bgm_menu');\r\n    }\r\n\r\n    private playNavSFX() {\r\n        this.audio.play('sfx_nav');\r\n    }\r\n\r\n    public setHoverIndex(index: number) {\r\n        if (this.selectedIndex !== index) {\r\n            this.selectedIndex = index;\r\n            this.playNavSFX();\r\n            this.onViewUpdate?.(this.selectedIndex);\r\n        }\r\n    }\r\n\r\n    protected onKeyDown(e: KeyboardEvent): void {\r\n        const input = InputManager.getInstance();\r\n        let changed = false;\r\n\r\n        if (input.isKeyAction(e.key, \"UI_DOWN\")) {\r\n            this.selectedIndex = (this.selectedIndex + 1) % this.MENU_COUNT;\r\n            changed = true;\r\n        } else if (input.isKeyAction(e.key, \"UI_UP\")) {\r\n            this.selectedIndex = (this.selectedIndex - 1 + this.MENU_COUNT) % this.MENU_COUNT;\r\n            changed = true;\r\n        } else if (input.isKeyAction(e.key, \"UI_ACCEPT\")) {\r\n            this.executeSelected();\r\n        }\r\n\r\n        if (changed) {\r\n            this.playNavSFX();\r\n            this.onViewUpdate?.(this.selectedIndex);\r\n        }\r\n    }\r\n\r\n    public executeSelected() {\r\n        switch(this.selectedIndex) {\r\n            case 0: this.campaign.startCampaign('cross_game'); break;\r\n            case 1: this.openPopup(FeatureEnum.SAVE_MENU); break;\r\n            case 2: this.openPopup(FeatureEnum.SETTINGS_MENU, { res: this.resOverride, setRes: this.setResOverride }); break;\r\n            case 3: this.handleNav(FeatureEnum.DEV_MENU); break;\r\n        }\r\n    }\r\n\r\n    public async handleNav(id: FeatureEnum, params: any = {}) {\r\n        const target = await StateRegistry.create(id, { reset: false, ...params });\r\n        StateManager.getInstance().replace(target);\r\n    }\r\n\r\n    public async openPopup(id: FeatureEnum, params: any = {}) {\r\n        const target = await StateRegistry.create(id, params);\r\n        StateManager.getInstance().push(target);\r\n    }\r\n\r\n    public onBack(): void {\r\n    }\r\n}","// src/features/MainMenu/MainMenuView.tsx\r\nimport React, { useState, useEffect } from 'react';\r\nimport { MainMenuController } from './MainMenuController';\r\n\r\ninterface MainMenuViewProps {\r\n    controller: MainMenuController;\r\n    res?: string;\r\n    setRes?: (r: any) => void;\r\n}\r\n\r\nexport const MainMenuView: React.FC<MainMenuViewProps> = ({ controller, res, setRes }) => {\r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n\r\n    useEffect(() => {\r\n        controller.bindView(setSelectedIndex, res, setRes);\r\n        return () => controller.unbindView();\r\n    }, [controller, res, setRes]);\r\n\r\n    const menuItems = [\"Start Game\", \"Load Game\", \"Options\", \"Legacy Menu\"];\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'absolute', inset: 0,\r\n            background: '#000',\r\n            display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n            overflow: 'hidden'\r\n        }}>\r\n            <div style={{\r\n                position: 'relative',\r\n                width: '100%', height: '100%',\r\n                maxWidth: 'calc(100vh * (16 / 9))',\r\n                maxHeight: 'calc(100vw * (9 / 16))',\r\n                aspectRatio: '16 / 9',\r\n                backgroundColor: '#0a0a0a', color: '#00ff00',\r\n                boxSizing: 'border-box', fontFamily: 'monospace',\r\n                border: '0.2cqw solid #333', display: 'flex'\r\n            }}>\r\n\r\n                <div style={{\r\n                    flex: 1,\r\n                    borderRight: '0.2cqw solid #333',\r\n                    padding: '3cqw',\r\n                    display: 'flex', flexDirection: 'column',\r\n                    justifyContent: 'center', gap: '1.5cqw',\r\n                    backgroundColor: '#050505'\r\n                }}>\r\n                    {menuItems.map((label, idx) => (\r\n                        <button\r\n                            key={idx}\r\n                            onMouseEnter={() => controller.setHoverIndex(idx)}\r\n                            onClick={() => controller.executeSelected()}\r\n                            style={{\r\n                                padding: '1.2cqw',\r\n                                backgroundColor: selectedIndex === idx ? '#00ff00' : '#111',\r\n                                color: selectedIndex === idx ? '#000' : '#888',\r\n                                border: selectedIndex === idx ? '0.1cqw solid #fff' : '0.1cqw solid #333',\r\n                                borderRadius: '0.4cqw',\r\n                                cursor: 'pointer',\r\n                                fontSize: '1cqw', fontWeight: 'bold',\r\n                                textAlign: 'left', textTransform: 'uppercase',\r\n                                transition: 'all 0.1s ease-in-out'\r\n                            }}\r\n                        >\r\n                            {selectedIndex === idx ? `> ${label}` : label}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                <div style={{\r\n                    flex: 3,\r\n                    position: 'relative',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                    overflow: 'hidden'\r\n                }}>\r\n                    <div style={{ opacity: 0.2, fontSize: '2cqw', color: '#00ff00', fontStyle: 'italic' }}>\r\n                        [ *TBD* ]\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n};","// src/features/MainMenu/MainMenuState.ts\r\nimport React, { JSX } from 'react';\r\nimport { State } from '../../core/templates/State';\r\nimport { FeatureEnum } from '../FeatureEnum';\r\nimport { MainMenuController } from './MainMenuController';\r\nimport { MainMenuView } from './MainMenuView';\r\nimport { InputManager } from '../../core/managers/InputManager';\r\nimport {AudioManager} from \"../../core/managers/AudioManager\";\r\n\r\nexport class MainMenuState extends State {\r\n    public name = FeatureEnum.MAIN_MENU;\r\n    private controller: MainMenuController;\r\n    protected params: any;\r\n\r\n    private readonly MANIFEST_PATH = \"res/mainManifest.json\";\r\n\r\n    constructor(params?: any) {\r\n        super();\r\n        this.params = params || {};\r\n        this.controller = new MainMenuController();\r\n    }\r\n\r\n    public async init(): Promise<void> {\r\n        await AudioManager.getInstance().loadManifest(this.MANIFEST_PATH, this.name);\r\n        InputManager.getInstance().refreshBindings(\"Shared\");\r\n        this.isRendering = true;\r\n        this.controller.init(this.name as FeatureEnum);\r\n        this.controller.playBGM();\r\n    }\r\n\r\n    public update(dt: number, frameCount: number): void {}\r\n\r\n    public getView(): JSX.Element {\r\n        return React.createElement(MainMenuView, {\r\n            key: this.name,\r\n            controller: this.controller,\r\n            res: this.params.res,\r\n            setRes: this.params.setRes\r\n        });\r\n    }\r\n\r\n    public destroy(): void {\r\n        this.controller.stopBGM();\r\n        AudioManager.getInstance().uncacheByState(this.name);\r\n        this.controller.destroy();\r\n    }\r\n}"],"names":["MainMenuController","BaseMenuController","CampaignManager","AudioManager","callback","res","setRes","index","input","InputManager","changed","FeatureEnum","id","params","target","StateRegistry","StateManager","MainMenuView","controller","selectedIndex","setSelectedIndex","useState","useEffect","menuItems","jsx","jsxs","label","idx","MainMenuState","State","dt","frameCount","React"],"mappings":"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"}