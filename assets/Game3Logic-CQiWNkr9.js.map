{"version":3,"file":"Game3Logic-CQiWNkr9.js","sources":["../src/features/Game3/logic/Game3Commands.ts","../src/features/Game3/logic/Game3Collision.ts","../src/features/Game3/logic/Game3Hazards.ts","../src/features/Game3/logic/Game3Logic.ts"],"sourcesContent":["import { ICommand } from '../../../core/interfaces/ICommand';\r\nimport { Game3Config } from '../model/Game3Config';\r\nimport { ParsedMapData } from '../data/Game3MapData';\r\n\r\nexport const Game3Commands: Record<string, ICommand> = {\r\n    INITIALIZE: {\r\n        execute(logic, payload: Game3Config) {\r\n            logic.applyConfig(payload);\r\n            // Don't set initialized here if we expect map data\r\n            if (!payload.mapPath) {\r\n                logic.setInitialized(true);\r\n            }\r\n        }\r\n    },\r\n    SET_MAP_DATA: {\r\n        execute(logic, payload: ParsedMapData) {\r\n            // Logic now receives pure data, no parsing needed here\r\n            logic.setMapData(payload);\r\n            logic.setInitialized(true);\r\n        }\r\n    },\r\n    MOD_HP: {\r\n        execute(logic, payload: { amount: number }) {\r\n            logic.modifyHP(payload.amount);\r\n        }\r\n    }\r\n};","// src/features/Game3/logic/Game3Collision.ts\r\nimport { Game3Logic } from './Game3Logic';\r\nimport { PlatformData } from '../data/Game3MapData';\r\n\r\nexport class Game3Collision {\r\n    constructor(private logic: Game3Logic) {}\r\n\r\n    public checkIsOnGround(): boolean {\r\n        const checkY = this.logic.hero.y + this.logic.heroHeight + 0.1;\r\n        for (const p of this.logic.platforms) {\r\n            if (p.isSpike || p.isPortal || p.isVoid || p.isExit) continue;\r\n\r\n            if (p.isFallthrough) {\r\n                if (this.logic.isAction('MOVE_DOWN')) continue;\r\n                if (this.logic.hero.y + this.logic.heroHeight > p.y + 0.1) continue;\r\n            }\r\n\r\n            if (\r\n                this.logic.hero.x + this.logic.heroWidth > p.x &&\r\n                this.logic.hero.x < p.x + p.width &&\r\n                checkY > p.y &&\r\n                this.logic.hero.y + this.logic.heroHeight <= p.y\r\n            ) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public getWallCollision(): number {\r\n        const checkDist = 0.1;\r\n        for (const p of this.logic.platforms) {\r\n            if (p.isWall &&\r\n                this.logic.hero.x <= p.x + p.width && this.logic.hero.x + checkDist > p.x + p.width &&\r\n                this.logic.hero.y + this.logic.heroHeight > p.y && this.logic.hero.y < p.y + p.height) {\r\n                return -1;\r\n            }\r\n        }\r\n        for (const p of this.logic.platforms) {\r\n            if (p.isWall &&\r\n                this.logic.hero.x + this.logic.heroWidth >= p.x && this.logic.hero.x + this.logic.heroWidth - checkDist < p.x &&\r\n                this.logic.hero.y + this.logic.heroHeight > p.y && this.logic.hero.y < p.y + p.height) {\r\n                return 1;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    public resolveMovement() {\r\n        const nextX = this.logic.hero.x + this.logic.hero.vx;\r\n\r\n        for (const p of this.logic.platforms) {\r\n            if (p.isSpike || p.isPortal || p.isVoid || p.isExit) continue;\r\n            if (p.isFallthrough) continue;\r\n            if (nextX + this.logic.heroWidth > p.x && nextX < p.x + p.width && this.logic.hero.y + this.logic.heroHeight > p.y && this.logic.hero.y < p.y + p.height) {\r\n                if (nextX > this.logic.hero.x) this.logic.hero.x = p.x - this.logic.heroWidth;\r\n                else if (nextX < this.logic.hero.x) this.logic.hero.x = p.x + p.width;\r\n                this.logic.hero.vx = 0;\r\n                break;\r\n            }\r\n        }\r\n        if (this.logic.hero.vx !== 0) this.logic.hero.x = nextX;\r\n\r\n        const nextY = this.logic.hero.y + this.logic.hero.vy;\r\n        let verticalCollided = false;\r\n        for (const p of this.logic.platforms) {\r\n            if (p.isSpike || p.isPortal || p.isVoid || p.isExit) continue;\r\n            if (p.isFallthrough) {\r\n                if (this.logic.hero.vy < 0) continue;\r\n                if (this.logic.isAction('MOVE_DOWN')) continue;\r\n                if (this.logic.hero.y + this.logic.heroHeight > p.y + 0.1) continue;\r\n            }\r\n            if (this.logic.hero.x + this.logic.heroWidth > p.x && this.logic.hero.x < p.x + p.width && nextY + this.logic.heroHeight > p.y && nextY < p.y + p.height) {\r\n                if (nextY > this.logic.hero.y) {\r\n                    this.logic.hero.y = p.y - this.logic.heroHeight;\r\n                    this.logic.isJumpingFromGround = false;\r\n                } else if (nextY < this.logic.hero.y) {\r\n                    this.logic.hero.y = p.y + p.height;\r\n                    this.logic.isJumpingFromGround = false;\r\n                }\r\n                this.logic.hero.vy = 0;\r\n                verticalCollided = true;\r\n                break;\r\n            }\r\n        }\r\n        if (!verticalCollided) this.logic.hero.y = nextY;\r\n    }\r\n\r\n    public checkHazardCollision(property: 'isSpike' | 'isVoid' | 'isPortal' | 'isExit'): boolean {\r\n        return !!this.getCollidingPlatform(property);\r\n    }\r\n\r\n    public getCollidingPlatform(property: 'isSpike' | 'isVoid' | 'isPortal' | 'isExit'): PlatformData | undefined {\r\n        const padding = 0.05;\r\n        for (const p of this.logic.platforms) {\r\n            if (p[property] &&\r\n                this.logic.hero.x + this.logic.heroWidth - padding > p.x &&\r\n                this.logic.hero.x + padding < p.x + p.width &&\r\n                this.logic.hero.y + this.logic.heroHeight - padding > p.y &&\r\n                this.logic.hero.y + padding < p.y + p.height) {\r\n                return p;\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\n","// src/features/Game3/logic/Game3Hazards.ts\r\nimport { Game3Logic } from './Game3Logic';\r\nimport { Game3Collision } from './Game3Collision';\r\nimport { PlatformData } from '../data/Game3MapData';\r\n\r\nexport class Game3Hazards {\r\n    constructor(private logic: Game3Logic, private collision: Game3Collision) {}\r\n\r\n    public updateSpikeLogic() {\r\n        const currentlyInSpike = this.collision.checkHazardCollision('isSpike');\r\n        if (currentlyInSpike) {\r\n            if (!this.logic.wasInSpike || this.logic.spikeDamageTimer <= 0) {\r\n                this.logic.modifyHP(-10);\r\n                this.logic.spikeDamageTimer = 120;\r\n            }\r\n        }\r\n\r\n        if (this.logic.spikeDamageTimer > 0) {\r\n            this.logic.spikeDamageTimer--;\r\n        }\r\n        this.logic.wasInSpike = currentlyInSpike;\r\n    }\r\n\r\n    public updatePortalLogic() {\r\n        if (this.logic.portalCooldown > 0) {\r\n            this.logic.portalCooldown--;\r\n            return;\r\n        }\r\n\r\n        const portal = this.collision.getCollidingPlatform('isPortal');\r\n        if (portal) {\r\n            const portals = this.logic.platforms.filter(p => p.isPortal);\r\n            if (portals.length >= 2) {\r\n                const otherPortal = portals.find(p => p !== portal);\r\n                if (otherPortal) {\r\n                    this.logic.hero.x = otherPortal.x + (otherPortal.width / 2) - (this.logic.heroWidth / 2);\r\n                    this.logic.hero.y = otherPortal.y + (otherPortal.height / 2) - (this.logic.heroHeight / 2);\r\n                    this.logic.portalCooldown = 60;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public updateVoidLogic() {\r\n        if (this.collision.checkHazardCollision('isVoid')) {\r\n            this.logic.hero.x = this.logic.spawnPoint.x;\r\n            this.logic.hero.y = this.logic.spawnPoint.y;\r\n            this.logic.hero.vx = 0;\r\n            this.logic.hero.vy = 0;\r\n            this.logic.modifyHP(-20);\r\n        }\r\n    }\r\n\r\n    public updateExitLogic() {\r\n        if (!this.logic.hasCompletedLevel && this.collision.checkHazardCollision('isExit')) {\r\n            this.logic.hasCompletedLevel = true;\r\n            // Send event to main thread so the controller can handle progression\r\n            self.postMessage({ type: 'EVENT', name: 'LEVEL_COMPLETE' });\r\n        }\r\n    }\r\n}\r\n","// src/features/Game3/logic/Game3Logic.ts\r\nimport { Game3LogicSchema } from '../model/Game3LogicSchema';\r\nimport { BaseLogic } from '../../../core/templates/BaseLogic';\r\nimport { BaseDispatcher } from '../../../core/templates/BaseDispatcher';\r\nimport { Game3Commands } from './Game3Commands';\r\nimport { Game3Config } from '../model/Game3Config';\r\nimport { ParsedMapData, PlatformData } from '../data/Game3MapData';\r\nimport { Game3Collision } from './Game3Collision';\r\nimport { Game3Hazards } from './Game3Hazards';\r\n\r\nexport class Game3Logic extends BaseLogic<Game3Config> {\r\n    protected dispatcher: BaseDispatcher<Game3Logic>;\r\n\r\n    private collision: Game3Collision;\r\n    private hazards: Game3Hazards;\r\n\r\n    // State\r\n    public hp = 100;\r\n    public hero = { x: 0, y: 0, vx: 0, vy: 0 };\r\n    public isOnGround = false;\r\n    public isWallSliding = false;\r\n    public wallJumpTimer = 0;\r\n    public wallJumpDirection = 0;\r\n    public spikeDamageTimer = 0;\r\n    public wasInSpike = false;\r\n    public portalCooldown = 0;\r\n    public isJumpingFromGround = false;\r\n    public hasCompletedLevel = false;\r\n    public spawnPoint = { x: 0, y: 0 };\r\n\r\n    // Logical Visual State\r\n    public flipX = false;\r\n    public animState = 0; // 0:Idle, 1:Walk, 2:Jump, 3:WallSlide\r\n\r\n    // Config\r\n    public heroWidth = 1.0;\r\n    public heroHeight = 1.0;\r\n    public worldScale = 32;\r\n    public playerScale = 1.0;\r\n    public playerOffsetY = 0;\r\n    public platforms: PlatformData[] = [];\r\n    public mapData: ParsedMapData | null = null;\r\n\r\n    // Movement settings\r\n    private moveSpeed = 0.25;\r\n    private jumpPower = -0.4;\r\n    private gravity = 0.04;\r\n    private friction = 0.5;\r\n\r\n    constructor() {\r\n        super(Game3LogicSchema.REVISION);\r\n        this.dispatcher = new BaseDispatcher(this, Game3Commands, \"Game3\");\r\n        this.collision = new Game3Collision(this);\r\n        this.hazards = new Game3Hazards(this, this.collision);\r\n    }\r\n\r\n    public applyConfig(config: Game3Config): void {\r\n        this.config = config;\r\n        this.hp = config.initialHP;\r\n        this.worldScale = config.worldScale || 32;\r\n        this.playerScale = config.playerScale || 1.0;\r\n        this.playerOffsetY = config.playerOffsetY || 0;\r\n        this.heroWidth = config.heroWidth || 1.0;\r\n        this.heroHeight = config.heroHeight || 2.0;\r\n    }\r\n\r\n    public setMapData(data: ParsedMapData) {\r\n        this.mapData = data;\r\n        this.platforms = data.platforms;\r\n        this.hero.x = data.playerStart.x;\r\n        this.hero.y = data.playerStart.y;\r\n        this.spawnPoint = { x: data.playerStart.x, y: data.playerStart.y };\r\n        this.hero.vx = 0;\r\n        this.hero.vy = 0;\r\n        this.hasCompletedLevel = false;\r\n\r\n        if (data.playerStart.width && data.playerStart.height) {\r\n            this.heroWidth = data.playerStart.width;\r\n            this.heroHeight = data.playerStart.height;\r\n        }\r\n\r\n        // We do NOT need to postMessage MAP_DATA_PRODUCED anymore for rendering,\r\n        // because we are now syncing via SAB. We might still send it for UI logic if needed.\r\n    }\r\n\r\n    protected onUpdate(sharedView: Float32Array, intView: Int32Array, frameCount: number, fps: number): void {\r\n        if (!this.config || !this.isInitialized) return;\r\n\r\n        this.isOnGround = this.collision.checkIsOnGround();\r\n\r\n        this.updateHeroMovement();\r\n        this.collision.resolveMovement();\r\n        this.determineAnimState(); // Replaces Game3Animation update\r\n        this.hazards.updateExitLogic();\r\n        this.hazards.updateSpikeLogic();\r\n        this.hazards.updatePortalLogic();\r\n        this.hazards.updateVoidLogic();\r\n\r\n        this.syncToSAB(sharedView, frameCount, fps);\r\n    }\r\n\r\n    public isAction(action: string): boolean {\r\n        return this.inputState && this.inputState.actions && this.inputState.actions.includes(action);\r\n    }\r\n\r\n    private updateHeroMovement() {\r\n        const wallSide = this.collision.getWallCollision();\r\n        const moveLeft = this.isAction('MOVE_LEFT');\r\n        const moveRight = this.isAction('MOVE_RIGHT');\r\n        const jumpHeld = this.isAction('JUMP');\r\n\r\n        let moveDir = 0;\r\n        if (moveLeft) moveDir -= 1;\r\n        if (moveRight) moveDir += 1;\r\n\r\n        if (this.wallJumpTimer > 0) {\r\n            this.hero.vx = this.wallJumpDirection * this.moveSpeed * 1.5;\r\n            this.wallJumpTimer--;\r\n        } else {\r\n            if (moveDir !== 0) {\r\n                this.hero.vx = moveDir * this.moveSpeed;\r\n            } else {\r\n                this.hero.vx *= this.friction;\r\n                if (Math.abs(this.hero.vx) < 0.01) this.hero.vx = 0;\r\n            }\r\n        }\r\n\r\n        this.isWallSliding = false;\r\n        if (!this.isOnGround && wallSide !== 0) {\r\n            if ((wallSide === -1 && moveDir === -1) || (wallSide === 1 && moveDir === 1)) {\r\n                this.isWallSliding = true;\r\n                this.wallJumpTimer = 0;\r\n            }\r\n        }\r\n\r\n        let effectiveGravity = this.gravity;\r\n        if (this.isJumpingFromGround && jumpHeld && this.hero.vy < 0) {\r\n            effectiveGravity *= 0.5;\r\n        }\r\n\r\n        if (this.isWallSliding && this.hero.vy > 0) {\r\n            this.hero.vy += effectiveGravity * 0.2;\r\n            if (this.hero.vy > 0.1) this.hero.vy = 0.1;\r\n        } else {\r\n            this.hero.vy += effectiveGravity;\r\n        }\r\n\r\n        if (jumpHeld) {\r\n            if (this.isOnGround) {\r\n                this.hero.vy = this.jumpPower;\r\n                this.wallJumpTimer = 0;\r\n                this.isJumpingFromGround = true;\r\n            } else if (wallSide !== 0) {\r\n                this.hero.vy = this.jumpPower;\r\n                this.wallJumpDirection = -wallSide;\r\n                this.wallJumpTimer = 15;\r\n                this.isWallSliding = false;\r\n                this.isJumpingFromGround = false;\r\n            }\r\n        }\r\n\r\n        if (this.hero.vy >= 0) this.isJumpingFromGround = false;\r\n        if (this.hero.vy > 0.8) this.hero.vy = 0.8;\r\n    }\r\n\r\n    private determineAnimState() {\r\n        if (this.hero.vx > 0.01) this.flipX = false;\r\n        else if (this.hero.vx < -0.01) this.flipX = true;\r\n\r\n        if (this.isWallSliding) this.animState = 3;\r\n        else if (!this.isOnGround) this.animState = 2;\r\n        else if (Math.abs(this.hero.vx) > 0.01) this.animState = 1;\r\n        else this.animState = 0;\r\n    }\r\n\r\n    private getPlatformType(p: PlatformData): number {\r\n        // Encoding type for SAB\r\n        if (p.isExit) return 5;\r\n        if (p.isPortal) return 4;\r\n        if (p.isSpike) return 3;\r\n        if (p.isVoid) return 2;\r\n        if (p.isWall) return 1;\r\n        return 0; // Floor/Default\r\n    }\r\n\r\n    private syncToSAB(sharedView: Float32Array, frameCount: number, fps: number) {\r\n        const S = Game3LogicSchema;\r\n        sharedView[S.FRAME_COUNT] = frameCount;\r\n        sharedView[S.FPS] = fps;\r\n\r\n        sharedView[S.HERO_X] = this.hero.x;\r\n        sharedView[S.HERO_Y] = this.hero.y;\r\n        sharedView[S.HERO_VX] = this.hero.vx;\r\n        sharedView[S.HERO_VY] = this.hero.vy;\r\n        sharedView[S.HERO_HP] = this.hp;\r\n\r\n        sharedView[S.HERO_WIDTH] = this.heroWidth;\r\n        sharedView[S.HERO_HEIGHT] = this.heroHeight;\r\n        sharedView[S.HERO_FLIP] = this.flipX ? 1 : 0;\r\n        sharedView[S.HERO_ANIM_STATE] = this.animState;\r\n\r\n        sharedView[S.WORLD_SCALE] = this.worldScale;\r\n        sharedView[S.PLAYER_SCALE] = this.playerScale;\r\n        sharedView[S.PLAYER_OFFSET_Y] = this.playerOffsetY;\r\n\r\n        // SYNC OBJECTS TO SAB\r\n        // We limit to MAX_OBJECTS to prevent buffer overflow\r\n        const objCount = Math.min(this.platforms.length, S.MAX_OBJECTS);\r\n        sharedView[S.OBJ_COUNT] = objCount;\r\n\r\n        for(let i = 0; i < objCount; i++) {\r\n            const p = this.platforms[i];\r\n            const idx = S.OBJ_START_INDEX + (i * S.OBJ_STRIDE);\r\n            sharedView[idx] = p.x;\r\n            sharedView[idx + 1] = p.y;\r\n            sharedView[idx + 2] = p.width;\r\n            sharedView[idx + 3] = p.height;\r\n            sharedView[idx + 4] = this.getPlatformType(p);\r\n        }\r\n    }\r\n\r\n    public override getSnapshot() {\r\n        return {\r\n            hero: { ...this.hero },\r\n            hp: this.hp,\r\n            wallJumpTimer: this.wallJumpTimer,\r\n            wallJumpDirection: this.wallJumpDirection,\r\n            isWallSliding: this.isWallSliding,\r\n            spikeDamageTimer: this.spikeDamageTimer,\r\n            wasInSpike: this.wasInSpike,\r\n            portalCooldown: this.portalCooldown,\r\n            isJumpingFromGround: this.isJumpingFromGround,\r\n            spawnPoint: { ...this.spawnPoint },\r\n            hasCompletedLevel: this.hasCompletedLevel,\r\n            animState: this.animState,\r\n            flipX: this.flipX\r\n        };\r\n    }\r\n\r\n    public override loadSnapshot(data: any) {\r\n        if (data) {\r\n            this.hero = data.hero || this.hero;\r\n            this.hp = data.hp ?? this.hp;\r\n            this.wallJumpTimer = data.wallJumpTimer ?? 0;\r\n            this.wallJumpDirection = data.wallJumpDirection ?? 0;\r\n            this.isWallSliding = data.isWallSliding ?? false;\r\n            this.spikeDamageTimer = data.spikeDamageTimer ?? 0;\r\n            this.wasInSpike = data.wasInSpike ?? false;\r\n            this.portalCooldown = data.portalCooldown ?? 0;\r\n            this.isJumpingFromGround = data.isJumpingFromGround ?? false;\r\n            this.spawnPoint = data.spawnPoint || this.spawnPoint;\r\n            this.hasCompletedLevel = data.hasCompletedLevel ?? false;\r\n            this.animState = data.animState ?? 0;\r\n            this.flipX = data.flipX ?? false;\r\n            this.isInitialized = true;\r\n        }\r\n    }\r\n\r\n    public modifyHP(amount: number) {\r\n        this.hp = Math.max(0, Math.min(100, this.hp + amount));\r\n    }\r\n}"],"names":["Game3Commands","logic","payload","Game3Collision","checkY","p","nextX","nextY","verticalCollided","property","Game3Hazards","collision","currentlyInSpike","portal","portals","otherPortal","Game3Logic","BaseLogic","Game3LogicSchema","BaseDispatcher","config","data","sharedView","intView","frameCount","fps","action","wallSide","moveLeft","moveRight","jumpHeld","moveDir","effectiveGravity","S","objCount","i","idx","amount"],"mappings":"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"}