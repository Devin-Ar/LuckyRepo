import{S as x,R as f,r as y,j as t,F as S}from"./index-_DKrE1GQ.js";import{M as E}from"./MenuState-CWovCLre.js";import{B as R}from"./BaseMenuController-BrIAdAWT.js";import{S as j,a as v,D as w,d as q}from"./SaveManager-Ch1OEj4Z.js";class N extends R{saveManager=j.getInstance();onBack(){this.stateManager.pop()}getActiveGameName(){return this.stateManager.getUnderlyingStateName()||"Unknown"}async handleSave(e){const a=this.getActiveGameName();a&&await this.saveManager.performSave(e,a)}async handleLoad(e){try{const a=await this.saveManager.performLoad(e),c=await x.create(a.stateName,{reset:!1});this.stateManager.pop(),this.stateManager.replace(c)}catch(a){console.error("Failed to load save:",a)}}async handleDelete(e){await this.saveManager.deleteSave(e)}async handleExport(e){const a=await this.saveManager.exportSave(e),c=new Blob([a],{type:"application/octet-stream"}),u=URL.createObjectURL(c),n=document.createElement("a");n.href=u,n.download=`${e}${v}`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(u)}async handleImport(e){const a=await e.text();await this.saveManager.importSave(a)}}function C(o,e,a){var c,u;typeof o=="function"?(c=e||[],u=a):(c=[],u=e);var n=f.useRef({hasResult:!1,result:u,error:null}),h=f.useReducer(function(r){return r+1},0);h[0];var d=h[1],p=f.useMemo(function(){var r=typeof o=="function"?o():o;if(!r||typeof r.subscribe!="function")throw o===r?new TypeError("Given argument to useObservable() was neither a valid observable nor a function."):new TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!n.current.hasResult&&typeof window<"u"&&(typeof r.hasValue!="function"||r.hasValue()))if(typeof r.getValue=="function")n.current.result=r.getValue(),n.current.hasResult=!0;else{var l=r.subscribe(function(i){n.current.result=i,n.current.hasResult=!0});typeof l=="function"?l():l.unsubscribe()}return r},c);if(f.useDebugValue(n.current.result),f.useEffect(function(){var r=p.subscribe(function(l){var i=n.current;(i.error!==null||i.result!==l)&&(i.error=null,i.result=l,i.hasResult=!0,d())},function(l){var i=n.current;i.error!==l&&(i.error=l,d())});return typeof r=="function"?r:r.unsubscribe.bind(r)},c),n.current.error)throw n.current.error;return n.current.result}function k(o,e,a){return C(function(){return w.liveQuery(o)},[],a)}typeof FinalizationRegistry<"u"&&new FinalizationRegistry(function(o){var e=w.DexieYProvider;e&&e.release(o)});const M=({activeStateName:o,onSave:e,onLoad:a,onDelete:c,onExport:u,onImport:n,onBack:h})=>{const d=k(()=>q.saves.orderBy("timestamp").reverse().toArray()),[p,r]=y.useState(""),l=y.useRef(null),i=()=>{p.trim()&&(e(p.trim()),r(""))},b=s=>{s.target.files&&s.target.files[0]&&n(s.target.files[0])};return t.jsx("div",{style:D,children:t.jsxs("div",{style:T,children:[t.jsx("h2",{style:A,children:"DATA_STORAGE_INTERFACE"}),t.jsxs("div",{style:I,children:[t.jsx("input",{type:"text",value:p,onChange:s=>r(s.target.value),placeholder:"ENTER_SAVE_NAME...",style:B,onKeyDown:s=>s.key==="Enter"&&i()}),t.jsx("button",{onClick:i,style:g("#27ae60"),children:"SAVE_NEW"}),t.jsx("div",{style:{width:"2cqw"}}),t.jsx("button",{onClick:()=>l.current?.click(),style:g("#8e44ad"),children:"IMPORT_FILE"}),t.jsx("input",{type:"file",ref:l,style:{display:"none"},accept:v,onChange:b})]}),t.jsx("div",{style:O,children:!d||d.length===0?t.jsx("div",{style:{color:"#555",marginTop:"2cqw"},children:"NO_DATA_FOUND"}):d.map(s=>t.jsxs("div",{style:L,children:[t.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[t.jsx("span",{style:{color:"#fff",fontSize:"1.2cqw",fontWeight:"bold"},children:s.saveName}),t.jsxs("span",{style:{color:"#888",fontSize:"0.8cqw"},children:[s.stateName," | ",new Date(s.timestamp).toLocaleString()]})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5cqw"},children:[t.jsx("button",{onClick:()=>e(s.saveName),style:m("#27ae60"),children:"OVERWRITE"}),t.jsx("button",{onClick:()=>a(s.saveName),style:m("#2980b9"),children:"LOAD"}),t.jsx("button",{onClick:()=>u(s.saveName),style:m("#d35400"),children:"EXPORT"}),t.jsx("button",{onClick:()=>c(s.saveName),style:m("#c0392b"),children:"DEL"})]})]},s.saveName))}),t.jsx("button",{onClick:h,style:_,children:"RETURN_TO_SYSTEM"})]})})},D={position:"absolute",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center"},T={position:"relative",width:"100%",height:"100%",maxWidth:"calc(100vh * (16 / 9))",maxHeight:"calc(100vw * (9 / 16))",aspectRatio:"16 / 9",backgroundColor:"rgba(5, 5, 5, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",padding:"2cqw",fontFamily:"monospace",zIndex:3e3,containerType:"size"},A={fontSize:"2.5cqw",color:"#0f0",letterSpacing:"0.2cqw",marginBottom:"1.5cqw"},I={display:"flex",width:"80%",gap:"1cqw",marginBottom:"1.5cqw"},O={flex:1,width:"80%",overflowY:"auto",border:"1px solid #333",padding:"1cqw",backgroundColor:"#0a0a0a",display:"flex",flexDirection:"column",gap:"0.5cqw"},L={display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"#111",padding:"1cqw",borderRadius:"0.3cqw",borderLeft:"0.3cqw solid #444"},B={flex:1,backgroundColor:"#222",border:"1px solid #444",color:"white",padding:"0.5cqw",fontFamily:"monospace",fontSize:"1cqw"},g=o=>({padding:"0 1.5cqw",backgroundColor:o,color:"white",border:"none",cursor:"pointer",fontFamily:"monospace",fontWeight:"bold",fontSize:"1cqw"}),m=o=>({padding:"0.4cqw 0.8cqw",backgroundColor:o,color:"white",border:"none",cursor:"pointer",fontFamily:"monospace",fontSize:"0.8cqw",borderRadius:"0.2cqw"}),_={marginTop:"1.5cqw",width:"15cqw",padding:"0.8cqw",backgroundColor:"#c0392b",color:"white",border:"none",cursor:"pointer",fontFamily:"monospace",fontWeight:"bold",fontSize:"1cqw"};class W extends E{name=S.SAVE_MENU;constructor(){super(()=>new N)}getView(){return f.createElement(M,{activeStateName:this.controller.getActiveGameName(),onBack:()=>this.controller.onBack(),onSave:e=>this.controller.handleSave(e),onLoad:e=>this.controller.handleLoad(e),onDelete:e=>this.controller.handleDelete(e),onExport:e=>this.controller.handleExport(e),onImport:e=>this.controller.handleImport(e)})}}export{W as SaveMenuState};
//# sourceMappingURL=SaveMenuState-GJyh1nQE.js.map
