class A{loaders=new Map;register(i){this.loaders.set(i.id,i.loader)}async create(i){const o=this.loaders.get(i);if(!o)throw new Error(`WorkerRegistry: No loader registered for ID "${i}"`);const s=await o();return new s}}const L=new A,y=new A;var w=(e=>(e.GAME_1="Game1",e.GAME_2="Game2",e.GAME_3="Game3",e.BH_GAME="BHGame",e.DEV_MENU="DevMenu",e.PAUSE_MENU="PauseMenu",e.SAVE_MENU="SaveMenu",e.SETTINGS_MENU="SettingsMenu",e.CONTINUE="ContinueScreen",e.GAME_OVER="GameOverScreen",e.MAIN_MENU="MainMenu",e))(w||{});const m={id:w.GAME_1,logicLoader:()=>import("./Game1Logic-BLTRHNl1.js").then(e=>e.Game1Logic),viewLoader:()=>import("./Game1ViewLogic-C-yug3dU.js").then(e=>e.Game1ViewLogic)},S={id:w.GAME_2,logicLoader:()=>import("./Game2Logic-B1dLFliD.js").then(e=>e.Game2Logic),viewLoader:()=>import("./Game2ViewLogic-CzviCqce.js").then(e=>e.Game2ViewLogic)},_={id:w.BH_GAME,logicLoader:()=>import("./BHTestLogic-CdzPMDc7.js").then(e=>e.BHTestLogic),viewLoader:()=>import("./BHViewLogic-C9L5ABqO.js").then(e=>e.BHViewLogic)},W={id:w.GAME_3,logicLoader:()=>import("./Game3Logic-8uAUsKqs.js").then(e=>e.Game3Logic),viewLoader:()=>import("./Game3ViewLogic-DPkc8O56.js").then(e=>e.Game3ViewLogic)},N=[m,S,W,_],I=()=>{N.forEach(e=>{e.logicLoader&&L.register({id:e.id,loader:e.logicLoader}),e.viewLoader&&y.register({id:e.id,loader:e.viewLoader})})};I();const c=new Map,d=new Map,p=new Map,a=new Map,f=new Map;self.onmessage=async e=>{const{type:i,stateName:o,payload:s,frameCount:G,fps:T}=e.data;switch(i){case"INIT_SABS":console.log("[Worker] Initializing Buffer Map"),c.clear(),d.clear(),p.clear(),s.buffers&&Object.entries(s.buffers).forEach(([r,t])=>{c.set(r,t),d.set(r,new Float32Array(t)),p.set(r,new Int32Array(t))}),a.forEach((r,t)=>{if(typeof r.setBuffers=="function"){const n={};c.forEach((g,k)=>n[k]=g),r.setBuffers(n)}});break;case"UPDATE_BUFFER":const{name:h,buffer:M}=s;c.set(h,M),d.set(h,new Float32Array(M)),p.set(h,new Int32Array(M)),a.forEach(r=>{if(typeof r.setBuffers=="function"){console.log(`[Worker] Updating buffer views for existing state: ${h}`);const t={};c.forEach((n,g)=>t[g]=n),r.setBuffers(t)}});break;case"CREATE_STATE":if(!a.has(o))if(f.has(o))await f.get(o);else{const r=(async()=>{const t=await L.create(o);if(c.size>0){const n={};c.forEach((g,k)=>n[k]=g),t.setBuffers(n)}return t})();f.set(o,r);try{const t=await r;a.set(o,t),console.log(`[Worker] Loaded Logic: ${o}`)}catch(t){console.error(`[Worker] Failed to create state: ${o}`,t)}finally{f.delete(o)}}break;case"TERMINATE_STATE":a.has(o)?(console.log(`[Worker] Terminated Logic for: ${o}`),a.get(o).destroy(),a.delete(o)):console.warn(`[Worker] Attempted to terminate non-existent state: ${o}`);break;case"TERMINATE_ALL":console.log(`[Worker] Terminating all logic states. Count: ${a.size}`),a.forEach(r=>r.destroy()),a.clear();break;case"INPUT":let l=a.get(o);if(!l&&f.has(o))try{l=await f.get(o)}catch{}if(l)if(s.action==="GET_SNAPSHOT"){console.info(`[Worker] [${o}] Generating Snapshot`);const r=e.ports[0];r&&r.postMessage(l.getSnapshot())}else s.action==="LOAD_SNAPSHOT"?(console.info(`[Worker] [${o}] Loading Snapshot`),l.loadSnapshot(s.data)):(console.debug(`[Worker] [${o}] Input: ${s.action||"Unknown Action"}`),l.handleInput(s));else console.error(`[Worker] Received INPUT for unknown state: ${o}`);break;case"TICK":const E=a.get(o);E&&d.size>0&&E.update(d,p,G,T);break;default:console.warn(`[Worker] Unhandled message type: ${i}`);break}};
//# sourceMappingURL=logic.worker-B5OWqqMl.js.map
