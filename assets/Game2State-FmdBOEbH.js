import{a as S,B as L,b,G as E}from"./BasePresenter-1Bp8xzT5.js";import{j as t,r as x,d as h,F as c,S as p,a as u,I as C,C as v,e as m}from"./index-_DKrE1GQ.js";import{S as I}from"./SaveManager-Ch1OEj4Z.js";const _={HERO_HP:0,ENERGY:1,SCRAP_COUNT:2,TICK_COUNT:3,FRAME_COUNT:4,FPS:5,REVISION:6,BUFFER_SIZE:1024},l={HERO_HP_DISPLAY:0,ENERGY_DISPLAY:1,SCRAP_DISPLAY:2,UI_BOUNCE:3,GLITCH_INTENSITY:4,VIGNETTE_PULSE:5,BUFFER_SIZE:1024},w=({stats:s,onAction:e,onJumpG1:n,onLevel1:o,onLevel2:i,onLevel3:g,onQuickLoad:f,onNextLevel:y,onFailLevel:d})=>{const r={padding:"1.5cqw",border:"0.1cqw solid",borderRadius:"0.5cqw",display:"flex",flexDirection:"column",gap:"1cqh"},a={padding:"0.5cqw 1cqw",cursor:"pointer",background:"#222",color:"#eee",border:"0.1cqw solid #444",fontSize:"0.8cqw",pointerEvents:"auto"};return t.jsxs("div",{style:{position:"absolute",inset:0,pointerEvents:"none",containerType:"size",padding:"2cqw"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#00ff00",fontFamily:"monospace"},children:[t.jsx("h2",{style:{fontSize:"1.5cqw",margin:0},children:"SYSTEM_DIAGNOSTICS"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5cqh",alignItems:"flex-end"},children:[t.jsxs("div",{style:{display:"flex",gap:"0.5cqw"},children:[t.jsx("button",{onClick:o,style:{...a,background:"#1b4d1b"},children:"LVL 1"}),t.jsx("button",{onClick:i,style:{...a,background:"#4d431b"},children:"LVL 2"}),t.jsx("button",{onClick:g,style:{...a,background:"#4d1b1b"},children:"LVL 3"})]}),t.jsxs("div",{style:{display:"flex",gap:"0.5cqw"},children:[t.jsx("button",{onClick:y,style:{...a,borderColor:"#8e44ad",color:"#67ad44"},children:"NEXT_STEP"}),t.jsx("button",{onClick:d,style:{...a,borderColor:"#8e44ad",color:"#ad4444"},children:"FAIL_STEP"}),t.jsx("button",{onClick:n,style:{...a,borderColor:"#3498db"},children:"GOTO_G1"}),t.jsx("button",{onClick:f,style:{...a,borderColor:"#c0392b"},children:"RELOAD"})]})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"2cqw",marginTop:"2cqh",pointerEvents:"auto"},children:[t.jsxs("div",{style:{...r,borderColor:"#00ff00",color:"#00ff00"},children:[t.jsx("span",{children:"GLOBAL_HP"}),t.jsx("b",{style:{fontSize:"2cqw"},children:s.hp.toFixed(1)}),t.jsxs("div",{style:{display:"flex",gap:"0.5cqw"},children:[t.jsx("button",{onClick:()=>e("MOD_HP",10),style:a,children:"+10"}),t.jsx("button",{onClick:()=>e("MOD_HP",-10),style:a,children:"-10"})]})]}),t.jsxs("div",{style:{...r,borderColor:"#3498db",color:"#3498db"},children:[t.jsx("span",{children:"GLOBAL_ENERGY"}),t.jsx("b",{style:{fontSize:"2cqw"},children:s.energy}),t.jsx("button",{onClick:()=>e("MOD_ENERGY",5),style:a,children:"RECHARGE"})]}),t.jsxs("div",{style:{...r,borderColor:"#f1c40f",color:"#f1c40f"},children:[t.jsx("span",{children:"LOCAL_SCRAP"}),t.jsx("b",{style:{fontSize:"2cqw"},children:s.scrap}),t.jsx("button",{onClick:()=>e("ADD_SCRAP"),style:a,children:"COLLECT"})]})]})]})},j=({vm:s,controller:e})=>{const[n,o]=x.useState({hp:s.hp,energy:s.energy,scrap:s.scrap}),[i,g]=x.useState({uiOffset:0,glitch:0,pulse:0});x.useEffect(()=>{const d=s.subscribe(()=>{o({hp:s.hp,energy:s.energy,scrap:s.scrap});const r=s.visualEffects;g({uiOffset:r.uiOffset,glitch:r.glitchIntensity,pulse:r.vignettePulse})});return()=>d()},[s]);const f=(Math.random()-.5)*20*i.glitch,y=(Math.random()-.5)*20*i.glitch;return t.jsx("div",{style:{position:"absolute",inset:0,background:"#000",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:t.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",maxWidth:"calc(100vh * (16 / 9))",maxHeight:"calc(100vw * (9 / 16))",aspectRatio:"16 / 9",background:"#adadad",overflow:"hidden",transform:`translate(${f}px, ${y}px)`,textShadow:i.glitch>.1?`${i.glitch*5}px 0 #f00, -${i.glitch*5}px 0 #0ff`:"none"},children:[t.jsx("div",{style:{position:"absolute",inset:0,background:`radial-gradient(circle, transparent 40%, rgba(0,0,0,${.8*i.pulse}))`,pointerEvents:"none",zIndex:1}}),t.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"#050505",fontSize:"10cqw",fontWeight:"bold",transform:`translateY(${i.uiOffset}px)`,opacity:.3+i.glitch*.7},children:"LAB_02"}),t.jsx(w,{stats:n,onAction:(d,r)=>e.modifyStat(d,r),onJumpG1:e.jumpToGame1,onLevel1:()=>e.loadLevel(h.Level1),onLevel2:()=>e.loadLevel(h.Level2),onLevel3:()=>e.loadLevel(h.Level3),onQuickLoad:()=>e.resetLevel(),onNextLevel:()=>e.nextLevel(),onFailLevel:()=>e.failLevel()})]})})};class G extends S{get hp(){return this.sharedView[l.HERO_HP_DISPLAY]||0}get energy(){return this.sharedView[l.ENERGY_DISPLAY]||0}get scrap(){return this.sharedView[l.SCRAP_DISPLAY]||0}get visualEffects(){return{uiOffset:this.sharedView[l.UI_BOUNCE]||0,glitchIntensity:this.sharedView[l.GLITCH_INTENSITY]||0,vignettePulse:this.sharedView[l.VIGNETTE_PULSE]||0}}}class A extends L{constructor(e){super(e,c.GAME_2)}modifyStat(e,n){this.send(e,{amount:n})}async jumpToGame1(){const e=await p.create(c.GAME_1,{reset:!1});u.getInstance().replace(e)}async loadLevel(e){const n=await p.create(c.GAME_2,{reset:!1,level:e});u.getInstance().replace(n)}async resetLevel(){await I.getInstance().performLoad(this.QUICK_SAVE_KEY);const e=this.vm.currentLevel||h.Level1,n=await p.create(c.GAME_2,{reset:!1,level:e});u.getInstance().replace(n)}onKeyDown(e){C.getInstance().isKeyAction(e.key,"PAUSE")&&this.handleEscape()}onWorkerEvent(e){}async handleEscape(){const e=await p.create(c.PAUSE_MENU);u.getInstance().push(e)}nextLevel(){v.getInstance().completeCurrentStep()}failLevel(){v.getInstance().failCurrentStep()}}class R extends b{name=c.GAME_2;logicSchema=_;viewSchema=l;viewComponent=j;currentLevel;constructor(e={}){super(e.reset??!1),this.currentLevel=e.level??h.Level1}getConfig(){return m(this.currentLevel)}getSessionOverrides(e){const n={},o=e.get(E.hp);o!==void 0&&(n.initialHP=o);const i=e.get(E.energy);return i!==void 0&&(n.initialEnergy=i),n}initMVC(){this.vm=new G,this.controller=new A(this.vm)}}export{R as Game2State};
//# sourceMappingURL=Game2State-FmdBOEbH.js.map
