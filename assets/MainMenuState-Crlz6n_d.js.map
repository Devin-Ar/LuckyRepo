{"version":3,"file":"MainMenuState-Crlz6n_d.js","sources":["../../src/features/MainMenu/MainMenuController.ts","../../src/features/MainMenu/MainMenuView.tsx","../../src/features/MainMenu/MainMenuState.ts"],"sourcesContent":["// src/features/MainMenu/MainMenuController.ts\r\nimport { BaseMenuController } from \"../../core/templates/BaseMenuController\";\r\nimport { StateManager } from \"../../core/managers/StateManager\";\r\nimport { StateRegistry } from \"../../core/registry/StateRegistry\";\r\nimport { FeatureEnum } from \"../FeatureEnum\";\r\nimport { CampaignManager } from \"../../core/managers/CampaignManager\";\r\nimport { InputManager } from \"../../core/managers/InputManager\";\r\nimport { AudioManager } from \"../../core/managers/AudioManager\";\r\n\r\nexport class MainMenuController extends BaseMenuController {\r\n    private campaign = CampaignManager.getInstance();\r\n    private audio = AudioManager.getInstance();\r\n\r\n    private selectedIndex: number = 0;\r\n    private readonly MENU_COUNT: number = 4;\r\n    private onViewUpdate?: (index: number) => void;\r\n\r\n    private resOverride: any;\r\n    private setResOverride: any;\r\n\r\n    public bindView(callback: (index: number) => void, res: any, setRes: any) {\r\n        this.onViewUpdate = callback;\r\n        this.resOverride = res;\r\n        this.setResOverride = setRes;\r\n        this.onViewUpdate(this.selectedIndex);\r\n    }\r\n\r\n    public unbindView() { this.onViewUpdate = undefined; }\r\n\r\n    public playBGM() {\r\n        this.audio.play('bgm_menu');\r\n    }\r\n\r\n    public stopBGM() {\r\n        this.audio.stop('bgm_menu');\r\n    }\r\n\r\n    private playNavSFX() {\r\n        this.audio.play('sfx_nav');\r\n    }\r\n\r\n    public setHoverIndex(index: number) {\r\n        if (this.selectedIndex !== index) {\r\n            this.selectedIndex = index;\r\n            this.playNavSFX();\r\n            this.onViewUpdate?.(this.selectedIndex);\r\n        }\r\n    }\r\n\r\n    protected onKeyDown(e: KeyboardEvent): void {\r\n        const input = InputManager.getInstance();\r\n        let changed = false;\r\n\r\n        if (input.isKeyAction(e.key, \"UI_DOWN\")) {\r\n            this.selectedIndex = (this.selectedIndex + 1) % this.MENU_COUNT;\r\n            changed = true;\r\n        } else if (input.isKeyAction(e.key, \"UI_UP\")) {\r\n            this.selectedIndex = (this.selectedIndex - 1 + this.MENU_COUNT) % this.MENU_COUNT;\r\n            changed = true;\r\n        } else if (input.isKeyAction(e.key, \"UI_ACCEPT\")) {\r\n            this.executeSelected();\r\n        }\r\n\r\n        if (changed) {\r\n            this.playNavSFX();\r\n            this.onViewUpdate?.(this.selectedIndex);\r\n        }\r\n    }\r\n\r\n    public executeSelected() {\r\n        switch(this.selectedIndex) {\r\n            case 0: this.campaign.startCampaign('cross_game'); break;\r\n            case 1: this.openPopup(FeatureEnum.SAVE_MENU); break;\r\n            case 2: this.openPopup(FeatureEnum.SETTINGS_MENU, { res: this.resOverride, setRes: this.setResOverride }); break;\r\n            case 3: this.handleNav(FeatureEnum.DEV_MENU); break;\r\n        }\r\n    }\r\n\r\n    public async handleNav(id: FeatureEnum, params: any = {}) {\r\n        const target = await StateRegistry.create(id, { reset: false, ...params });\r\n        StateManager.getInstance().replace(target);\r\n    }\r\n\r\n    public async openPopup(id: FeatureEnum, params: any = {}) {\r\n        const target = await StateRegistry.create(id, params);\r\n        StateManager.getInstance().push(target);\r\n    }\r\n\r\n    public onBack(): void {\r\n    }\r\n}","// src/features/MainMenu/MainMenuView.tsx\r\nimport React, { useState, useEffect } from 'react';\r\nimport * as PIXI from 'pixi.js';\r\nimport { Stage, useApp, useTick } from '@pixi/react';\r\nimport { MainMenuController } from './MainMenuController';\r\nimport { GameSprite } from '../../components/GameSprite';\r\n\r\nconst PixiForceResizer: React.FC<{ w: number, h: number }> = ({ w, h }) => {\r\n    const app = useApp();\r\n    useEffect(() => {\r\n        if (app?.renderer) {\r\n            app.renderer.resize(w, h);\r\n            PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\r\n            PIXI.settings.ROUND_PIXELS = true;\r\n\r\n            if (app.view instanceof HTMLCanvasElement) {\r\n                app.view.width = w;\r\n                app.view.height = h;\r\n                app.view.style.imageRendering = 'pixelated';\r\n            }\r\n        }\r\n    }, [app, w, h]);\r\n    return null;\r\n};\r\n\r\nconst MenuAnimatedSprite: React.FC<{ animationName: string }> = () => {\r\n    const [frame, setFrame] = useState(0);\r\n\r\n    useEffect(() => {\r\n        setFrame(0);\r\n    }, ['main']);\r\n\r\n    useTick((delta) => {\r\n        setFrame(f => f + (4 / 60) * delta);\r\n    });\r\n\r\n    return (\r\n        <GameSprite\r\n            sheetName=\"main_splash\"\r\n            animationName={'main'}\r\n            currentFrame={Math.floor(frame)}\r\n            x={0}\r\n            y={0}\r\n            anchor={0}\r\n            scale={1}\r\n        />\r\n    );\r\n};\r\n\r\ninterface MainMenuViewProps {\r\n    controller: MainMenuController;\r\n    res?: string;\r\n    setRes?: (r: any) => void;\r\n}\r\n\r\nexport const MainMenuView: React.FC<MainMenuViewProps> = ({ controller, res, setRes }) => {\r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n\r\n    useEffect(() => {\r\n        controller.bindView(setSelectedIndex, res, setRes);\r\n        return () => controller.unbindView();\r\n    }, [controller, res, setRes]);\r\n\r\n    const menuItems = [\"Start Game\", \"Load Game\", \"Options\", \"Legacy Menu\"];\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'absolute', inset: 0,\r\n            background: '#000',\r\n            display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n            overflow: 'hidden'\r\n        }}>\r\n            <style>{menuStyles}</style>\r\n            <div style={{\r\n                position: 'relative',\r\n                width: '100%', height: '100%',\r\n                maxWidth: 'calc(100vh * (16 / 9))',\r\n                maxHeight: 'calc(100vw * (9 / 16))',\r\n                aspectRatio: '16 / 9',\r\n                backgroundColor: '#000000',\r\n                boxSizing: 'border-box', fontFamily: 'monospace',\r\n                display: 'flex'\r\n            }}>\r\n\r\n                <div style={{\r\n                    flex: 1,\r\n                    borderTop: '2.8cqw solid #000000',\r\n                    borderBottom: '2.8cqw solid #000000',\r\n                    padding: '5cqw',\r\n                    display: 'flex', flexDirection: 'column',\r\n                    justifyContent: 'center', gap: '1.5cqw',\r\n                    backgroundColor: '#3f3f3f'\r\n                }}>\r\n                    {menuItems.map((label, idx) => (\r\n                        <button\r\n                            key={idx}\r\n                            className={`menu-button ${selectedIndex === idx ? 'menu-button-active' : ''}`}\r\n                            onMouseEnter={() => controller.setHoverIndex(idx)}\r\n                            onClick={() => controller.executeSelected()}\r\n                            style={{\r\n                                padding: '1.2cqw',\r\n                                backgroundColor: selectedIndex === idx ? '#7f0000' : '#400000',\r\n                                color: selectedIndex === idx ? '#ffffff' : '#bfbfbf',\r\n                                borderColor: selectedIndex === idx ? '#ffffff' : '#000000',\r\n                                cursor: 'pointer',\r\n                                fontSize: '2cqw', fontWeight: 'bold',\r\n                                textAlign: 'left', textTransform: 'uppercase',\r\n                                transition: 'all 0.1s ease-in-out'\r\n                            }}\r\n                        >\r\n                            {selectedIndex === idx ? `> ${label}` : label}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                <div style={{\r\n                    flex: 3,\r\n                    position: 'relative',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                    overflow: 'hidden'\r\n                }}>\r\n                    <Stage\r\n                        width={240}\r\n                        height={180}\r\n                        options={{\r\n                            backgroundColor: 0x0a0a0a,\r\n                            backgroundAlpha: 0,\r\n                            antialias: false,\r\n                            resolution: 1,\r\n                            autoDensity: false\r\n                        }}\r\n                        style={{\r\n                            width: '100%',\r\n                            height: '100%',\r\n                            objectFit: 'contain',\r\n                            imageRendering: 'pixelated',\r\n                            display: 'block'\r\n                        }}\r\n                    >\r\n                        <PixiForceResizer w={240} h={180} />\r\n                        <MenuAnimatedSprite animationName={'main'} />\r\n                    </Stage>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst menuStyles = `\r\n  @keyframes pulse {\r\n    0% { transform: translateX(0); }\r\n    50% { transform: translateX(0.5cqw); }\r\n    100% { transform: translateX(0); }\r\n  }\r\n  .menu-button {\r\n    border-top: none;\r\n    border-left: none;\r\n    border-bottom-width: 0.5cqw;\r\n    border-bottom-style: solid;\r\n    border-right-width: 0.5cqw;\r\n    border-right-style: solid;\r\n    clip-path: polygon(0 0, calc(100% - 3cqw) 0, calc(100% - 3cqw) 1cqw, 100% 1cqw, 100% 100%, 0 100%);\r\n  }\r\n  .menu-button-active {\r\n    animation: pulse 2s infinite ease-in-out;\r\n  }\r\n`;\r\n","// src/features/MainMenu/MainMenuState.ts\r\nimport React, { JSX } from 'react';\r\nimport { State } from '../../core/templates/State';\r\nimport { FeatureEnum } from '../FeatureEnum';\r\nimport { MainMenuController } from './MainMenuController';\r\nimport { MainMenuView } from './MainMenuView';\r\nimport { InputManager } from '../../core/managers/InputManager';\r\nimport { AudioManager } from \"../../core/managers/AudioManager\";\r\nimport { SpriteManager } from \"../../core/managers/SpriteManager\";\r\n\r\nexport class MainMenuState extends State {\r\n    public name = FeatureEnum.MAIN_MENU;\r\n    private readonly controller: MainMenuController;\r\n    protected params: any;\r\n\r\n    private readonly MANIFEST_PATH = \"res/mainManifest.json\";\r\n\r\n    constructor(params?: any) {\r\n        super();\r\n        this.params = params || {};\r\n        this.controller = new MainMenuController();\r\n    }\r\n\r\n    public async init(): Promise<void> {\r\n        await AudioManager.getInstance().loadManifest(this.MANIFEST_PATH, this.name);\r\n        await SpriteManager.getInstance().loadManifest(this.MANIFEST_PATH, this.name);\r\n        InputManager.getInstance().refreshBindings(\"Shared\");\r\n        this.controller.init(this.name as FeatureEnum);\r\n        this.controller.playBGM();\r\n        this.isRendering = true;\r\n    }\r\n\r\n    public update(dt: number, frameCount: number): void {}\r\n\r\n    public getView(): JSX.Element {\r\n        return React.createElement(MainMenuView, {\r\n            key: this.name,\r\n            controller: this.controller,\r\n            res: this.params.res,\r\n            setRes: this.params.setRes\r\n        });\r\n    }\r\n\r\n    public destroy(): void {\r\n        this.controller.stopBGM();\r\n        AudioManager.getInstance().uncacheByState(this.name);\r\n        SpriteManager.getInstance().uncacheByState(this.name);\r\n        this.controller.destroy();\r\n    }\r\n}"],"names":["MainMenuController","BaseMenuController","CampaignManager","AudioManager","callback","res","setRes","index","input","InputManager","changed","FeatureEnum","id","params","target","StateRegistry","StateManager","PixiForceResizer","w","h","app","useApp","useEffect","PIXI.settings","PIXI.SCALE_MODES","MenuAnimatedSprite","frame","setFrame","useState","useTick","delta","f","jsx","GameSprite","MainMenuView","controller","selectedIndex","setSelectedIndex","menuItems","jsxs","menuStyles","label","idx","Stage","MainMenuState","State","SpriteManager","dt","frameCount","React"],"mappings":"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"}