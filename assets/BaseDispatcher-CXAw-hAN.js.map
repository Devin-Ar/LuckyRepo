{"version":3,"file":"BaseDispatcher-CXAw-hAN.js","sources":["../src/core/templates/BaseLogic.ts","../src/core/templates/BaseDispatcher.ts"],"sourcesContent":["// src/core/templates/BaseLogic.ts\r\nimport {IDispatcher} from '../interfaces/IDispatcher';\r\nimport {ILogic} from '../interfaces/ILogic';\r\n\r\nexport abstract class BaseLogic<TConfig = any> implements ILogic {\r\n    protected isInitialized: boolean = false;\r\n    protected abstract dispatcher: IDispatcher;\r\n\r\n    protected sharedViews: Map<string, Float32Array> = new Map();\r\n    protected intViews: Map<string, Int32Array> = new Map();\r\n\r\n    protected config: TConfig | null = null;\r\n\r\n    protected inputState = {\r\n        actions: [] as string[],\r\n        mouseX: 0,\r\n        mouseY: 0,\r\n        isMouseDown: false,\r\n        isHovering: false\r\n    };\r\n\r\n    protected constructor(protected revisionIndex: number) {\r\n    }\r\n\r\n    public setBuffers(buffers: Record<string, SharedArrayBuffer>): void {\r\n        this.sharedViews.clear();\r\n        this.intViews.clear();\r\n\r\n        Object.entries(buffers).forEach(([key, buffer]) => {\r\n            this.sharedViews.set(key, new Float32Array(buffer));\r\n            this.intViews.set(key, new Int32Array(buffer));\r\n        });\r\n    }\r\n\r\n    protected get sharedView(): Float32Array {\r\n        const view = this.sharedViews.get('main') || this.sharedViews.values().next().value;\r\n        if (!view) throw new Error(`[BaseLogic] No SharedView available for ${this.constructor.name}`);\r\n        return view as Float32Array;\r\n    }\r\n\r\n    protected get intView(): Int32Array {\r\n        const view = this.intViews.get('main') || this.intViews.values().next().value;\r\n        if (!view) throw new Error(`[BaseLogic] No IntView available for ${this.constructor.name}`);\r\n        return view as Int32Array;\r\n    }\r\n\r\n    public setInitialized(val: boolean): void {\r\n        this.isInitialized = val;\r\n        if (val) this.onInitialize();\r\n    }\r\n\r\n    public abstract applyConfig(config: TConfig): void;\r\n\r\n    public update(\r\n        sharedViewsMap: any,\r\n        intViewsMap: any,\r\n        frameCount: number,\r\n        fps: number\r\n    ): void {\r\n        if (!this.isInitialized || this.sharedViews.size === 0) return;\r\n\r\n        this.onUpdate(this.sharedView, this.intView, frameCount, fps);\r\n\r\n        const mainIntView = this.intView;\r\n        if(mainIntView) {\r\n            Atomics.add(mainIntView, this.revisionIndex, 1);\r\n        }\r\n    }\r\n\r\n    public handleInput(payload: any): void {\r\n        if (payload.action === 'SYNC_INPUT') {\r\n            this.inputState.actions = payload.actions || [];\r\n            this.inputState.mouseX = payload.mouseX || 0;\r\n            this.inputState.mouseY = payload.mouseY || 0;\r\n            this.inputState.isMouseDown = !!payload.isMouseDown;\r\n            this.inputState.isHovering = !!payload.isHovering;\r\n            return;\r\n        }\r\n        this.dispatcher.dispatch(payload.action, payload);\r\n    }\r\n\r\n    public destroy(): void {\r\n        this.isInitialized = false;\r\n        this.config = null;\r\n    }\r\n\r\n    public getSnapshot(): any {\r\n        return {};\r\n    }\r\n\r\n    public loadSnapshot(data: any): void {\r\n    }\r\n\r\n    protected abstract onUpdate(sharedView: Float32Array, intView: Int32Array, frameCount: number, fps: number): void;\r\n\r\n    protected onInitialize(): void {\r\n    }\r\n}","// src/core/templates/BaseDispatcher.ts\r\nimport {IDispatcher} from '../interfaces/IDispatcher';\r\nimport {ICommand} from '../interfaces/ICommand';\r\n\r\nexport class BaseDispatcher<T> implements IDispatcher {\r\n\r\n    constructor(\r\n        private logic: T,\r\n        private commands: Record<string, ICommand>,\r\n        private debugName: string = \"Dispatcher\"\r\n    ) {\r\n    }\r\n\r\n    public dispatch(action: string, payload: any): void {\r\n        const command = this.commands[action];\r\n        if (command) {\r\n            command.execute(this.logic, payload);\r\n        } else {\r\n            console.warn(`[${this.debugName}] Unknown action: ${action}`);\r\n        }\r\n    }\r\n}"],"names":["BaseLogic","revisionIndex","buffers","key","buffer","view","val","sharedViewsMap","intViewsMap","frameCount","fps","mainIntView","payload","data","BaseDispatcher","logic","commands","debugName","action","command"],"mappings":"AAIO,MAAeA,CAA2C,CAiBnD,YAAsBC,EAAuB,CAAvB,KAAA,cAAAA,CAChC,CAjBU,cAAyB,GAGzB,gBAA6C,IAC7C,aAAwC,IAExC,OAAyB,KAEzB,WAAa,CACnB,QAAS,CAAA,EACT,OAAQ,EACR,OAAQ,EACR,YAAa,GACb,WAAY,EAAA,EAMT,WAAWC,EAAkD,CAChE,KAAK,YAAY,MAAA,EACjB,KAAK,SAAS,MAAA,EAEd,OAAO,QAAQA,CAAO,EAAE,QAAQ,CAAC,CAACC,EAAKC,CAAM,IAAM,CAC/C,KAAK,YAAY,IAAID,EAAK,IAAI,aAAaC,CAAM,CAAC,EAClD,KAAK,SAAS,IAAID,EAAK,IAAI,WAAWC,CAAM,CAAC,CACjD,CAAC,CACL,CAEA,IAAc,YAA2B,CACrC,MAAMC,EAAO,KAAK,YAAY,IAAI,MAAM,GAAK,KAAK,YAAY,SAAS,KAAA,EAAO,MAC9E,GAAI,CAACA,EAAM,MAAM,IAAI,MAAM,2CAA2C,KAAK,YAAY,IAAI,EAAE,EAC7F,OAAOA,CACX,CAEA,IAAc,SAAsB,CAChC,MAAMA,EAAO,KAAK,SAAS,IAAI,MAAM,GAAK,KAAK,SAAS,SAAS,KAAA,EAAO,MACxE,GAAI,CAACA,EAAM,MAAM,IAAI,MAAM,wCAAwC,KAAK,YAAY,IAAI,EAAE,EAC1F,OAAOA,CACX,CAEO,eAAeC,EAAoB,CACtC,KAAK,cAAgBA,EACjBA,QAAU,aAAA,CAClB,CAIO,OACHC,EACAC,EACAC,EACAC,EACI,CACJ,GAAI,CAAC,KAAK,eAAiB,KAAK,YAAY,OAAS,EAAG,OAExD,KAAK,SAAS,KAAK,WAAY,KAAK,QAASD,EAAYC,CAAG,EAE5D,MAAMC,EAAc,KAAK,QACtBA,GACC,QAAQ,IAAIA,EAAa,KAAK,cAAe,CAAC,CAEtD,CAEO,YAAYC,EAAoB,CACnC,GAAIA,EAAQ,SAAW,aAAc,CACjC,KAAK,WAAW,QAAUA,EAAQ,SAAW,CAAA,EAC7C,KAAK,WAAW,OAASA,EAAQ,QAAU,EAC3C,KAAK,WAAW,OAASA,EAAQ,QAAU,EAC3C,KAAK,WAAW,YAAc,CAAC,CAACA,EAAQ,YACxC,KAAK,WAAW,WAAa,CAAC,CAACA,EAAQ,WACvC,MACJ,CACA,KAAK,WAAW,SAASA,EAAQ,OAAQA,CAAO,CACpD,CAEO,SAAgB,CACnB,KAAK,cAAgB,GACrB,KAAK,OAAS,IAClB,CAEO,aAAmB,CACtB,MAAO,CAAA,CACX,CAEO,aAAaC,EAAiB,CACrC,CAIU,cAAqB,CAC/B,CACJ,CC7FO,MAAMC,CAAyC,CAElD,YACYC,EACAC,EACAC,EAAoB,aAC9B,CAHU,KAAA,MAAAF,EACA,KAAA,SAAAC,EACA,KAAA,UAAAC,CAEZ,CAEO,SAASC,EAAgBN,EAAoB,CAChD,MAAMO,EAAU,KAAK,SAASD,CAAM,EAChCC,EACAA,EAAQ,QAAQ,KAAK,MAAOP,CAAO,EAEnC,QAAQ,KAAK,IAAI,KAAK,SAAS,qBAAqBM,CAAM,EAAE,CAEpE,CACJ"}