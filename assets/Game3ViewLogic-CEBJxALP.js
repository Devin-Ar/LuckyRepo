import{G as H}from"./Game3LogicSchema-AnyI3ivk.js";import{B as c}from"./BaseViewLogic-fTOOk9Vw.js";const l={HERO_X:0,HERO_Y:1,HERO_HP:2,HERO_ANIM_FRAME:5,HERO_FLIP:6,HERO_WIDTH:7,HERO_HEIGHT:8,HERO_ANIM_STATE:9,WORLD_SCALE:10,PLAYER_SCALE:11,PLAYER_OFFSET_Y:12,UI_BOUNCE:20,GLITCH_INTENSITY:21,VIGNETTE_PULSE:22,OBJ_COUNT:50};class I extends c{uiBounce=0;glitchIntensity=0;lastHp=-1;animFrame=0;animTimer=0;lastAnimState=0;update(s,E){if(!this.hasBuffers())return;const t=H,i=l,h=this.logicView[t.HERO_HP],n=this.logicView[t.HERO_ANIM_STATE];n!==this.lastAnimState?(this.animFrame=0,this.animTimer=0,this.lastAnimState=n):(this.animTimer++,this.animTimer>=6&&(this.animFrame=(this.animFrame+1)%12,this.animTimer=0)),this.lastHp!==-1&&h<this.lastHp&&(this.glitchIntensity=1),this.lastHp=h,this.glitchIntensity*=.92;const m=s/16.67;this.uiBounce+=.05*m;const u=.5+Math.sin(E*.05)*.2;this.outputView[i.HERO_X]=this.logicView[t.HERO_X],this.outputView[i.HERO_Y]=this.logicView[t.HERO_Y],this.outputView[i.HERO_HP]=h,this.outputView[i.HERO_ANIM_FRAME]=this.animFrame,this.outputView[i.HERO_FLIP]=this.logicView[t.HERO_FLIP],this.outputView[i.HERO_ANIM_STATE]=n,this.outputView[i.HERO_WIDTH]=this.logicView[t.HERO_WIDTH],this.outputView[i.HERO_HEIGHT]=this.logicView[t.HERO_HEIGHT],this.outputView[i.WORLD_SCALE]=this.logicView[t.WORLD_SCALE],this.outputView[i.PLAYER_SCALE]=this.logicView[t.PLAYER_SCALE],this.outputView[i.PLAYER_OFFSET_Y]=this.logicView[t.PLAYER_OFFSET_Y],this.outputView[i.UI_BOUNCE]=Math.sin(this.uiBounce)*5,this.outputView[i.GLITCH_INTENSITY]=this.glitchIntensity,this.outputView[i.VIGNETTE_PULSE]=u;const o=this.logicView[t.OBJ_COUNT];this.outputView[i.OBJ_COUNT]=o;const a=t.OBJ_START_INDEX,_=o*t.OBJ_STRIDE;for(let e=0;e<_;e++)this.outputView[a+e]=this.logicView[a+e]}getSnapshot(){return{uiBounce:this.uiBounce,glitchIntensity:this.glitchIntensity,lastHp:this.lastHp,animFrame:this.animFrame,animTimer:this.animTimer,lastAnimState:this.lastAnimState}}loadSnapshot(s){s&&(this.uiBounce=s.uiBounce??0,this.glitchIntensity=s.glitchIntensity??0,this.lastHp=s.lastHp??-1,this.animFrame=s.animFrame??0,this.animTimer=s.animTimer??0,this.lastAnimState=s.lastAnimState??0)}}export{I as Game3ViewLogic};
//# sourceMappingURL=Game3ViewLogic-CEBJxALP.js.map
