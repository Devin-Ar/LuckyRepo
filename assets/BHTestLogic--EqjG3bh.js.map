{"version":3,"file":"BHTestLogic--EqjG3bh.js","sources":["../src/features/BulletTest/logic/BHCommands.ts","../src/features/BulletTest/interfaces/baseInterfaces/baseProjectile.ts","../src/features/BulletTest/interfaces/baseInterfaces/basePlayer.ts","../src/features/BulletTest/interfaces/baseInterfaces/baseEntity.ts","../src/features/BulletTest/logic/WaveManager.ts","../src/features/BulletTest/logic/BHTestLogic.ts"],"sourcesContent":["// src/features/Game1/logic/Game1Commands.ts\r\nimport {ICommand} from '../../../core/interfaces/ICommand';\r\nimport {BHConfig} from '../model/BHConfig';\r\n\r\nexport const BHCommands: Record<string, ICommand> = {\r\n    INITIALIZE: {\r\n        execute(logic, payload: BHConfig) {\r\n            logic.applyConfig(payload);\r\n            logic.setInitialized(true);\r\n        }\r\n    },\r\n    MOVEMENT: {\r\n        execute(logic, payload) {\r\n            logic.setMovement(payload.vx, payload.vy);\r\n        }\r\n    },\r\n    TAKE_DAMAGE: {\r\n        execute(logic, payload) {\r\n            const damage = payload.amount ?? 15;\r\n            logic.modifyHp(-damage);\r\n        }\r\n    }\r\n};","import {IHitbox} from \"../IEntity\";\r\nimport {basePlayer} from \"./basePlayer\";\r\nimport {BHConfig} from \"../../model/BHConfig\";\r\nimport {IProjectile} from \"../IProjectile\";\r\nimport {baseEntity} from \"./baseEntity\";\r\n\r\nexport abstract class baseProjectile implements IProjectile {\r\n    seed: number;\r\n    height: number;\r\n    width: number;\r\n    x: number;\r\n    y: number;\r\n    vx: number;\r\n    vy: number;\r\n    damage: number;\r\n    active: boolean;\r\n    hitbox: IHitbox;\r\n    playerRelative: number;\r\n    type: string;\r\n\r\n    protected constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.vx = 0;\r\n        this.vy = 0;\r\n        this.damage = 0;\r\n        this.height = 0;\r\n        this.width = 0;\r\n        this.seed = Math.random() * 1000;\r\n        this.active = false;\r\n        this.hitbox = {offsetX: 0, offsetY: 0};\r\n        this.playerRelative = 0;\r\n        this.type = \"projectile\";\r\n    }\r\n\r\n    abstract update(player: basePlayer, config: BHConfig): void;\r\n\r\n}\r\n\r\nexport class playerProjectile extends baseProjectile {\r\n\r\n    private speed: number = 8;\r\n\r\n    constructor(x: number, y: number, inputState: any, config: BHConfig) {\r\n        super(x, y);\r\n        this.active = true;\r\n        const dx = config.width*inputState.mouseX - this.x;\r\n        const dy = config.height*inputState.mouseY - this.y;\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n        this.vx = Math.cos(this.playerRelative) * this.speed;\r\n        this.vy = Math.sin(this.playerRelative) * this.speed;\r\n        this.damage = -20;\r\n        this.height = 20;\r\n        this.width = 20;\r\n        this.type = \"bullet\";\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        this.x += this.vx;\r\n        this.y += this.vy;\r\n        if (this.x < 0 || this.x > config.width\r\n            || this.y < 0 || this.y > config.height) {\r\n            this.active = false;\r\n        }\r\n    }\r\n\r\n    collided(entity: baseEntity[]) {\r\n        //this does NOT handle when projectiles are bigger than the entity\r\n        for (const holder of entity) {\r\n            if (!this.active) break;\r\n            if (!holder.active) continue;\r\n            if (this.x < holder.x + holder.width && this.x + this.width > holder.x &&\r\n                this.y < holder.y + holder.height && this.y + this.height > holder.y) {\r\n                holder.modifyHP(this.damage);\r\n                this.active = false;\r\n            }\r\n            if (holder.health <= 0) holder.active = false;\r\n        }\r\n    }\r\n\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.width;\r\n        sharedView[base + 3] = this.height;\r\n        sharedView[base + 4] = this.seed;\r\n    }\r\n}\r\n\r\nexport class enemyProjectile extends baseProjectile {\r\n\r\n    private speed: number = 8;\r\n\r\n    constructor(x: number, y: number, playerX: number, playerY: number) {\r\n        super(x, y);\r\n        this.active = true;\r\n        const dx = playerX - this.x;\r\n        const dy = playerY - this.y;\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n        this.vx = Math.cos(this.playerRelative) * this.speed;\r\n        this.vy = Math.sin(this.playerRelative) * this.speed;\r\n        this.damage = -20;\r\n        this.height = 20;\r\n        this.width = 20;\r\n        this.type = \"onebullet\";\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        this.x += this.vx;\r\n        this.y += this.vy;\r\n        if (this.x < 0 || this.x > config.width\r\n            || this.y < 0 || this.y > config.height) {\r\n            this.active = false;\r\n        }\r\n    }\r\n\r\n    collided(entity: basePlayer) {\r\n        //this does NOT handle when projectiles are bigger than the entity\r\n        if (!this.active) return;\r\n        if (this.x < entity.x + entity.width && this.x + this.width > entity.x &&\r\n            this.y < entity.y + entity.height && this.y + this.height > entity.y) {\r\n            entity.modifyHp(this.damage);\r\n            this.active = false;\r\n        }\r\n    }\r\n\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.width;\r\n        sharedView[base + 3] = this.height;\r\n        sharedView[base + 4] = this.seed;\r\n    }\r\n}","import { IPlayer } from '../IPlayer';\r\nimport { BHConfig } from \"../../model/BHConfig\";\r\nimport { IHitbox } from \"../IEntity\";\r\nimport {playerProjectile} from \"./baseProjectile\";\r\n\r\nexport class basePlayer implements IPlayer {\r\n    private static instance: basePlayer;\r\n    active: boolean;\r\n    height: number;\r\n    hitbox: IHitbox;\r\n    hp: number;\r\n    moveSpeed: number;\r\n    vx: number;\r\n    vy: number;\r\n    width: number;\r\n    seed: number;\r\n    playerRelative: number;\r\n    x: number;\r\n    y: number;\r\n    type: string;\r\n\r\n    private currentFrame: number = 0;\r\n    private lastHitFrame: number = 0;\r\n    private bulletTime: number = Date.now();\r\n    private fireFlag: boolean = false;\r\n    private config: any;\r\n\r\n    private constructor() {\r\n        this.active = true;\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.vx = 0;\r\n        this.vy = 0;\r\n        this.playerRelative = 0; //It is itself... Might be usable for tracking mouse\r\n        this.hitbox = {offsetX: 0, offsetY: 0}\r\n        this.height = 30;\r\n        this.width = 30;\r\n        this.hp = 100;\r\n        this.moveSpeed = 0;\r\n        this.seed = Math.random() * 1000;\r\n        this.type = \"player\";\r\n    }\r\n\r\n    //Forcing singleton\r\n    public static getInstance(): basePlayer {\r\n        if (!basePlayer.instance) {\r\n            basePlayer.instance = new basePlayer();\r\n        }\r\n        return basePlayer.instance;\r\n    }\r\n\r\n    public applyConfig(config: BHConfig): void {\r\n        this.config = config;\r\n        this.hp = config.initialHP;\r\n        this.x = config.heroStartX;\r\n        this.y = config.heroStartY;\r\n        this.moveSpeed = config.moveSpeed;\r\n    }\r\n\r\n    public setMovement(vx?: number, vy?: number): void {\r\n        if (vx !== undefined) this.vx = vx;\r\n        if (vy !== undefined) this.vy = vy;\r\n    }\r\n\r\n    public modifyHp(amount: number): void {\r\n        this.hp = Math.max(0, Math.min(100, this.hp + amount));\r\n        if (amount < 0) this.triggerHitCooldown();\r\n    }\r\n\r\n    public triggerHitCooldown(): void {\r\n        this.lastHitFrame = this.currentFrame;\r\n    }\r\n\r\n    //If we ever need to pass more than one action, consider an object: {action: boolean, item1: state, item2: state}\r\n    public playerAction(): boolean {\r\n        const chalEnd = this.fireFlag;\r\n        this.fireFlag = false;\r\n        return chalEnd;\r\n    }\r\n\r\n    public fireProjectile(inputState: any, config: BHConfig): playerProjectile {\r\n        return new playerProjectile(this.x, this.y, inputState, config);\r\n    }\r\n\r\n    public updatePlayer(inputState: any, config: BHConfig, frameCount: number): void {\r\n        this.currentFrame = frameCount;\r\n        this.update(inputState, config);\r\n    }\r\n\r\n    //This one in particular should be private, might need refactoring if we want this to be more clean...\r\n    public update(inputState: any, config: BHConfig): void {\r\n        const actions = inputState.actions;\r\n        if (actions === undefined) return;\r\n        let targetVx = 0;\r\n        let targetVy = 0;\r\n\r\n        if (actions.includes('MOVE_UP')) targetVy = -this.moveSpeed;\r\n        if (actions.includes('MOVE_DOWN')) targetVy = this.moveSpeed;\r\n        if (actions.includes('MOVE_LEFT')) targetVx = -this.moveSpeed;\r\n        if (actions.includes('MOVE_RIGHT')) targetVx = this.moveSpeed;\r\n\r\n        if (inputState.isMouseDown && this.bulletTime + 250 < Date.now()) {\r\n            this.bulletTime = Date.now();\r\n            this.fireFlag = true;\r\n        }\r\n\r\n        this.setMovement(targetVx, targetVy);\r\n\r\n        if (this.currentFrame - this.lastHitFrame > 120 && this.hp < 100) {\r\n            this.hp = Math.min(100, this.hp + (this.hp < 25 ? 0.3 : 0.1));\r\n        }\r\n\r\n        this.x = Math.max(0, Math.min(this.config.width, this.x + this.vx));\r\n        this.y = Math.max(0, Math.min(this.config.height, this.y + this.vy));\r\n    }\r\n}\r\n","import { IEntity, IHitbox } from \"../IEntity\";\r\nimport { basePlayer } from \"./basePlayer\";\r\nimport { BHConfig } from \"../../model/BHConfig\";\r\nimport {enemyProjectile} from \"./baseProjectile\";\r\n\r\nexport abstract class baseEntity implements IEntity {\r\n    active: boolean;\r\n    height: number;\r\n    playerRelative: number;\r\n    hitbox: IHitbox;\r\n    seed: number;\r\n    width: number;\r\n    health: number;\r\n    x: number;\r\n    y: number;\r\n    vx: number;\r\n    vy: number;\r\n    type: string;\r\n\r\n    protected constructor() {\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.vx = 0;\r\n        this.vy = 0;\r\n        this.health = 0;\r\n        this.hitbox = {offsetX: 0, offsetY: 0}\r\n        this.height = 0;\r\n        this.width = 0;\r\n        this.seed = Math.random() * 1000;\r\n        this.active = false;\r\n        this.playerRelative = 0;\r\n        this.type = \"unknown\";\r\n    }\r\n\r\n    abstract update(player: basePlayer, config: BHConfig): void;\r\n    abstract orientation(player: basePlayer): void;\r\n    abstract syncToSAB(sharedView: Float32Array, base: number): void;\r\n    modifyHP(points: number) {\r\n        if (this.active) {\r\n            this.health += points;\r\n        }\r\n        if (this.health < 0) {\r\n            this.active = false;\r\n        }\r\n    }\r\n}\r\n\r\n//We should move this to a separate file\r\nexport class RockEntity extends baseEntity {\r\n    private timeElapsed: number;\r\n    private atkBox: { eX: number, eY: number };\r\n    private followRun: boolean;\r\n    private primedMode: boolean;\r\n\r\n    constructor(x: number, y: number) {\r\n        super();\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = 50;\r\n        this.height = 52;\r\n        this.health = 100;\r\n        this.timeElapsed = Date.now() + Math.random() * 1000;\r\n        this.atkBox = { eX: 0, eY: 0 };\r\n        this.followRun = false;\r\n        this.primedMode = false;\r\n        this.active = true;\r\n        this.type = \"rock\";\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        this.orientation(player);\r\n        this.processRock(player, config);\r\n        this.processRockAttacks(player, config);\r\n    }\r\n\r\n    orientation(player: basePlayer): void {\r\n        const dx = this.x - player.x;\r\n        const dy = this.y - player.y;\r\n\r\n        //Kinda backwards... but 0 is left and pi is right. Also, doesn't do 2pi, but pi and -pi\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n    }\r\n\r\n    //Once we start having more types, maybe we should preface this with a header for the buffer to identify?\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.seed;\r\n        sharedView[base + 3] = this.primedMode ? 1 : 0;\r\n        sharedView[base + 4] = this.atkBox.eX;\r\n        sharedView[base + 5] = this.atkBox.eY;\r\n        sharedView[base + 6] = this.width;\r\n        sharedView[base + 7] = this.height;\r\n    }\r\n\r\n    private processRock(player: basePlayer, config: BHConfig): void {\r\n        if (this.primedMode) return;\r\n        const dx = this.x - player.x;\r\n        const dy = this.y - player.y;\r\n        const distance = dx * dx + dy * dy;\r\n        const sqDistance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n        if (this.followRun) {\r\n            this.vx *= 0;\r\n            this.vy *= 0;\r\n        } else {\r\n            this.vx = config.moveSpeed - 1;\r\n            this.vy = config.moveSpeed - 1;\r\n            if (sqDistance > 200) {\r\n                this.vx *= dx > 0 ? -1 : 1;\r\n                this.vy *= dy > 0 ? -1 : 1;\r\n            }\r\n\r\n            if (sqDistance < 250) {\r\n                this.vx *= dx > 0 ? 1 : -1;\r\n                this.vy *= dy > 0 ? 1 : -1;\r\n            }\r\n        }\r\n\r\n        this.vx = this.x <= 0 ? 1 : this.vx;\r\n        this.vx = this.x >= config.width ? -1 : this.vx;\r\n\r\n        this.vy = this.y <= 0 ? 1 : this.vy;\r\n        this.vy = this.y >= config.height ? -1 : this.vy;\r\n\r\n        this.x += this.vx;\r\n        this.y += this.vy;\r\n\r\n        //100 and 250 are placeholders for range entity need to stay in\r\n        this.followRun = sqDistance > 200 && sqDistance < 250;\r\n\r\n        if (distance < 1600) {\r\n            this.vx *= -1.1;\r\n            this.vy *= -1.1;\r\n            player.modifyHp(-0.2);\r\n            self.postMessage({ type: 'EVENT', name: 'EXPLOSION_REQ' });\r\n        }\r\n    }\r\n\r\n    private processRockAttacks(player: basePlayer, config: BHConfig): void {\r\n        const timeMili = (Date.now() - this.timeElapsed);\r\n        if (timeMili > 5000 && !this.primedMode) {\r\n            this.primedMode = true;\r\n            this.atkBox = { eX: player.x, eY: player.y };\r\n        }\r\n\r\n        if (this.primedMode && timeMili > 7000) {\r\n            const slope = (this.atkBox.eY - this.y) / (this.atkBox.eX - this.x);\r\n            const regnum = this.y - (slope * this.x);\r\n            const top = Math.abs(slope * player.x + -1 * player.y + regnum);\r\n            const bot = Math.sqrt(slope * slope + 1);\r\n            const distanceLines = top / bot;\r\n\r\n            if (distanceLines < 30\r\n                && Math.min(this.atkBox.eX, this.x) <= player.x && player.x <= Math.max(this.atkBox.eX, this.x)\r\n                && Math.min(this.atkBox.eY, this.y) <= player.y && player.y <= Math.max(this.atkBox.eY, this.y)) {\r\n                player.modifyHp(-10);\r\n            }\r\n            this.timeElapsed = Date.now();\r\n            this.primedMode = false;\r\n            this.atkBox = { eX: 0, eY: 0 };\r\n        }\r\n    }\r\n}\r\n\r\nexport class ShotEntity extends baseEntity {\r\n    private timeElapsed: number;\r\n    private followRun: boolean;\r\n    private primedMode: boolean;\r\n\r\n    constructor(x: number, y: number) {\r\n        super();\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = 50;\r\n        this.height = 52;\r\n        this.health = 100;\r\n        this.timeElapsed = Date.now() + Math.random() * 1000;\r\n        this.followRun = false;\r\n        this.primedMode = false;\r\n        this.active = true;\r\n        this.type = \"singleShot\";\r\n    }\r\n\r\n    updateProjectile(player: basePlayer, config: BHConfig, currentShots: enemyProjectile[]): void {\r\n        this.update(player, config);\r\n        this.processShotAttacks(player, currentShots);\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        this.orientation(player);\r\n        this.processShot(player, config);\r\n    }\r\n\r\n    orientation(player: basePlayer): void {\r\n        const dx = this.x - player.x;\r\n        const dy = this.y - player.y;\r\n\r\n        //Kinda backwards... but 0 is left and pi is right. Also, doesn't do 2pi, but pi and -pi\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n    }\r\n\r\n    //Once we start having more types, maybe we should preface this with a header for the buffer to identify?\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.seed;\r\n        sharedView[base + 3] = this.primedMode ? 1 : 0;\r\n        sharedView[base + 4] = this.width;\r\n        sharedView[base + 5] = this.height;\r\n    }\r\n\r\n    private processShot(player: basePlayer, config: BHConfig): void {\r\n        if (this.primedMode) return;\r\n        const dx = this.x - player.x;\r\n        const dy = this.y - player.y;\r\n        const distance = dx * dx + dy * dy;\r\n        const sqDistance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n        if (this.followRun) {\r\n            this.vx *= 0;\r\n            this.vy *= 0;\r\n        } else {\r\n            this.vx = config.moveSpeed - 1;\r\n            this.vy = config.moveSpeed - 1;\r\n            if (sqDistance > 200) {\r\n                this.vx *= dx > 0 ? -1 : 1;\r\n                this.vy *= dy > 0 ? -1 : 1;\r\n            }\r\n\r\n            if (sqDistance < 250) {\r\n                this.vx *= dx > 0 ? 1 : -1;\r\n                this.vy *= dy > 0 ? 1 : -1;\r\n            }\r\n        }\r\n\r\n        this.vx = this.x <= 0 ? 1 : this.vx;\r\n        this.vx = this.x >= config.width ? -1 : this.vx;\r\n\r\n        this.vy = this.y <= 0 ? 1 : this.vy;\r\n        this.vy = this.y >= config.height ? -1 : this.vy;\r\n\r\n        this.x = Math.floor(this.x + this.vx);\r\n        this.y = Math.floor(this.y + this.vy);\r\n\r\n        //100 and 250 are placeholders for range entity need to stay in\r\n        this.followRun = sqDistance > 200 && sqDistance < 250;\r\n\r\n        if (distance < 1600) {\r\n            this.vx *= -1.1;\r\n            this.vy *= -1.1;\r\n            player.modifyHp(-0.2);\r\n            self.postMessage({ type: 'EVENT', name: 'EXPLOSION_REQ' });\r\n        }\r\n    }\r\n\r\n    private processShotAttacks(player: basePlayer, currentShots: enemyProjectile[]): void {\r\n        const timeMili = (Date.now() - this.timeElapsed);\r\n        if (timeMili > 5000 + Math.floor(Math.random() * 3000) && !this.primedMode) {\r\n            this.primedMode = true;\r\n        }\r\n\r\n        if (this.primedMode) {\r\n            currentShots.push(new enemyProjectile(this.x, this.y, player.x, player.y));\r\n            this.timeElapsed = Date.now();\r\n            this.primedMode = false;\r\n        }\r\n    }\r\n}\r\n\r\nexport class BossEntity extends baseEntity {\r\n    public vulnerable: boolean = false;\r\n    private lastShotFrame: number = 0;\r\n    private fireRate: number = 30; // frames between shots\r\n\r\n    constructor(x: number, y: number) {\r\n        super();\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = 200;\r\n        this.height = 200;\r\n        this.health = 300;\r\n        this.active = true;\r\n        this.type = \"boss\";\r\n    }\r\n\r\n    update(player: basePlayer, config: BHConfig): void {\r\n        // Boss is static, no movement\r\n    }\r\n\r\n    updateAttacks(player: basePlayer, frameCount: number, enemyProjectiles: enemyProjectile[]): void {\r\n        if (this.active && this.vulnerable && frameCount - this.lastShotFrame >= this.fireRate) {\r\n            this.lastShotFrame = frameCount;\r\n            // Shoot at player\r\n            enemyProjectiles.push(new enemyProjectile(\r\n                this.x + this.width / 2,\r\n                this.y + this.height / 2,\r\n                player.x,\r\n                player.y\r\n            ));\r\n        }\r\n    }\r\n\r\n    orientation(player: basePlayer): void {\r\n        const dx = this.x + this.width / 2 - player.x;\r\n        const dy = this.y + this.height / 2 - player.y;\r\n        this.playerRelative = Math.atan2(dy, dx);\r\n    }\r\n\r\n    syncToSAB(sharedView: Float32Array, base: number): void {\r\n        sharedView[base] = this.x;\r\n        sharedView[base + 1] = this.y;\r\n        sharedView[base + 2] = this.seed;\r\n        sharedView[base + 3] = this.vulnerable ? 1 : 0;\r\n        sharedView[base + 4] = this.health;\r\n    }\r\n\r\n    modifyHP(points: number) {\r\n        if (this.active && this.vulnerable) {\r\n            this.health += points;\r\n        }\r\n        if (this.health <= 0) {\r\n            this.active = false;\r\n        }\r\n    }\r\n}","// src/features/BulletTest/logic/WaveManager.ts\r\nimport { IEnemySpawn } from '../interfaces/IEnemy';\r\nimport { IWaveDefinition } from '../interfaces/IRoom';\r\nimport { BHConfig } from '../model/BHConfig';\r\nimport {baseEntity, RockEntity, ShotEntity} from '../interfaces/baseInterfaces/baseEntity';\r\n\r\nexport type WaveState = 'IDLE' | 'DELAY' | 'ACTIVE' | 'CLEARED' | 'ALL_CLEARED';\r\n\r\nexport class WaveManager {\r\n    private waveDefinitions: IWaveDefinition[] = [];\r\n    private currentWave: number = -1;     // -1 means not started\r\n    private waveState: WaveState = 'IDLE';\r\n    private delayTimer: number = 0;\r\n    private totalWaves: number = 0;\r\n\r\n    /**\r\n     * Load wave definitions from parsed JSON data.\r\n     * Call this once after config is applied.\r\n     */\r\n    public loadWaves(waves: IWaveDefinition[]): void {\r\n        this.waveDefinitions = waves;\r\n        this.totalWaves = waves.length;\r\n        this.currentWave = -1;\r\n        this.waveState = 'IDLE';\r\n        this.delayTimer = 0;\r\n    }\r\n\r\n    /**\r\n     * Start the first wave (or restart from wave 0).\r\n     */\r\n    public start(): void {\r\n        this.currentWave = 0;\r\n        this.waveState = 'DELAY';\r\n        this.delayTimer = this.waveDefinitions[0]?.delayBeforeStart ?? 60;\r\n    }\r\n\r\n    /**\r\n     * Call every frame from the logic update.\r\n     * Returns a list of enemies to spawn when a new wave begins, or null otherwise.\r\n     */\r\n    public update(activeEnemyCount: number): IEnemySpawn[] | null {\r\n        if (this.waveState === 'IDLE' || this.waveState === 'ALL_CLEARED') {\r\n            return null;\r\n        }\r\n\r\n        // DELAY phase: count down before spawning next wave\r\n        if (this.waveState === 'DELAY') {\r\n            this.delayTimer--;\r\n            if (this.delayTimer <= 0) {\r\n                this.waveState = 'ACTIVE';\r\n                const waveDef = this.waveDefinitions[this.currentWave];\r\n                if (waveDef) {\r\n                    return waveDef.enemies;\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        // ACTIVE phase: wait for all enemies to be eliminated\r\n        if (this.waveState === 'ACTIVE') {\r\n            if (activeEnemyCount <= 0) {\r\n                this.waveState = 'CLEARED';\r\n            }\r\n            return null;\r\n        }\r\n\r\n        // CLEARED phase: advance to next wave or finish\r\n        if (this.waveState === 'CLEARED') {\r\n            return null; // Logic will handle transitioning out of CLEARED\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Move to next wave manually (used by logic when boss is ready)\r\n     */\r\n    public nextWave(): void {\r\n        if (this.waveState !== 'CLEARED') return;\r\n        \r\n        if (this.currentWave + 1 >= this.totalWaves) {\r\n            this.waveState = 'ALL_CLEARED';\r\n        } else {\r\n            this.currentWave++;\r\n            this.waveState = 'DELAY';\r\n            this.delayTimer = this.waveDefinitions[this.currentWave]?.delayBeforeStart ?? 60;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Spawn entities from spawn definitions.\r\n     * spawnX/spawnY are 0-1 normalized, multiplied by config width/height.\r\n     */\r\n    public static spawnFromDefinitions(\r\n        spawns: IEnemySpawn[],\r\n        config: BHConfig\r\n    ): baseEntity[] {\r\n        const entities: baseEntity[] = [];\r\n        for (const spawn of spawns) {\r\n            const x = spawn.spawnX * config.width;\r\n            const y = spawn.spawnY * config.height;\r\n\r\n            // Currently only contact enemies use RockEntity\r\n            // When ranged enemies are added, switch on spawn.damageType\r\n            let entity;\r\n            if (Math.random() > 0.5) {\r\n                entity = new ShotEntity(x, y);\r\n            } else {\r\n                entity = new RockEntity(x, y);\r\n            }\r\n\r\n            // Apply per-enemy config from the wave definition\r\n            entity.health = spawn.hp;\r\n            if ('moveSpeed' in spawn) {\r\n                (entity as any)._waveSpeed = spawn.moveSpeed;\r\n            }\r\n            if ('contactDamage' in spawn && spawn.damageType === 'contact') {\r\n                (entity as any)._contactDamage = spawn.contactDamage;\r\n            }\r\n\r\n            entities.push(entity);\r\n        }\r\n        return entities;\r\n    }\r\n\r\n    // Getters for SAB sync\r\n\r\n    public getCurrentWave(): number {\r\n        return Math.max(0, this.currentWave);\r\n    }\r\n\r\n    public getTotalWaves(): number {\r\n        return this.totalWaves;\r\n    }\r\n\r\n    public getState(): WaveState {\r\n        return this.waveState;\r\n    }\r\n\r\n    public getDelayTimer(): number {\r\n        return this.delayTimer;\r\n    }\r\n\r\n    public isAllCleared(): boolean {\r\n        return this.waveState === 'ALL_CLEARED';\r\n    }\r\n\r\n    // Snapshot support\r\n\r\n    public getSnapshot(): any {\r\n        return {\r\n            currentWave: this.currentWave,\r\n            waveState: this.waveState,\r\n            delayTimer: this.delayTimer,\r\n            totalWaves: this.totalWaves\r\n        };\r\n    }\r\n\r\n    public loadSnapshot(data: any): void {\r\n        if (!data) return;\r\n        this.currentWave = data.currentWave ?? -1;\r\n        this.waveState = data.waveState ?? 'IDLE';\r\n        this.delayTimer = data.delayTimer ?? 0;\r\n        this.totalWaves = data.totalWaves ?? 0;\r\n    }\r\n}","// src/features/BulletTest/logic/BHTestLogic.ts\r\nimport { BHMainLogicSchema, BHRocksLogicSchema, BHPProjLogicSchema, BHEProjLogicSchema } from '../model/BHLogicSchema';\r\nimport { BaseLogic } from '../../../core/templates/BaseLogic';\r\nimport { BaseDispatcher } from '../../../core/templates/BaseDispatcher';\r\nimport { BHCommands } from './BHCommands';\r\nimport { BHConfig } from '../model/BHConfig';\r\nimport { basePlayer } from '../interfaces/baseInterfaces/basePlayer';\r\nimport {baseEntity, BossEntity, ShotEntity} from '../interfaces/baseInterfaces/baseEntity';\r\nimport {enemyProjectile, playerProjectile} from '../interfaces/baseInterfaces/baseProjectile';\r\nimport { WaveManager } from './WaveManager';\r\nimport { IWaveDefinition } from '../interfaces/IRoom';\r\nimport waveData from '../data/bh_waves.json';\r\n\r\ninterface WaveLevelData {\r\n    waves: IWaveDefinition[];\r\n}\r\n\r\nexport class BHTestLogic extends BaseLogic<BHConfig> {\r\n    protected dispatcher: BaseDispatcher<BHTestLogic>;\r\n    private player: basePlayer;\r\n    private entities: baseEntity[] = [];\r\n    private playerProjectiles: playerProjectile[] = [];\r\n    private enemyProjectiles: enemyProjectile[] = [];\r\n    private currentFrame: number = 0;\r\n\r\n    // Boss system\r\n    private boss: BossEntity | null = null;\r\n    private bossLevel: boolean = false;\r\n    private bossTargetHp: number = 3;\r\n\r\n    // Wave system\r\n    private waveManager: WaveManager = new WaveManager();\r\n    private wavesStarted: boolean = false;\r\n\r\n    // Exit door\r\n    private exitDoorActive: boolean = false;\r\n    private exitDoorX: number = 0;\r\n    private exitDoorY: number = 0;\r\n    private static readonly DOOR_SIZE = 60;\r\n    private exitDoorEntered: boolean = false;\r\n\r\n    constructor() {\r\n        super(BHMainLogicSchema.REVISION);\r\n        this.dispatcher = new BaseDispatcher(this, BHCommands, \"BHTest\");\r\n        this.player = basePlayer.getInstance();\r\n    }\r\n\r\n    public applyConfig(config: BHConfig): void {\r\n        this.config = config;\r\n        this.player.applyConfig(config);\r\n\r\n        // Load wave definitions from the JSON based on level\r\n        const levelKey = config.levelLabel || \"Level 1\";\r\n        const levelWaves = (waveData as Record<string, WaveLevelData>)[levelKey];\r\n\r\n        if (levelWaves && levelWaves.waves) {\r\n            this.waveManager.loadWaves(levelWaves.waves);\r\n        } else {\r\n            console.warn(`[BHTestLogic] No wave data for \"${levelKey}\", using empty waves`);\r\n            this.waveManager.loadWaves([]);\r\n        }\r\n\r\n        // Reset entities for fresh start\r\n        this.entities = [];\r\n        this.playerProjectiles = [];\r\n        this.enemyProjectiles = [];\r\n        this.wavesStarted = false;\r\n        this.exitDoorActive = false;\r\n        this.exitDoorEntered = false;\r\n        this.exitDoorX = config.width / 2;\r\n        this.exitDoorY = config.height / 2;\r\n\r\n        const levelLabel = this.config!.levelLabel || \"Level 1\";\r\n        this.bossLevel = levelLabel === \"Level 4\";\r\n        if (this.bossLevel) {\r\n            this.boss = new BossEntity(config.width / 2 - 100, 50);\r\n            this.bossTargetHp = 200; // Vulnerable after wave 1 until hits 200, then wave 2...\r\n        } else {\r\n            this.boss = null;\r\n        }\r\n    }\r\n\r\n    public override destroy(): void {\r\n        super.destroy();\r\n        this.entities = [];\r\n        this.playerProjectiles = [];\r\n        this.enemyProjectiles = [];\r\n        this.wavesStarted = false;\r\n        this.boss = null;\r\n        this.bossLevel = false;\r\n    }\r\n\r\n    public override getSnapshot(): any {\r\n        return {\r\n            player: { ...this.player },\r\n            entities: [...this.entities],\r\n            playerProjectiles: [...this.playerProjectiles],\r\n            enemyProjectiles: [...this.enemyProjectiles],\r\n            currentFrame: this.currentFrame,\r\n            config: this.config,\r\n            waveSnapshot: this.waveManager.getSnapshot(),\r\n            wavesStarted: this.wavesStarted\r\n        };\r\n    }\r\n\r\n    public override loadSnapshot(data: any): void {\r\n        if (!data) return;\r\n        this.config = data.config;\r\n        this.player = data.player;\r\n        this.entities = data.entities;\r\n        this.playerProjectiles = data.playerProjectiles;\r\n        this.enemyProjectiles = data.enemyProjectiles;\r\n        this.currentFrame = data.currentFrame ?? 0;\r\n        this.wavesStarted = data.wavesStarted ?? false;\r\n        if (data.waveSnapshot) {\r\n            this.waveManager.loadSnapshot(data.waveSnapshot);\r\n        }\r\n        this.isInitialized = true;\r\n    }\r\n\r\n    protected onUpdate(sharedView: Float32Array, intView: Int32Array, frameCount: number, fps: number): void {\r\n        if (!this.config) return;\r\n        this.currentFrame = frameCount;\r\n\r\n        // Start waves on first update if not already started\r\n        if (!this.wavesStarted) {\r\n            this.waveManager.start();\r\n            this.wavesStarted = true;\r\n        }\r\n\r\n        // Update wave manager - it checks if current wave is cleared and returns spawns for next wave\r\n        const activeEnemyCount = this.entities.filter(e => e.active).length;\r\n        const newSpawns = this.waveManager.update(activeEnemyCount);\r\n\r\n        // Transition waves automatically for non-boss levels\r\n        if (!this.bossLevel && this.waveManager.getState() === 'CLEARED') {\r\n            this.waveManager.nextWave();\r\n        }\r\n\r\n    // Boss logic\r\n        if (this.bossLevel && this.boss) {\r\n            const waveState = this.waveManager.getState();\r\n            \r\n            // Boss is vulnerable only if no enemies are present and it's between waves or all waves cleared\r\n            if (activeEnemyCount > 0 || waveState === 'ACTIVE' || waveState === 'DELAY') {\r\n                 this.boss.vulnerable = false;\r\n            } else if (waveState === 'CLEARED' || waveState === 'ALL_CLEARED') {\r\n                 // Boss becomes vulnerable when current wave is cleared, until it reaches next HP threshold\r\n                 if (this.boss.health > this.bossTargetHp) {\r\n                     this.boss.vulnerable = true;\r\n                 } else if (this.boss.vulnerable) {\r\n                     this.boss.vulnerable = false;\r\n                     this.bossTargetHp -= 100;\r\n                     // If boss reached target HP, advance to next wave if possible\r\n                     if (waveState === 'CLEARED') {\r\n                         this.waveManager.nextWave();\r\n                     }\r\n                 }\r\n            }\r\n\r\n            // If boss is vulnerable, it shoots\r\n            this.boss.updateAttacks(this.player, frameCount, this.enemyProjectiles);\r\n        }\r\n\r\n        if (newSpawns) {\r\n            const newEntities = WaveManager.spawnFromDefinitions(newSpawns, this.config);\r\n            this.entities.push(...newEntities);\r\n        }\r\n\r\n        // Update player\r\n        (this.player as basePlayer).updatePlayer(this.inputState, this.config, frameCount);\r\n\r\n        // Update existing entities\r\n        for (const entity of this.entities) {\r\n            if (entity.type === \"singleShot\") {\r\n                const typeCast : ShotEntity = entity as unknown as ShotEntity;\r\n                typeCast.updateProjectile(this.player, this.config, this.enemyProjectiles);\r\n            }\r\n            entity.update(this.player, this.config);\r\n        }\r\n\r\n        // Handle player shooting\r\n        if ((this.player as basePlayer).playerAction()) {\r\n            this.playerProjectiles.push(\r\n                (this.player as basePlayer).fireProjectile(this.inputState, this.config)\r\n            );\r\n        }\r\n\r\n        // Update projectiles and check collisions\r\n        for (const proj of this.playerProjectiles) {\r\n            proj.update(this.player, this.config);\r\n            proj.collided(this.entities);\r\n            if (this.boss) {\r\n                proj.collided([this.boss]);\r\n            }\r\n        }\r\n\r\n        // Update projectiles and check collisions\r\n        for (const proj of this.enemyProjectiles) {\r\n            proj.update(this.player, this.config);\r\n            proj.collided(this.player);\r\n        }\r\n\r\n        // Clean up dead entities and expired projectiles\r\n        this.playerProjectiles = this.playerProjectiles.filter(proj => proj.active);\r\n        this.enemyProjectiles = this.enemyProjectiles.filter(proj => proj.active);\r\n        this.entities = this.entities.filter(entity => entity.active);\r\n\r\n        // Check player death\r\n        if (this.player.hp <= 0) {\r\n            self.postMessage({ type: 'EVENT', name: 'PLAYER_DEAD' });\r\n        }\r\n\r\n        // Emit room cleared event when all waves done\r\n        const bossCleared = this.bossLevel ? (this.boss && !this.boss.active) : true;\r\n        if (this.waveManager.isAllCleared() && this.entities.length === 0 && bossCleared) {\r\n            self.postMessage({ type: 'EVENT', name: 'ROOM_CLEARED' });\r\n\r\n            // Activate the exit door\r\n            if (!this.exitDoorActive) {\r\n                this.exitDoorActive = true;\r\n            }\r\n        }\r\n\r\n        // Check if player steps on the exit door\r\n        if (this.exitDoorActive && !this.exitDoorEntered) {\r\n            const halfDoor = BHTestLogic.DOOR_SIZE / 2;\r\n            const px = this.player.x;\r\n            const py = this.player.y;\r\n            if (\r\n                px >= this.exitDoorX - halfDoor && px <= this.exitDoorX + halfDoor &&\r\n                py >= this.exitDoorY - halfDoor && py <= this.exitDoorY + halfDoor\r\n            ) {\r\n                this.exitDoorEntered = true;\r\n                self.postMessage({ type: 'EVENT', name: 'EXIT_DOOR_ENTERED' });\r\n            }\r\n        }\r\n\r\n        this.syncToSAB(sharedView, frameCount, fps);\r\n    }\r\n\r\n    private syncToSAB(sMain: Float32Array, frameCount: number, fps: number): void {\r\n        const sRocks = this.sharedViews.get('rocks');\r\n        const sPProjs = this.sharedViews.get('pProjs');\r\n        const sEProjs = this.sharedViews.get('eProjs');\r\n\r\n        if (!sMain || !sRocks || !sPProjs || !sEProjs) return;\r\n\r\n        const M = BHMainLogicSchema;\r\n\r\n        sMain[M.HERO_HP] = this.player.hp;\r\n        sMain[M.HERO_X] = this.player.x;\r\n        sMain[M.HERO_Y] = this.player.y;\r\n        sMain[M.HERO_VX] = this.player.vx;\r\n        sMain[M.HERO_VY] = this.player.vy;\r\n        sMain[M.HERO_WIDTH] = this.player.width;\r\n        sMain[M.HERO_HEIGHT] = this.player.height;\r\n        sMain[M.FRAME_COUNT] = frameCount;\r\n        if (this.config) {\r\n            const dx = -this.config.width*this.inputState.mouseX + this.player.x;\r\n            const dy = -this.config.height*this.inputState.mouseY + this.player.y;\r\n            sMain[M.MOUSE_RELATIVE] = Math.atan2(dy, dx);\r\n            sMain[M.MAP_WIDTH] = this.config.width;\r\n            sMain[M.MAP_HEIGHT] = this.config.height;\r\n        }\r\n        sMain[M.FPS] = fps;\r\n\r\n        // Wave state info\r\n        sMain[M.CURRENT_WAVE] = this.waveManager.getCurrentWave();\r\n        sMain[M.TOTAL_WAVES] = this.waveManager.getTotalWaves();\r\n        sMain[M.WAVE_DELAY_TIMER] = this.waveManager.getDelayTimer();\r\n\r\n        // Encode wave state as a number: IDLE=0, DELAY=1, ACTIVE=2, CLEARED=3, ALL_CLEARED=4\r\n        const stateMap: Record<string, number> = {\r\n            'IDLE': 0, 'DELAY': 1, 'ACTIVE': 2, 'CLEARED': 3, 'ALL_CLEARED': 4\r\n        };\r\n        sMain[M.WAVE_STATE] = stateMap[this.waveManager.getState()] ?? 0;\r\n\r\n        // Exit door\r\n        sMain[M.EXIT_DOOR_ACTIVE] = this.exitDoorActive ? 1 : 0;\r\n        sMain[M.EXIT_DOOR_X] = this.exitDoorX;\r\n        sMain[M.EXIT_DOOR_Y] = this.exitDoorY;\r\n\r\n        // Encode current level: \"Level 1\"=0, \"Level 2\"=1, \"Level 3\"=2, \"Level 4\"=3\r\n        const levelLabel = this.config!.levelLabel || \"Level 1\";\r\n        const levelIndex = levelLabel === \"Level 4\" ? 3 : levelLabel === \"Level 3\" ? 2 : levelLabel === \"Level 2\" ? 1 : 0;\r\n        sMain[M.CURRENT_LEVEL] = levelIndex;\r\n\r\n        if (this.boss) {\r\n            sMain[M.BOSS_HP] = this.boss.health;\r\n            sMain[M.BOSS_VULNERABLE] = this.boss.vulnerable ? 1 : 0;\r\n            sMain[M.BOSS_X] = this.boss.x;\r\n            sMain[M.BOSS_Y] = this.boss.y;\r\n            sMain[M.BOSS_ACTIVE] = this.boss.active ? 1 : 0;\r\n        } else {\r\n            sMain[M.BOSS_HP] = 0;\r\n            sMain[M.BOSS_VULNERABLE] = 0;\r\n            sMain[M.BOSS_ACTIVE] = 0;\r\n        }\r\n\r\n        // Entities (Rocks)\r\n        const rockCapacity = Math.floor(sRocks.length / BHRocksLogicSchema.STRIDE);\r\n        const rockCount = Math.min(this.entities.length, rockCapacity);\r\n        sMain[M.ROCK_COUNT] = rockCount;\r\n        for (let i = 0; i < rockCount; i++) {\r\n            const base = i * BHRocksLogicSchema.STRIDE;\r\n            this.entities[i].syncToSAB(sRocks, base);\r\n        }\r\n\r\n        // Player projectiles\r\n        const pProjCapacity = Math.floor(sPProjs.length / BHPProjLogicSchema.STRIDE);\r\n        const pProjCount = Math.min(this.playerProjectiles.length, pProjCapacity);\r\n        sMain[M.PPROJ_COUNT] = pProjCount;\r\n        for (let i = 0; i < pProjCount; i++) {\r\n            const base = i * BHPProjLogicSchema.STRIDE;\r\n            this.playerProjectiles[i].syncToSAB(sPProjs, base);\r\n        }\r\n\r\n        // Enemy projectiles\r\n        const eProjCapacity = Math.floor(sEProjs.length / BHEProjLogicSchema.STRIDE);\r\n        const eProjCount = Math.min(this.enemyProjectiles.length, eProjCapacity);\r\n        sMain[M.EPROJ_COUNT] = eProjCount;\r\n        for (let i = 0; i < eProjCount; i++) {\r\n            const base = i * BHEProjLogicSchema.STRIDE;\r\n            this.enemyProjectiles[i].syncToSAB(sEProjs, base);\r\n        }\r\n    }\r\n}"],"names":["BHCommands","logic","payload","damage","baseProjectile","x","y","playerProjectile","inputState","config","dx","dy","player","entity","holder","sharedView","base","enemyProjectile","playerX","playerY","basePlayer","vx","vy","amount","chalEnd","frameCount","actions","targetVx","targetVy","baseEntity","points","RockEntity","distance","sqDistance","timeMili","slope","regnum","top","bot","ShotEntity","currentShots","BossEntity","enemyProjectiles","WaveManager","waves","activeEnemyCount","waveDef","spawns","entities","spawn","data","BHTestLogic","BaseLogic","BHMainLogicSchema","BaseDispatcher","levelKey","levelWaves","waveData","levelLabel","intView","fps","e","newSpawns","waveState","newEntities","proj","bossCleared","halfDoor","px","py","sMain","sRocks","sPProjs","sEProjs","M","stateMap","levelIndex","rockCapacity","BHRocksLogicSchema","rockCount","i","pProjCapacity","BHPProjLogicSchema","pProjCount","eProjCapacity","BHEProjLogicSchema","eProjCount"],"mappings":"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"}