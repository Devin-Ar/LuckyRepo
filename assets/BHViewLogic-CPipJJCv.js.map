{"version":3,"file":"BHViewLogic-CPipJJCv.js","sources":["../src/features/BulletTest/model/BHViewSchema.ts","../src/features/BulletTest/view/BHViewLogic.ts"],"sourcesContent":["import { IBuffer, BufferMap } from \"../../../core/interfaces/IBuffer\";\r\n\r\nexport const BHMainViewSchema: IBuffer = {\r\n    HERO_X: 0,\r\n    HERO_Y: 1,\r\n    HERO_VX: 36,\r\n    HERO_VY: 37,\r\n    HERO_ROTATION: 2,\r\n    HERO_SCALE: 3,\r\n    HERO_HP_DISPLAY: 4,\r\n    HERO_FRAME: 5,\r\n    HERO_WIDTH: 6,\r\n    HERO_HEIGHT: 7,\r\n\r\n    // Wave state\r\n    CURRENT_WAVE: 10,\r\n    TOTAL_WAVES: 11,\r\n    WAVE_STATE: 12,\r\n    WAVE_DELAY_TIMER: 13,\r\n\r\n    // Exit door\r\n    EXIT_DOOR_ACTIVE: 14,\r\n    EXIT_DOOR_X: 15,\r\n    EXIT_DOOR_Y: 16,\r\n    CURRENT_LEVEL: 17,\r\n\r\n    // Boss state\r\n    BOSS_HP: 18,\r\n    BOSS_VULNERABLE: 19,\r\n    BOSS_X: 20,\r\n    BOSS_Y: 21,\r\n    BOSS_ACTIVE: 22,\r\n\r\n    // Counts for other buffers\r\n    ROCK_COUNT: 30,\r\n    PPROJ_COUNT: 31,\r\n    EPROJ_COUNT: 32,\r\n\r\n    MOUSE_RELATIVE: 33,\r\n    MAP_WIDTH: 34,\r\n    MAP_HEIGHT: 35,\r\n\r\n    BUFFER_SIZE: 128\r\n};\r\n\r\nexport const BHRocksViewSchema: IBuffer = {\r\n    STRIDE: 10,\r\n    FRAME: 8,\r\n    BUFFER_SIZE: 9000\r\n};\r\n\r\nexport const BHPProjViewSchema: IBuffer = {\r\n    STRIDE: 5,\r\n    BUFFER_SIZE: 500\r\n};\r\n\r\nexport const BHEProjViewSchema: IBuffer = {\r\n    STRIDE: 5,\r\n    BUFFER_SIZE: 5000\r\n};\r\n\r\nexport const BHViewSchema: BufferMap = {\r\n    main: BHMainViewSchema,\r\n    rocks: BHRocksViewSchema,\r\n    pProjs: BHPProjViewSchema,\r\n    eProjs: BHEProjViewSchema\r\n};","// src/features/BulletTest/view/BHViewLogic.ts\r\nimport {  BHMainLogicSchema, BHRocksLogicSchema, BHPProjLogicSchema, BHEProjLogicSchema } from '../model/BHLogicSchema';\r\nimport {  BHMainViewSchema, BHRocksViewSchema, BHPProjViewSchema, BHEProjViewSchema } from '../model/BHViewSchema';\r\nimport { BaseViewLogic } from '../../../core/templates/BaseViewLogic';\r\n\r\nexport class BHViewLogic extends BaseViewLogic {\r\n    private heroRotation: number = 0;\r\n    private globalRockRotation: number = 0;\r\n\r\n    private animFrame = 0;\r\n    private animTimer = 0;\r\n\r\n    public update(dt: number, frameCount: number) {\r\n        const lMain = this.logicViews.get('main');\r\n        const lRocks = this.logicViews.get('rocks');\r\n        const lPProjs = this.logicViews.get('pProjs');\r\n        const lEProjs = this.logicViews.get('eProjs');\r\n\r\n        const vMain = this.outputViews.get('main');\r\n        const vRocks = this.outputViews.get('rocks');\r\n        const vPProjs = this.outputViews.get('pProjs');\r\n        const vEProjs = this.outputViews.get('eProjs');\r\n\r\n        if (!lMain || !lRocks || !lPProjs || !lEProjs || !vMain || !vRocks || !vPProjs || !vEProjs) return;\r\n\r\n        const LM = BHMainLogicSchema;\r\n        const VM = BHMainViewSchema;\r\n\r\n        const rawX = lMain[LM.HERO_X];\r\n        const rawY = lMain[LM.HERO_Y];\r\n        const rawHP = lMain[LM.HERO_HP];\r\n\r\n        const timeFactor = dt / 16.67;\r\n        this.heroRotation += 0.03 * timeFactor;\r\n\r\n        this.animTimer++;\r\n        if (this.animTimer >= 6) {\r\n            this.animFrame = (this.animFrame + 1) % 3;\r\n            this.animTimer = 0;\r\n        }\r\n\r\n        vMain[VM.HERO_X] = rawX;\r\n        vMain[VM.HERO_Y] = rawY;\r\n        vMain[VM.HERO_VX] = lMain[LM.HERO_VX];\r\n        vMain[VM.HERO_VY] = lMain[LM.HERO_VY];\r\n        vMain[VM.HERO_WIDTH] = lMain[LM.HERO_WIDTH];\r\n        vMain[VM.HERO_HEIGHT] = lMain[LM.HERO_HEIGHT];\r\n        vMain[VM.HERO_ROTATION] = this.heroRotation;\r\n        vMain[VM.HERO_SCALE] = 0.5 + (rawHP / 100);\r\n        vMain[VM.MOUSE_RELATIVE] = lMain[LM.MOUSE_RELATIVE];\r\n        vMain[VM.MAP_WIDTH] = lMain[LM.MAP_WIDTH];\r\n        vMain[VM.MAP_HEIGHT] = lMain[LM.MAP_HEIGHT];\r\n        vMain[VM.HERO_HP_DISPLAY] = rawHP;\r\n        vMain[VM.HERO_FRAME] = this.animFrame;\r\n\r\n        // Rocks\r\n        const rockCount = lMain[LM.ROCK_COUNT];\r\n        vMain[VM.ROCK_COUNT] = rockCount;\r\n        this.globalRockRotation += 0.02 * timeFactor;\r\n\r\n        for (let i = 0; i < rockCount; i++) {\r\n            const lBase = i * BHRocksLogicSchema.STRIDE;\r\n            const vBase = i * BHRocksViewSchema.STRIDE;\r\n            vRocks[vBase] = lRocks[lBase];\r\n            vRocks[vBase + 1] = lRocks[lBase + 1];\r\n            const rockSeed = lRocks[lBase + 2];\r\n            const individualSpeed = ((Math.floor(rockSeed) % 5) + 1) * 0.5;\r\n            vRocks[vBase + 2] = (this.globalRockRotation * individualSpeed) + rockSeed;\r\n            vRocks[vBase + 3] = lRocks[lBase + 3];\r\n            vRocks[vBase + 4] = lRocks[lBase + 4];\r\n            vRocks[vBase + 5] = lRocks[lBase + 5];\r\n            vRocks[vBase + 6] = lRocks[lBase + 6];\r\n            vRocks[vBase + 7] = lRocks[lBase + 7];\r\n            vRocks[vBase + 8] = lRocks[lBase + 8];\r\n            vRocks[vBase + 9] = lRocks[lBase + 9];\r\n        }\r\n\r\n        // Projectiles\r\n        const pProjCount = lMain[LM.PPROJ_COUNT];\r\n        vMain[VM.PPROJ_COUNT] = pProjCount;\r\n        for (let i = 0; i < pProjCount; i++) {\r\n            const lBase = i * BHPProjLogicSchema.STRIDE;\r\n            const vBase = i * BHPProjViewSchema.STRIDE;\r\n            vPProjs[vBase] = lPProjs[lBase];\r\n            vPProjs[vBase + 1] = lPProjs[lBase + 1];\r\n            vPProjs[vBase + 2] = lPProjs[lBase + 2];\r\n            vPProjs[vBase + 3] = lPProjs[lBase + 3];\r\n            vPProjs[vBase + 4] = lPProjs[lBase + 4];\r\n        }\r\n\r\n        const eProjCount = lMain[LM.EPROJ_COUNT];\r\n        vMain[VM.EPROJ_COUNT] = eProjCount;\r\n        for (let i = 0; i < eProjCount; i++) {\r\n            const lBase = i * BHEProjLogicSchema.STRIDE;\r\n            const vBase = i * BHEProjViewSchema.STRIDE;\r\n            vEProjs[vBase] = lEProjs[lBase];\r\n            vEProjs[vBase + 1] = lEProjs[lBase + 1];\r\n            vEProjs[vBase + 2] = lEProjs[lBase + 2];\r\n            vEProjs[vBase + 3] = lEProjs[lBase + 3];\r\n            vEProjs[vBase + 4] = lEProjs[lBase + 4];\r\n        }\r\n\r\n        vMain[VM.CURRENT_WAVE] = lMain[LM.CURRENT_WAVE];\r\n        vMain[VM.TOTAL_WAVES] = lMain[LM.TOTAL_WAVES];\r\n        vMain[VM.WAVE_STATE] = lMain[LM.WAVE_STATE];\r\n        vMain[VM.WAVE_DELAY_TIMER] = lMain[LM.WAVE_DELAY_TIMER];\r\n        vMain[VM.EXIT_DOOR_ACTIVE] = lMain[LM.EXIT_DOOR_ACTIVE];\r\n        vMain[VM.EXIT_DOOR_X] = lMain[LM.EXIT_DOOR_X];\r\n        vMain[VM.EXIT_DOOR_Y] = lMain[LM.EXIT_DOOR_Y];\r\n        vMain[VM.CURRENT_LEVEL] = lMain[LM.CURRENT_LEVEL];\r\n        vMain[VM.BOSS_HP] = lMain[LM.BOSS_HP];\r\n        vMain[VM.BOSS_VULNERABLE] = lMain[LM.BOSS_VULNERABLE];\r\n        vMain[VM.BOSS_X] = lMain[LM.BOSS_X];\r\n        vMain[VM.BOSS_Y] = lMain[LM.BOSS_Y];\r\n        vMain[VM.BOSS_ACTIVE] = lMain[LM.BOSS_ACTIVE];\r\n    }\r\n\r\n    public override getSnapshot() {\r\n        return {\r\n            heroRotation: this.heroRotation,\r\n            globalRockRotation: this.globalRockRotation,\r\n            animFrame: this.animFrame,\r\n            animTimer: this.animTimer\r\n        };\r\n    }\r\n\r\n    public override loadSnapshot(data: any) {\r\n        if (data) {\r\n            this.heroRotation = data.heroRotation ?? 0;\r\n            this.globalRockRotation = data.globalRockRotation ?? 0;\r\n            this.animFrame = data.animFrame ?? 0;\r\n            this.animTimer = data.animTimer ?? 0;\r\n        }\r\n    }\r\n}"],"names":["BHMainViewSchema","BHRocksViewSchema","BHPProjViewSchema","BHEProjViewSchema","BHViewLogic","BaseViewLogic","dt","frameCount","lMain","lRocks","lPProjs","lEProjs","vMain","vRocks","vPProjs","vEProjs","LM","BHMainLogicSchema","VM","rawX","rawY","rawHP","timeFactor","rockCount","i","lBase","BHRocksLogicSchema","vBase","rockSeed","individualSpeed","pProjCount","BHPProjLogicSchema","eProjCount","BHEProjLogicSchema","data"],"mappings":"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"}