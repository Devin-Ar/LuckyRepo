{"version":3,"file":"Game3ViewLogic-CEBJxALP.js","sources":["../src/features/Game3/model/Game3ViewSchema.ts","../src/features/Game3/view/Game3ViewLogic.ts"],"sourcesContent":["// src/features/Game3/model/Game3ViewSchema.ts\r\nimport {IBuffer} from \"../../../core/interfaces/IBuffer\";\r\n\r\nexport const Game3ViewSchema: IBuffer = {\r\n    HERO_X: 0,\r\n    HERO_Y: 1,\r\n    HERO_HP: 2,\r\n\r\n    // Visuals calculated by ViewLogic\r\n    HERO_ANIM_FRAME: 5,\r\n    HERO_FLIP: 6,\r\n    HERO_WIDTH: 7,\r\n    HERO_HEIGHT: 8,\r\n    HERO_ANIM_STATE: 9,\r\n\r\n    WORLD_SCALE: 10,\r\n    PLAYER_SCALE: 11,\r\n    PLAYER_OFFSET_Y: 12,\r\n\r\n    UI_BOUNCE: 20,\r\n    GLITCH_INTENSITY: 21,\r\n    VIGNETTE_PULSE: 22,\r\n\r\n    // Object System (Mirrored from Logic)\r\n    OBJ_COUNT: 50,\r\n    OBJ_START_INDEX: 100,\r\n    OBJ_STRIDE: 5,\r\n    MAX_OBJECTS: 1000,\r\n\r\n    BUFFER_SIZE: 10000\r\n};","// src/features/Game3/logic/Game3ViewLogic.ts\r\nimport { Game3LogicSchema } from '../model/Game3LogicSchema';\r\nimport { Game3ViewSchema } from '../model/Game3ViewSchema';\r\nimport { BaseViewLogic } from '../../../core/templates/BaseViewLogic';\r\n\r\nexport class Game3ViewLogic extends BaseViewLogic {\r\n    private uiBounce: number = 0;\r\n    private glitchIntensity: number = 0;\r\n    private lastHp: number = -1;\r\n\r\n    // Animation internal state\r\n    private animFrame = 0;\r\n    private animTimer = 0;\r\n    private lastAnimState = 0;\r\n\r\n    public update(dt: number, frameCount: number) {\r\n        if (!this.hasBuffers()) return;\r\n\r\n        const L = Game3LogicSchema;\r\n        const V = Game3ViewSchema;\r\n\r\n        // 1. Read Basic State from Logic\r\n        const hp = this.logicView[L.HERO_HP];\r\n        const animState = this.logicView[L.HERO_ANIM_STATE];\r\n\r\n        // 2. Process Animation (Moved from Logic)\r\n        if (animState !== this.lastAnimState) {\r\n            this.animFrame = 0;\r\n            this.animTimer = 0;\r\n            this.lastAnimState = animState;\r\n        } else {\r\n            this.animTimer++;\r\n            // Basic animation speed: changes every 6 ticks\r\n            if (this.animTimer >= 6) {\r\n                this.animFrame = (this.animFrame + 1) % 12; // Modulo 12 assumed from sprite sheet\r\n                this.animTimer = 0;\r\n            }\r\n        }\r\n\r\n        // 3. Visual Effects (UI Bounce, etc)\r\n        if (this.lastHp !== -1 && hp < this.lastHp) {\r\n            this.glitchIntensity = 1.0;\r\n        }\r\n        this.lastHp = hp;\r\n        this.glitchIntensity *= 0.92;\r\n\r\n        const timeFactor = dt / 16.67;\r\n        this.uiBounce += 0.05 * timeFactor;\r\n        const vignettePulse = 0.5 + Math.sin(frameCount * 0.05) * 0.2;\r\n\r\n        // 4. Write to View Buffer\r\n        this.outputView[V.HERO_X] = this.logicView[L.HERO_X];\r\n        this.outputView[V.HERO_Y] = this.logicView[L.HERO_Y];\r\n        this.outputView[V.HERO_HP] = hp;\r\n\r\n        this.outputView[V.HERO_ANIM_FRAME] = this.animFrame; // Calculated here!\r\n        this.outputView[V.HERO_FLIP] = this.logicView[L.HERO_FLIP];\r\n        this.outputView[V.HERO_ANIM_STATE] = animState;\r\n        this.outputView[V.HERO_WIDTH] = this.logicView[L.HERO_WIDTH];\r\n        this.outputView[V.HERO_HEIGHT] = this.logicView[L.HERO_HEIGHT];\r\n\r\n        this.outputView[V.WORLD_SCALE] = this.logicView[L.WORLD_SCALE];\r\n        this.outputView[V.PLAYER_SCALE] = this.logicView[L.PLAYER_SCALE];\r\n        this.outputView[V.PLAYER_OFFSET_Y] = this.logicView[L.PLAYER_OFFSET_Y];\r\n\r\n        this.outputView[V.UI_BOUNCE] = Math.sin(this.uiBounce) * 5;\r\n        this.outputView[V.GLITCH_INTENSITY] = this.glitchIntensity;\r\n        this.outputView[V.VIGNETTE_PULSE] = vignettePulse;\r\n\r\n        // 5. Sync Objects (Pass-through from Logic SAB to View SAB)\r\n        const objCount = this.logicView[L.OBJ_COUNT];\r\n        this.outputView[V.OBJ_COUNT] = objCount;\r\n\r\n        // Block copy object data\r\n        const startIdx = L.OBJ_START_INDEX;\r\n        const totalFloats = objCount * L.OBJ_STRIDE;\r\n        for(let i=0; i<totalFloats; i++) {\r\n            this.outputView[startIdx + i] = this.logicView[startIdx + i];\r\n        }\r\n    }\r\n\r\n    public override getSnapshot() {\r\n        return {\r\n            uiBounce: this.uiBounce,\r\n            glitchIntensity: this.glitchIntensity,\r\n            lastHp: this.lastHp,\r\n            animFrame: this.animFrame,\r\n            animTimer: this.animTimer,\r\n            lastAnimState: this.lastAnimState\r\n        };\r\n    }\r\n\r\n    public override loadSnapshot(data: any) {\r\n        if (data) {\r\n            this.uiBounce = data.uiBounce ?? 0;\r\n            this.glitchIntensity = data.glitchIntensity ?? 0;\r\n            this.lastHp = data.lastHp ?? -1;\r\n            this.animFrame = data.animFrame ?? 0;\r\n            this.animTimer = data.animTimer ?? 0;\r\n            this.lastAnimState = data.lastAnimState ?? 0;\r\n        }\r\n    }\r\n}"],"names":["Game3ViewSchema","Game3ViewLogic","BaseViewLogic","dt","frameCount","L","Game3LogicSchema","V","hp","animState","timeFactor","vignettePulse","objCount","startIdx","totalFloats","i","data"],"mappings":"mGAGO,MAAMA,EAA2B,CACpC,OAAQ,EACR,OAAQ,EACR,QAAS,EAGT,gBAAiB,EACjB,UAAW,EACX,WAAY,EACZ,YAAa,EACb,gBAAiB,EAEjB,YAAa,GACb,aAAc,GACd,gBAAiB,GAEjB,UAAW,GACX,iBAAkB,GAClB,eAAgB,GAGhB,UAAW,EAMf,ECzBO,MAAMC,UAAuBC,CAAc,CACtC,SAAmB,EACnB,gBAA0B,EAC1B,OAAiB,GAGjB,UAAY,EACZ,UAAY,EACZ,cAAgB,EAEjB,OAAOC,EAAYC,EAAoB,CAC1C,GAAI,CAAC,KAAK,aAAc,OAExB,MAAMC,EAAIC,EACJC,EAAIP,EAGJQ,EAAK,KAAK,UAAUH,EAAE,OAAO,EAC7BI,EAAY,KAAK,UAAUJ,EAAE,eAAe,EAG9CI,IAAc,KAAK,eACnB,KAAK,UAAY,EACjB,KAAK,UAAY,EACjB,KAAK,cAAgBA,IAErB,KAAK,YAED,KAAK,WAAa,IAClB,KAAK,WAAa,KAAK,UAAY,GAAK,GACxC,KAAK,UAAY,IAKrB,KAAK,SAAW,IAAMD,EAAK,KAAK,SAChC,KAAK,gBAAkB,GAE3B,KAAK,OAASA,EACd,KAAK,iBAAmB,IAExB,MAAME,EAAaP,EAAK,MACxB,KAAK,UAAY,IAAOO,EACxB,MAAMC,EAAgB,GAAM,KAAK,IAAIP,EAAa,GAAI,EAAI,GAG1D,KAAK,WAAWG,EAAE,MAAM,EAAI,KAAK,UAAUF,EAAE,MAAM,EACnD,KAAK,WAAWE,EAAE,MAAM,EAAI,KAAK,UAAUF,EAAE,MAAM,EACnD,KAAK,WAAWE,EAAE,OAAO,EAAIC,EAE7B,KAAK,WAAWD,EAAE,eAAe,EAAI,KAAK,UAC1C,KAAK,WAAWA,EAAE,SAAS,EAAI,KAAK,UAAUF,EAAE,SAAS,EACzD,KAAK,WAAWE,EAAE,eAAe,EAAIE,EACrC,KAAK,WAAWF,EAAE,UAAU,EAAI,KAAK,UAAUF,EAAE,UAAU,EAC3D,KAAK,WAAWE,EAAE,WAAW,EAAI,KAAK,UAAUF,EAAE,WAAW,EAE7D,KAAK,WAAWE,EAAE,WAAW,EAAI,KAAK,UAAUF,EAAE,WAAW,EAC7D,KAAK,WAAWE,EAAE,YAAY,EAAI,KAAK,UAAUF,EAAE,YAAY,EAC/D,KAAK,WAAWE,EAAE,eAAe,EAAI,KAAK,UAAUF,EAAE,eAAe,EAErE,KAAK,WAAWE,EAAE,SAAS,EAAI,KAAK,IAAI,KAAK,QAAQ,EAAI,EACzD,KAAK,WAAWA,EAAE,gBAAgB,EAAI,KAAK,gBAC3C,KAAK,WAAWA,EAAE,cAAc,EAAII,EAGpC,MAAMC,EAAW,KAAK,UAAUP,EAAE,SAAS,EAC3C,KAAK,WAAWE,EAAE,SAAS,EAAIK,EAG/B,MAAMC,EAAWR,EAAE,gBACbS,EAAcF,EAAWP,EAAE,WACjC,QAAQU,EAAE,EAAGA,EAAED,EAAaC,IACxB,KAAK,WAAWF,EAAWE,CAAC,EAAI,KAAK,UAAUF,EAAWE,CAAC,CAEnE,CAEgB,aAAc,CAC1B,MAAO,CACH,SAAU,KAAK,SACf,gBAAiB,KAAK,gBACtB,OAAQ,KAAK,OACb,UAAW,KAAK,UAChB,UAAW,KAAK,UAChB,cAAe,KAAK,aAAA,CAE5B,CAEgB,aAAaC,EAAW,CAChCA,IACA,KAAK,SAAWA,EAAK,UAAY,EACjC,KAAK,gBAAkBA,EAAK,iBAAmB,EAC/C,KAAK,OAASA,EAAK,QAAU,GAC7B,KAAK,UAAYA,EAAK,WAAa,EACnC,KAAK,UAAYA,EAAK,WAAa,EACnC,KAAK,cAAgBA,EAAK,eAAiB,EAEnD,CACJ"}