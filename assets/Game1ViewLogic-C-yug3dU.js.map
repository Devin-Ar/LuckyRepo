{"version":3,"file":"Game1ViewLogic-C-yug3dU.js","sources":["../src/features/Game1/model/Game1ViewSchema.ts","../src/features/Game1/view/Game1ViewLogic.ts"],"sourcesContent":["// src/features/Game1/model/Game1ViewSchema.ts\r\nimport {IBuffer, BufferMap} from \"../../../core/interfaces/IBuffer\";\r\n\r\nexport const Game1ViewMainSchema: IBuffer = {\r\n    HERO_X: 0,\r\n    HERO_Y: 1,\r\n    HERO_ROTATION: 2,\r\n    HERO_SCALE: 3,\r\n    HERO_HP_DISPLAY: 4,\r\n    HERO_FRAME: 5,\r\n    ACTIVE_ROCK_COUNT: 6,\r\n\r\n    BUFFER_SIZE: 128\r\n};\r\n\r\nexport const Game1ViewRocksSchema: IBuffer = {\r\n    START_INDEX: 0,\r\n    STRIDE: 3,\r\n\r\n    BUFFER_SIZE: 3000\r\n};\r\n\r\nexport const Game1ViewSchema: BufferMap = {\r\n    main: Game1ViewMainSchema,\r\n    rocks: Game1ViewRocksSchema\r\n};","// src/features/Game1/view/Game1ViewLogic.ts\r\nimport { Game1MainSchema, Game1RocksSchema } from '../model/Game1LogicSchema';\r\nimport { Game1ViewMainSchema, Game1ViewRocksSchema } from '../model/Game1ViewSchema';\r\nimport { BaseViewLogic } from '../../../core/templates/BaseViewLogic';\r\n\r\nexport class Game1ViewLogic extends BaseViewLogic {\r\n    private heroRotation: number = 0;\r\n    private globalRockRotation: number = 0;\r\n    private heroFrame: number = 0;\r\n\r\n    public update(dt: number, frameCount: number) {\r\n        const lMain = this.logicViews.get('main');\r\n        const lRocks = this.logicViews.get('rocks');\r\n        const vMain = this.outputViews.get('main');\r\n        const vRocks = this.outputViews.get('rocks');\r\n\r\n        if (!lMain || !lRocks || !vMain || !vRocks) return;\r\n\r\n        const rockCount = lMain[Game1MainSchema.ENTITY_COUNT];\r\n        const vCapacity = Math.floor(vRocks.length / Game1ViewRocksSchema.STRIDE);\r\n\r\n        if (rockCount > vCapacity) {\r\n            if ((this as any)._outResizePending !== vCapacity) {\r\n                self.postMessage({\r\n                    type: 'REQUEST_RESIZE_OUTPUT',\r\n                    payload: {\r\n                        bufferName: 'rocks',\r\n                        newSize: (rockCount + 1000) * Game1ViewRocksSchema.STRIDE\r\n                    }\r\n                });\r\n                (this as any)._outResizePending = vCapacity;\r\n            }\r\n        } else {\r\n            (this as any)._outResizePending = 0;\r\n        }\r\n\r\n        const rawHP = lMain[Game1MainSchema.HERO_HP];\r\n        this.heroRotation += 0.03 * (dt / 16.67);\r\n        this.heroFrame += 0.15 * (dt / 16.67);\r\n\r\n        vMain[Game1ViewMainSchema.HERO_X] = lMain[Game1MainSchema.HERO_X];\r\n        vMain[Game1ViewMainSchema.HERO_Y] = lMain[Game1MainSchema.HERO_Y];\r\n        vMain[Game1ViewMainSchema.HERO_ROTATION] = this.heroRotation;\r\n        vMain[Game1ViewMainSchema.HERO_SCALE] = 0.5 + (rawHP / 100);\r\n        vMain[Game1ViewMainSchema.HERO_HP_DISPLAY] = rawHP;\r\n        vMain[Game1ViewMainSchema.HERO_FRAME] = this.heroFrame;\r\n\r\n        const safeRockCount = Math.min(rockCount, vCapacity);\r\n        vMain[Game1ViewMainSchema.ACTIVE_ROCK_COUNT] = safeRockCount;\r\n\r\n        this.globalRockRotation += 0.02 * (dt / 16.67);\r\n\r\n        for (let i = 0; i < safeRockCount; i++) {\r\n            const lBase = i * Game1RocksSchema.STRIDE;\r\n            const vBase = i * Game1ViewRocksSchema.STRIDE;\r\n\r\n            if (lBase + 2 >= lRocks.length) break;\r\n\r\n            vRocks[vBase] = lRocks[lBase];\r\n            vRocks[vBase + 1] = lRocks[lBase + 1];\r\n\r\n            const rockSeed = lRocks[lBase + 2];\r\n            const individualSpeed = ((Math.floor(rockSeed) % 5) + 1) * 0.5;\r\n            vRocks[vBase + 2] = (this.globalRockRotation * individualSpeed) + rockSeed;\r\n        }\r\n    }\r\n\r\n    public override getSnapshot() {\r\n        return {\r\n            heroRotation: this.heroRotation,\r\n            globalRockRotation: this.globalRockRotation,\r\n            heroFrame: this.heroFrame\r\n        };\r\n    }\r\n\r\n    public override loadSnapshot(data: any) {\r\n        if (data) {\r\n            this.heroRotation = data.heroRotation ?? 0;\r\n            this.globalRockRotation = data.globalRockRotation ?? 0;\r\n            this.heroFrame = data.heroFrame ?? 0;\r\n        }\r\n    }\r\n}"],"names":["Game1ViewMainSchema","Game1ViewRocksSchema","Game1ViewLogic","BaseViewLogic","dt","frameCount","lMain","lRocks","vMain","vRocks","rockCount","Game1MainSchema","vCapacity","rawHP","safeRockCount","i","lBase","Game1RocksSchema","vBase","rockSeed","individualSpeed","data"],"mappings":"0GAGO,MAAMA,EAA+B,CACxC,OAAQ,EACR,OAAQ,EACR,cAAe,EACf,WAAY,EACZ,gBAAiB,EACjB,WAAY,EACZ,kBAAmB,CAGvB,EAEaC,EAAgC,CAEzC,OAAQ,CAGZ,ECfO,MAAMC,UAAuBC,CAAc,CACtC,aAAuB,EACvB,mBAA6B,EAC7B,UAAoB,EAErB,OAAOC,EAAYC,EAAoB,CAC1C,MAAMC,EAAQ,KAAK,WAAW,IAAI,MAAM,EAClCC,EAAS,KAAK,WAAW,IAAI,OAAO,EACpCC,EAAQ,KAAK,YAAY,IAAI,MAAM,EACnCC,EAAS,KAAK,YAAY,IAAI,OAAO,EAE3C,GAAI,CAACH,GAAS,CAACC,GAAU,CAACC,GAAS,CAACC,EAAQ,OAE5C,MAAMC,EAAYJ,EAAMK,EAAgB,YAAY,EAC9CC,EAAY,KAAK,MAAMH,EAAO,OAASR,EAAqB,MAAM,EAEpES,EAAYE,EACP,KAAa,oBAAsBA,IACpC,KAAK,YAAY,CACb,KAAM,wBACN,QAAS,CACL,WAAY,QACZ,SAAUF,EAAY,KAAQT,EAAqB,MAAA,CACvD,CACH,EACA,KAAa,kBAAoBW,GAGrC,KAAa,kBAAoB,EAGtC,MAAMC,EAAQP,EAAMK,EAAgB,OAAO,EAC3C,KAAK,cAAgB,KAAQP,EAAK,OAClC,KAAK,WAAa,KAAQA,EAAK,OAE/BI,EAAMR,EAAoB,MAAM,EAAIM,EAAMK,EAAgB,MAAM,EAChEH,EAAMR,EAAoB,MAAM,EAAIM,EAAMK,EAAgB,MAAM,EAChEH,EAAMR,EAAoB,aAAa,EAAI,KAAK,aAChDQ,EAAMR,EAAoB,UAAU,EAAI,GAAOa,EAAQ,IACvDL,EAAMR,EAAoB,eAAe,EAAIa,EAC7CL,EAAMR,EAAoB,UAAU,EAAI,KAAK,UAE7C,MAAMc,EAAgB,KAAK,IAAIJ,EAAWE,CAAS,EACnDJ,EAAMR,EAAoB,iBAAiB,EAAIc,EAE/C,KAAK,oBAAsB,KAAQV,EAAK,OAExC,QAASW,EAAI,EAAGA,EAAID,EAAeC,IAAK,CACpC,MAAMC,EAAQD,EAAIE,EAAiB,OAC7BC,EAAQH,EAAId,EAAqB,OAEvC,GAAIe,EAAQ,GAAKT,EAAO,OAAQ,MAEhCE,EAAOS,CAAK,EAAIX,EAAOS,CAAK,EAC5BP,EAAOS,EAAQ,CAAC,EAAIX,EAAOS,EAAQ,CAAC,EAEpC,MAAMG,EAAWZ,EAAOS,EAAQ,CAAC,EAC3BI,GAAoB,KAAK,MAAMD,CAAQ,EAAI,EAAK,GAAK,GAC3DV,EAAOS,EAAQ,CAAC,EAAK,KAAK,mBAAqBE,EAAmBD,CACtE,CACJ,CAEgB,aAAc,CAC1B,MAAO,CACH,aAAc,KAAK,aACnB,mBAAoB,KAAK,mBACzB,UAAW,KAAK,SAAA,CAExB,CAEgB,aAAaE,EAAW,CAChCA,IACA,KAAK,aAAeA,EAAK,cAAgB,EACzC,KAAK,mBAAqBA,EAAK,oBAAsB,EACrD,KAAK,UAAYA,EAAK,WAAa,EAE3C,CACJ"}